<!DOCTYPE html>
<!-- saved from url=(0137)https://www.edgedb.com/blog/an-approach-to-optimizing-typescript-type-checking-performance#how-do-we-quantify-the-type-checker-s-workload -->
<html lang="en" data-theme="light"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width"><title>An approach to optimizing TypeScript type checking performance | EdgeDB Blog</title><link rel="canonical" href="https://www.edgedb.com/blog/an-approach-to-optimizing-typescript-type-checking-performance"><link rel="alternate" type="application/rss+xml" title="EdgeDB Blog" href="https://www.edgedb.com/rss.xml"><meta name="description" property="description" content="A process for measuring and optimizing TypeScript type checking performance"><meta name="og:title" property="og:title" content="An approach to optimizing TypeScript type checking performance | EdgeDB Blog"><meta name="og:type" property="og:type" content="website"><meta name="og:description" property="og:description" content="A process for measuring and optimizing TypeScript type checking performance"><meta name="og:image" property="og:image" content="https://www.edgedb.com/_images/_blog/4196cf87ed3e24e8d86af535487dd9b0db7e21ee.jpg"><meta name="og:url" property="og:url" content="https://www.edgedb.com/blog/an-approach-to-optimizing-typescript-type-checking-performance"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:title" content="An approach to optimizing TypeScript type checking performance | EdgeDB Blog"><meta name="twitter:description" content="A process for measuring and optimizing TypeScript type checking performance"><meta name="twitter:image" content="https://www.edgedb.com/_images/_blog/4196cf87ed3e24e8d86af535487dd9b0db7e21ee.jpg"><meta name="twitter:image:alt" content="A process for measuring and optimizing TypeScript type checking performance"><meta name="twitter:site" content="@edgedatabase"><meta name="next-head-count" content="17"><script>window.sa_event=window.sa_event||function(){var a=[].slice.call(arguments);window.sa_event.q?window.sa_event.q.push(a):window.sa_event.q=[a]};</script><link rel="apple-touch-icon" sizes="120x120" href="https://www.edgedb.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://www.edgedb.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://www.edgedb.com/favicon-16x16.png"><link rel="manifest" href="https://www.edgedb.com/site.webmanifest"><link rel="mask-icon" href="https://www.edgedb.com/safari-pinned-tab.svg" color="#05a876"><meta name="msapplication-TileColor" content="#05a876"><meta name="theme-color" content="#ffffff"><link rel="preload" as="font" type="font/woff2" href="https://www.edgedb.com/assets/fonts/edgedb-700.woff2" crossorigin="anonymous"><link rel="preload" as="font" type="font/woff2" href="https://www.edgedb.com/assets/fonts/roboto-mono-latin-400.woff2" crossorigin="anonymous"><link rel="preload" as="font" type="font/woff2" href="https://www.edgedb.com/assets/fonts/open-sans-latin-400.woff2" crossorigin="anonymous"><link rel="preload" as="font" type="font/woff2" href="https://www.edgedb.com/assets/fonts/open-sans-latin-400italic.woff2" crossorigin="anonymous"><link rel="preload" as="font" type="font/woff2" href="https://www.edgedb.com/assets/fonts/open-sans-latin-700.woff2" crossorigin="anonymous"><link rel="preload" as="font" type="font/woff2" href="https://www.edgedb.com/assets/fonts/open-sans-latin-800.woff2" crossorigin="anonymous"><link rel="preload" href="./s_files/b06c2fa12273d9b8.css" as="style"><link rel="stylesheet" href="./s_files/b06c2fa12273d9b8.css" data-n-g=""><link rel="preload" href="./s_files/c5f10f9ae7aaea7f.css" as="style"><link rel="stylesheet" href="./s_files/c5f10f9ae7aaea7f.css" data-n-p=""><link rel="preload" href="./s_files/144e5f014f92a48e.css" as="style"><link rel="stylesheet" href="./s_files/144e5f014f92a48e.css" data-n-p=""><link rel="preload" href="./s_files/a8ae71a6cdfdc03d.css" as="style"><link rel="stylesheet" href="./s_files/a8ae71a6cdfdc03d.css" data-n-p=""><noscript data-n-css=""></noscript><script defer="" nomodule="" src="./s_files/polyfills-78c92fac7aa8fdd8.js"></script><script src="./s_files/webpack-9647241249250007.js" defer=""></script><script src="./s_files/framework-1c2bd96492f7c775.js" defer=""></script><script src="./s_files/main-cc2b4d9eabb94d3a.js" defer=""></script><script src="./s_files/_app-aeaf1545f1996589.js" defer=""></script><script src="./s_files/2727-0f2d7f91982c5d9d.js" defer=""></script><script src="./s_files/8349-e53dce2517cb2cb1.js" defer=""></script><script src="./s_files/1546-d816bf9c81f92d35.js" defer=""></script><script src="./s_files/9011-ca7cb5e8a1d766be.js" defer=""></script><script src="./s_files/156-d52b6aac165b1d29.js" defer=""></script><script src="./s_files/[slug]-0ff54414391f5abd.js" defer=""></script><script src="./s_files/_buildManifest.js" defer=""></script><script src="./s_files/_ssgManifest.js" defer=""></script><link as="script" rel="prefetch" href="./s_files/blog-52c9e0f05f73605d.js"><link as="script" rel="prefetch" href="./s_files/11d837d1-ee2ce654bf6d7ebf.js"><link as="script" rel="prefetch" href="./s_files/16db9192-50210da8d29f8c7e.js"><link as="script" rel="prefetch" href="./s_files/3ffde0ae-945d9e7729047e21.js"><link as="script" rel="prefetch" href="./s_files/ee8dd797-b8ed1a8f63feb932.js"><link as="script" rel="prefetch" href="./s_files/e282aedf-f0ad0aeca04f2052.js"><link as="script" rel="prefetch" href="./s_files/3383-e4edad8302a9daf1.js"><link as="script" rel="prefetch" href="./s_files/7833-f76e3344ec75806c.js"><link as="script" rel="prefetch" href="./s_files/index-9dca941ba9be84c1.js"></head><body class=" no-touch"><script>
              document.body.className +=
                (('ontouchstart' in document.documentElement)
                  ? ' touch' : ' no-touch');
              </script><div id="__next"><div style="display:contents"><div class="layout_mainLayout__LbTrz blogPost_page___k95w" style="--backgroundImage:url(data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wAARCAAhAFADASIAAhEBAxEB/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/8QAHwEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoL/8QAtREAAgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHBCSMzUvAVYnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6goOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4uPk5ebn6Onq8vP09fb3+Pn6/9oADAMBAAIRAxEAPwDjgM0Yp44oA5q7E3GkYFJWnbaek1ukjOwLDoKhvbRLbYFYsGz1rR0pJcxCqRbsUqAMnFXprSFfNVHcvEASCBg0TWsMcmwGXcWAyV4pezaD2iKIHI9KMc4q+1rD8wjd8o4Vsgdzio7iGGIkIZC6tj5hxQ6bSBTTKlGOKcBx9aXFRYu4UZ6UzPGKM80XCxpw3UAt4UfO5Dk/Lmq9zKjqgQ52knp/nNVM0A4q3UbViFTSdy9c3m9pBGqhGwC23k06eeKSUSCaQgMCEK8CqBOc+lGflp+0b3D2aNCS9WQYLEYl3DA6rUFxcvNI43sYy2QDVUHFLu60nUb3BQS2HCimZ5zSk5qLl2G0UUUhhRRRQAUUUUAFFFFABRRRQB//2Q==);--opacity:0.4"><div class="pageNav_pageHeader__1p8px"><div class="pageNav_headerWrapper__tKciy"><div class="pageNav_headerLogo__kBUdU"><a style="display:flex" href="https://www.edgedb.com/"><svg width="88" height="26" viewBox="0 0 88 26" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M74.5366 12.8066C74.5366 18.8795 72.1017 19.968 69.3803 19.968H63.5939V5.64512H69.3803C72.1017 5.64512 74.5366 6.73366 74.5366 12.8066ZM71.5862 12.8072C71.5862 8.56764 70.2971 8.36712 68.4352 8.36712H66.6305V17.2473H68.4352C70.2971 17.2473 71.5862 17.0468 71.5862 12.8072ZM40.9345 19.968V5.64512H50.0439V8.36647H43.971V11.2883H48.5543V13.9811H43.971V17.2467H50.0439V19.968H40.9345ZM55 26H58V0H55V26ZM80.6088 13.6097V17.2477H83.1296C84.7051 17.2477 85.1062 16.2165 85.1062 15.443C85.1062 14.8415 84.8197 13.6097 82.6713 13.6097H80.6088ZM80.6088 8.36712V11.0885H82.6713C83.8458 11.0885 84.5333 10.5728 84.5333 9.71347C84.5333 8.8541 83.8458 8.36712 82.6713 8.36712H80.6088ZM77.5732 5.64512H83.4169C86.482 5.64512 87.3987 7.79356 87.3987 9.34043C87.3987 10.7727 86.482 11.804 85.8518 12.0904C87.6851 12.9785 88.0002 14.7831 88.0002 15.6998C88.0002 16.9029 87.3987 19.968 83.4169 19.968H77.5732V5.64512ZM23.49 12.8066C23.49 18.8795 21.0551 19.968 18.3337 19.968H12.5473V5.64512H18.3337C21.0551 5.64512 23.49 6.73366 23.49 12.8066ZM32.427 17.3625C33.9739 17.3625 34.7759 16.8469 35.0624 16.5032V14.9276H32.5989V12.4641H37.4973V18.1646C37.0676 18.8235 34.7186 20.1125 32.5702 20.1125C29.0468 20.1125 26.0676 18.7375 26.0676 12.6646C26.0676 6.59171 29.0754 5.50317 31.7968 5.50317C36.065 5.50317 37.1249 7.73754 37.4686 9.7141L34.9478 10.287C34.8046 9.37035 34.0025 8.22452 32.1692 8.22452C30.3072 8.22452 29.0181 8.42504 29.0181 12.6646C29.0181 16.9042 30.3645 17.3625 32.427 17.3625ZM20.5391 12.8072C20.5391 8.56764 19.2501 8.36712 17.3881 8.36712H15.5834V17.2473H17.3881C19.2501 17.2473 20.5391 17.0468 20.5391 12.8072ZM0 19.968V5.64512H9.10938V8.36647H3.03646V11.2883H7.61979V13.9811H3.03646V17.2467H9.10938V19.968H0Z" fill="currentColor"></path></svg></a></div><div class="pageNav_mobileNavSocials__Kfe1r"><div class="pageNav_githubStars__meN0H pageNav_hideOnDesktop__cw3PB"><a href="https://github.com/edgedb/edgedb"><svg width="35" height="35" viewBox="0 0 35 35"><path d="M17.499 4.284c-7.483 0-13.55 6.067-13.55 13.55 0 5.988 3.883 11.066 9.267 12.86.678.123.925-.295.925-.655 0-.32-.011-1.173-.018-2.304-3.77.819-4.564-1.817-4.564-1.817-.617-1.565-1.505-1.982-1.505-1.982-1.23-.84.093-.824.093-.824 1.36.096 2.075 1.397 2.075 1.397 1.21 2.07 3.172 1.472 3.944 1.126.123-.876.473-1.473.86-1.811-3.008-.342-6.172-1.505-6.172-6.698 0-1.479.528-2.688 1.395-3.636-.14-.343-.605-1.72.132-3.586 0 0 1.138-.365 3.727 1.389 1.08-.301 2.24-.45 3.392-.456 1.15.005 2.31.155 3.393.456 2.587-1.754 3.722-1.39 3.722-1.39.74 1.867.275 3.244.135 3.587.869.948 1.394 2.157 1.394 3.636 0 5.206-3.169 6.351-6.188 6.687.487.418.92 1.245.92 2.51 0 1.81-.016 3.272-.016 3.716 0 .363.243.785.931.652 5.38-1.796 9.26-6.87 9.26-12.856 0-7.484-6.068-13.551-13.552-13.551" fill="currentColor" fill-rule="evenodd"></path></svg><span>12.9k</span></a></div><a class="pageNav_discord__yhl_6 pageNav_hideOnDesktop__cw3PB" href="https://discord.gg/edgedb"><svg width="35" height="35" viewBox="0 0 35 35" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M28.7657 7.07236C26.6752 6.11316 24.4334 5.40646 22.0896 5.0017C22.0469 4.99389 22.0042 5.01341 21.9823 5.05245C21.694 5.56523 21.3746 6.23419 21.151 6.75999C18.63 6.38257 16.1219 6.38257 13.6526 6.75999C13.4289 6.2225 13.098 5.56523 12.8084 5.05245C12.7864 5.01471 12.7438 4.99519 12.7011 5.0017C10.3585 5.40516 8.11677 6.11186 6.02498 7.07236C6.00687 7.08017 5.99135 7.0932 5.98105 7.11011C1.72894 13.4627 0.564116 19.6591 1.13554 25.7787C1.13813 25.8086 1.15493 25.8372 1.1782 25.8554C3.98362 27.9157 6.70115 29.1664 9.36821 29.9954C9.41089 30.0085 9.45612 29.9929 9.48328 29.9577C10.1142 29.0962 10.6766 28.1877 11.1588 27.2324C11.1872 27.1764 11.16 27.1101 11.1019 27.0879C10.2098 26.7496 9.36045 26.337 8.54338 25.8685C8.47876 25.8307 8.47358 25.7383 8.53304 25.694C8.70498 25.5652 8.87696 25.4311 9.04114 25.2958C9.07085 25.2711 9.11224 25.2658 9.14716 25.2815C14.5149 27.7322 20.3261 27.7322 25.6306 25.2815C25.6655 25.2645 25.7069 25.2698 25.7379 25.2945C25.9021 25.4298 26.074 25.5652 26.2473 25.694C26.3067 25.7383 26.3029 25.8307 26.2382 25.8685C25.4212 26.3461 24.5718 26.7496 23.6784 27.0866C23.6203 27.1088 23.5944 27.1764 23.6229 27.2324C24.1154 28.1864 24.6778 29.0948 25.297 29.9564C25.3229 29.9929 25.3694 30.0085 25.4121 29.9954C28.0921 29.1664 30.8096 27.9157 33.615 25.8554C33.6396 25.8372 33.6551 25.8099 33.6577 25.7799C34.3416 18.705 32.5122 12.5594 28.8083 7.1114C28.7993 7.0932 28.7838 7.08017 28.7657 7.07236ZM11.9603 22.0525C10.3443 22.0525 9.01269 20.5688 9.01269 18.7467C9.01269 16.9246 10.3185 15.4409 11.9603 15.4409C13.6151 15.4409 14.9338 16.9376 14.9079 18.7467C14.9079 20.5688 13.6022 22.0525 11.9603 22.0525ZM22.8588 22.0525C21.2428 22.0525 19.9112 20.5688 19.9112 18.7467C19.9112 16.9246 21.2169 15.4409 22.8588 15.4409C24.5136 15.4409 25.8323 16.9376 25.8064 18.7467C25.8064 20.5688 24.5136 22.0525 22.8588 22.0525Z" fill="currentColor"></path></svg></a></div><div class="pageNav_content__cpE96"><div class="pageNav_pageNav__WKW_2" style="display:contents"><nav><ul class="pageNav_links__YuK5G"><li class="pageNav_textLink__Nx8DP"><a href="https://www.edgedb.com/"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M8.6756 0.262418L11.9999 3.11172L12 1.99994C12.0001 1.44766 12.4478 0.999995 13.0001 1.00006C13.5524 1.00012 14.0001 1.44789 14 2.00017L13.9997 4.8258L15.6505 6.24077C16.0698 6.60018 16.1184 7.23148 15.759 7.65081C15.5614 7.88136 15.2816 7.99983 15 8.00005L14.994 8H14V15C14 15.5523 13.5523 16 13 16H3C2.44772 16 2 15.5523 2 15V8H1C0.718338 7.99987 0.438422 7.88135 0.240748 7.65072C-0.118665 7.23138 -0.070091 6.60008 0.349242 6.24067L7.32924 0.258063C7.41887 0.176878 7.52032 0.114559 7.62811 0.071533C7.97892 -0.0690937 8.38887 -0.000787675 8.6756 0.262418ZM7 8C6.44772 8 6 8.44772 6 9V13C6 13.5523 6.44772 14 7 14H9C9.55229 14 10 13.5523 10 13V9C10 8.44772 9.55229 8 9 8H7Z"></path></svg><span>Home</span></a></li><li class="pageNav_textLink__Nx8DP"><a href="https://www.edgedb.com/cloud"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M13.7883 11.0166C13.9263 10.5347 14 10.0259 14 9.5C14 6.4624 11.5376 4 8.5 4C5.95215 4 3.80908 5.73242 3.18408 8.0835C1.36621 8.46045 0 10.0703 0 12C0 14.209 1.79077 16 4 16H13.5C14.8806 16 16 14.8809 16 13.5C16 12.2168 15.0332 11.1597 13.7883 11.0166Z" fill="currentColor"></path><path d="M13.7883 11.0166C13.9263 10.5347 14 10.0259 14 9.5C14 6.4624 11.5376 4 8.5 4C5.95215 4 3.80908 5.73242 3.18408 8.0835C1.36621 8.46045 0 10.0703 0 12C0 14.209 1.79077 16 4 16H13.5C14.8806 16 16 14.8809 16 13.5C16 12.2168 15.0332 11.1597 13.7883 11.0166Z" fill="currentColor"></path></svg><span>Cloud</span></a></li><li class="pageNav_textLink__Nx8DP"><a href="https://www.edgedb.com/pricing"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M8 16C12.4182 16 16 12.4185 16 8C16 3.58154 12.4182 0 8 0C3.58179 0 0 3.58154 0 8C0 12.4185 3.58179 16 8 16ZM9 2V3.07373C10.2756 3.27344 11.3125 3.88867 11.8943 5.05273C11.9805 5.2251 12.0122 5.41064 11.9961 5.58936C11.9658 5.92285 11.7688 6.23389 11.4473 6.39453C10.9531 6.6416 10.3525 6.44141 10.1055 5.94727C9.83325 5.40283 9.27222 5 8 5C6.2666 5 6 5.7998 6 6C6 6.2002 6.2666 7 8 7C10.2666 7 12 8.2002 12 10C12 11.5239 10.7571 12.6182 9 12.9175V14C9 14.5522 8.55225 15 8 15C7.44775 15 7 14.5522 7 14V12.9263C5.72437 12.7266 4.6875 12.1113 4.10547 10.9473C3.85864 10.4531 4.05884 9.85254 4.55273 9.60547C4.72852 9.51758 4.91772 9.48633 5.09961 9.50488C5.4292 9.53809 5.73535 9.73438 5.89429 10.0527C6.16675 10.5972 6.72778 11 8 11C9.7334 11 10 10.2002 10 10C10 9.7998 9.7334 9 8 9C5.7334 9 4 7.7998 4 6C4 4.47607 5.24292 3.38184 7 3.08252V2C7 1.44775 7.44775 1 8 1C8.55225 1 9 1.44775 9 2Z" fill="currentColor"></path></svg><span>Pricing</span></a></li><li class="pageNav_textLink__Nx8DP"><a href="https://docs.edgedb.com/"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.9986 3.5V0H1.99855C0.894048 0 -0.00146484 0.895386 -0.00146484 2V14C-0.00146484 15.1046 0.894048 16 1.99855 16H13.9986C15.1031 16 15.9986 15.1046 15.9986 14V13L15.9993 5H12.4986C11.6702 5 10.9986 4.32843 10.9986 3.5ZM11.9986 3.5V0L15.9986 4H12.4986C12.2225 4 11.9986 3.77614 11.9986 3.5ZM3.49855 8C3.22241 8 2.99855 8.22386 2.99855 8.5C2.99855 8.77614 3.22241 9 3.49855 9H12.4986C12.7747 9 12.9986 8.77614 12.9986 8.5C12.9986 8.22386 12.7747 8 12.4986 8H3.49855ZM2.99855 10.5C2.99855 10.2239 3.22241 10 3.49855 10H12.4986C12.7747 10 12.9986 10.2239 12.9986 10.5C12.9986 10.7761 12.7747 11 12.4986 11H3.49855C3.22241 11 2.99855 10.7761 2.99855 10.5ZM3.49855 12C3.22241 12 2.99855 12.2239 2.99855 12.5C2.99855 12.7761 3.22241 13 3.49855 13H12.4986C12.7747 13 12.9986 12.7761 12.9986 12.5C12.9986 12.2239 12.7747 12 12.4986 12H3.49855Z"></path></svg><span>Docs</span></a></li><li class="pageNav_textLink__Nx8DP pageNav_activeLink__RNeRg"><a href="https://www.edgedb.com/blog"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M14 0C15.1045 0 16 0.895386 16 2L16.001 2.0022L16 13V14C16 15.1046 15.1045 16 14 16H2C0.895508 16 0 15.1046 0 14V2C0 0.895386 0.895508 0 2 0H14ZM3 4.0022C3 3.44991 3.44772 3.0022 4 3.0022H12C12.5523 3.0022 13 3.44991 13 4.0022V5.0022C13 5.55449 12.5523 6.0022 12 6.0022H4C3.44772 6.0022 3 5.55449 3 5.0022V4.0022ZM3.5 8.0022C3.22386 8.0022 3 8.22606 3 8.5022C3 8.77834 3.22386 9.0022 3.5 9.0022H12.5C12.7761 9.0022 13 8.77834 13 8.5022C13 8.22606 12.7761 8.0022 12.5 8.0022H3.5ZM3 10.5022C3 10.2261 3.22386 10.0022 3.5 10.0022H12.5C12.7761 10.0022 13 10.2261 13 10.5022C13 10.7783 12.7761 11.0022 12.5 11.0022H3.5C3.22386 11.0022 3 10.7783 3 10.5022ZM3.5 12.0022C3.22386 12.0022 3 12.2261 3 12.5022C3 12.7783 3.22386 13.0022 3.5 13.0022H12.5C12.7761 13.0022 13 12.7783 13 12.5022C13 12.2261 12.7761 12.0022 12.5 12.0022H3.5Z"></path></svg><span>Blog</span></a></li><li class="pageNav_textLink__Nx8DP"><a href="https://www.edgedb.com/updates"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M14 0C15.1045 0 16 0.895386 16 2L16.001 2.0022L16 13V14C16 15.1046 15.1045 16 14 16H2C0.895508 16 0 15.1046 0 14V2C0 0.895386 0.895508 0 2 0H14ZM3 4.0022C3 3.44991 3.44772 3.0022 4 3.0022H12C12.5523 3.0022 13 3.44991 13 4.0022V5.0022C13 5.55449 12.5523 6.0022 12 6.0022H4C3.44772 6.0022 3 5.55449 3 5.0022V4.0022ZM3.5 8.0022C3.22386 8.0022 3 8.22606 3 8.5022C3 8.77834 3.22386 9.0022 3.5 9.0022H12.5C12.7761 9.0022 13 8.77834 13 8.5022C13 8.22606 12.7761 8.0022 12.5 8.0022H3.5ZM3 10.5022C3 10.2261 3.22386 10.0022 3.5 10.0022H12.5C12.7761 10.0022 13 10.2261 13 10.5022C13 10.7783 12.7761 11.0022 12.5 11.0022H3.5C3.22386 11.0022 3 10.7783 3 10.5022ZM3.5 12.0022C3.22386 12.0022 3 12.2261 3 12.5022C3 12.7783 3.22386 13.0022 3.5 13.0022H12.5C12.7761 13.0022 13 12.7783 13 12.5022C13 12.2261 12.7761 12.0022 12.5 12.0022H3.5Z"></path></svg><span>Updates</span></a></li><div class="pageNav_githubStars__meN0H"><a href="https://github.com/edgedb/edgedb"><svg width="35" height="35" viewBox="0 0 35 35"><path d="M17.499 4.284c-7.483 0-13.55 6.067-13.55 13.55 0 5.988 3.883 11.066 9.267 12.86.678.123.925-.295.925-.655 0-.32-.011-1.173-.018-2.304-3.77.819-4.564-1.817-4.564-1.817-.617-1.565-1.505-1.982-1.505-1.982-1.23-.84.093-.824.093-.824 1.36.096 2.075 1.397 2.075 1.397 1.21 2.07 3.172 1.472 3.944 1.126.123-.876.473-1.473.86-1.811-3.008-.342-6.172-1.505-6.172-6.698 0-1.479.528-2.688 1.395-3.636-.14-.343-.605-1.72.132-3.586 0 0 1.138-.365 3.727 1.389 1.08-.301 2.24-.45 3.392-.456 1.15.005 2.31.155 3.393.456 2.587-1.754 3.722-1.39 3.722-1.39.74 1.867.275 3.244.135 3.587.869.948 1.394 2.157 1.394 3.636 0 5.206-3.169 6.351-6.188 6.687.487.418.92 1.245.92 2.51 0 1.81-.016 3.272-.016 3.716 0 .363.243.785.931.652 5.38-1.796 9.26-6.87 9.26-12.856 0-7.484-6.068-13.551-13.552-13.551" fill="currentColor" fill-rule="evenodd"></path></svg><span>12.9k</span></a></div><a class="pageNav_discord__yhl_6" href="https://discord.gg/edgedb"><svg width="35" height="35" viewBox="0 0 35 35" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M28.7657 7.07236C26.6752 6.11316 24.4334 5.40646 22.0896 5.0017C22.0469 4.99389 22.0042 5.01341 21.9823 5.05245C21.694 5.56523 21.3746 6.23419 21.151 6.75999C18.63 6.38257 16.1219 6.38257 13.6526 6.75999C13.4289 6.2225 13.098 5.56523 12.8084 5.05245C12.7864 5.01471 12.7438 4.99519 12.7011 5.0017C10.3585 5.40516 8.11677 6.11186 6.02498 7.07236C6.00687 7.08017 5.99135 7.0932 5.98105 7.11011C1.72894 13.4627 0.564116 19.6591 1.13554 25.7787C1.13813 25.8086 1.15493 25.8372 1.1782 25.8554C3.98362 27.9157 6.70115 29.1664 9.36821 29.9954C9.41089 30.0085 9.45612 29.9929 9.48328 29.9577C10.1142 29.0962 10.6766 28.1877 11.1588 27.2324C11.1872 27.1764 11.16 27.1101 11.1019 27.0879C10.2098 26.7496 9.36045 26.337 8.54338 25.8685C8.47876 25.8307 8.47358 25.7383 8.53304 25.694C8.70498 25.5652 8.87696 25.4311 9.04114 25.2958C9.07085 25.2711 9.11224 25.2658 9.14716 25.2815C14.5149 27.7322 20.3261 27.7322 25.6306 25.2815C25.6655 25.2645 25.7069 25.2698 25.7379 25.2945C25.9021 25.4298 26.074 25.5652 26.2473 25.694C26.3067 25.7383 26.3029 25.8307 26.2382 25.8685C25.4212 26.3461 24.5718 26.7496 23.6784 27.0866C23.6203 27.1088 23.5944 27.1764 23.6229 27.2324C24.1154 28.1864 24.6778 29.0948 25.297 29.9564C25.3229 29.9929 25.3694 30.0085 25.4121 29.9954C28.0921 29.1664 30.8096 27.9157 33.615 25.8554C33.6396 25.8372 33.6551 25.8099 33.6577 25.7799C34.3416 18.705 32.5122 12.5594 28.8083 7.1114C28.7993 7.0932 28.7838 7.08017 28.7657 7.07236ZM11.9603 22.0525C10.3443 22.0525 9.01269 20.5688 9.01269 18.7467C9.01269 16.9246 10.3185 15.4409 11.9603 15.4409C13.6151 15.4409 14.9338 16.9376 14.9079 18.7467C14.9079 20.5688 13.6022 22.0525 11.9603 22.0525ZM22.8588 22.0525C21.2428 22.0525 19.9112 20.5688 19.9112 18.7467C19.9112 16.9246 21.2169 15.4409 22.8588 15.4409C24.5136 15.4409 25.8323 16.9376 25.8064 18.7467C25.8064 20.5688 24.5136 22.0525 22.8588 22.0525Z" fill="currentColor"></path></svg></a><a class="pageNav_mobLoginLink__IIKxK" href="https://cloud.edgedb.com/"><svg width="16" height="24" viewBox="0 0 16 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M4 18C1.79086 18 0 16.2091 0 14C0 11.791 1.79066 10.0002 3.99963 10C4.91184 8.78555 6.36418 8 8 8C10.4195 8 12.4377 9.71858 12.9003 12.0016C12.9334 12.0005 12.9666 12 13 12C14.6569 12 16 13.3431 16 15C16 16.6569 14.6569 18 13 18H8H4Z" fill="currentColor"></path></svg>Cloud Login</a></ul></nav><div class="pageNav_navMenu__vU6m6"><svg width="21" height="19" viewBox="0 0 21 19" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M0 0H21V3H0V0ZM0 8H21V11H0V8ZM21 16H0V19H21V16Z" fill="currentColor"></path></svg></div></div></div><a class="pageNav_loginLink__T_rmy" href="https://cloud.edgedb.com/"><svg width="16" height="24" viewBox="0 0 16 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M4 18C1.79086 18 0 16.2091 0 14C0 11.791 1.79066 10.0002 3.99963 10C4.91184 8.78555 6.36418 8 8 8C10.4195 8 12.4377 9.71858 12.9003 12.0016C12.9334 12.0005 12.9666 12 13 12C14.6569 12 16 13.3431 16 15C16 16.6569 14.6569 18 13 18H8H4Z" fill="currentColor"></path></svg>Login</a></div></div><div class="globalPageWrapperBlog"><div class="toc_blogToC__GiEHe"><ul class="toc_toc___Uhji"><a href="https://www.edgedb.com/blog/an-approach-to-optimizing-typescript-type-checking-performance#setting-the-stage"><li class="toc_active__nz8dO"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 16C14.2091 16 16 14.2091 16 12C16 9.79086 14.2091 8 12 8C9.79086 8 8 9.79086 8 12C8 14.2091 9.79086 16 12 16Z" fill="currentColor"></path></svg><span class="">Setting the stage</span></li></a><a href="https://www.edgedb.com/blog/an-approach-to-optimizing-typescript-type-checking-performance#how-do-we-quantify-the-type-checker-s-workload"><li class=""><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 16C14.2091 16 16 14.2091 16 12C16 9.79086 14.2091 8 12 8C9.79086 8 8 9.79086 8 12C8 14.2091 9.79086 16 12 16Z" fill="currentColor"></path></svg><span class="">How do we quantify the type checker’s workload?</span></li></a><a href="https://www.edgedb.com/blog/an-approach-to-optimizing-typescript-type-checking-performance#marking-the-workbench"><li class=""><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 16C14.2091 16 16 14.2091 16 12C16 9.79086 14.2091 8 12 8C9.79086 8 8 9.79086 8 12C8 14.2091 9.79086 16 12 16Z" fill="currentColor"></path></svg><span class="">Marking the workbench</span></li></a><a href="https://www.edgedb.com/blog/an-approach-to-optimizing-typescript-type-checking-performance#the-bam-method"><li class=""><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 16C14.2091 16 16 14.2091 16 12C16 9.79086 14.2091 8 12 8C9.79086 8 8 9.79086 8 12C8 14.2091 9.79086 16 12 16Z" fill="currentColor"></path></svg><span class="">The BAM Method</span></li></a><a href="https://www.edgedb.com/blog/an-approach-to-optimizing-typescript-type-checking-performance#some-general-advice"><li class=""><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 16C14.2091 16 16 14.2091 16 12C16 9.79086 14.2091 8 12 8C9.79086 8 8 9.79086 8 12C8 14.2091 9.79086 16 12 16Z" fill="currentColor"></path></svg><span class="">Some general advice</span></li></a><a href="https://www.edgedb.com/blog/an-approach-to-optimizing-typescript-type-checking-performance#the-next-generation-of-performance-tools"><li class=""><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 16C14.2091 16 16 14.2091 16 12C16 9.79086 14.2091 8 12 8C9.79086 8 8 9.79086 8 12C8 14.2091 9.79086 16 12 16Z" fill="currentColor"></path></svg><span class="">The next generation of performance tools</span></li></a></ul></div><div class="blogPost_pageContent__U8AKt" data-theme="dark"><div class="blogPost_postHeader__qiLM0"><span class="blogPost_publishedOn__Ws2ev">August 08, 2024</span><h1>An approach to optimizing TypeScript type checking performance</h1><div class="blogAuthors_postAuthorCards__81eO7"><div class="blogAuthors_authorCard__qdh4V"><img src="./s_files/1682194"><div class="blogAuthors_authorDetails__QFJs0"><span>Scott Trinh</span><a href="https://github.com/scotttrinh" target="_blank" class="blogAuthors_profileName__W5nkD">@<!-- -->scotttrinh</a></div></div></div><div class="lazyImage_wrapper__f6_0z blogPost_leadImage__hqdWj"><img src="./s_files/4196cf87ed3e24e8d86af535487dd9b0db7e21ee-940.webp" width="1920" height="800" loading="lazy" srcset="/_images/_blog/4196cf87ed3e24e8d86af535487dd9b0db7e21ee-940.webp 940w, /_images/_blog/4196cf87ed3e24e8d86af535487dd9b0db7e21ee-940-2x.webp 1880w, /_images/_blog/4196cf87ed3e24e8d86af535487dd9b0db7e21ee-770.webp 770w, /_images/_blog/4196cf87ed3e24e8d86af535487dd9b0db7e21ee-770-2x.webp 1540w" sizes="(max-width: 1920px) 940px, (max-width: 1440px) 840px, (max-width: 1024px) 680px, (max-width: 768px) 100vw, 1120px"><div class="lazyImage_placeholder__z1C_i lazyImage_loaded___tDl9 lazyImage_transition__gEVMC" style="background-image:url(data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wAARCAAhAFADASIAAhEBAxEB/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/8QAHwEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoL/8QAtREAAgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHBCSMzUvAVYnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6goOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4uPk5ebn6Onq8vP09fb3+Pn6/9oADAMBAAIRAxEAPwDjgM0Yp44oA5q7E3GkYFJWnbaek1ukjOwLDoKhvbRLbYFYsGz1rR0pJcxCqRbsUqAMnFXprSFfNVHcvEASCBg0TWsMcmwGXcWAyV4pezaD2iKIHI9KMc4q+1rD8wjd8o4Vsgdzio7iGGIkIZC6tj5hxQ6bSBTTKlGOKcBx9aXFRYu4UZ6UzPGKM80XCxpw3UAt4UfO5Dk/Lmq9zKjqgQ52knp/nNVM0A4q3UbViFTSdy9c3m9pBGqhGwC23k06eeKSUSCaQgMCEK8CqBOc+lGflp+0b3D2aNCS9WQYLEYl3DA6rUFxcvNI43sYy2QDVUHFLu60nUb3BQS2HCimZ5zSk5qLl2G0UUUhhRRRQAUUUUAFFFFABRRRQB//2Q==)"></div></div></div><div class="blogPost_postContent__0Riqu"><div class="base_rstWrapper__CejKd ">
<!-- -->
<!-- -->
<!-- -->
<!-- -->
<!-- -->
<section data-section-id="an-approach-to-optimizing-typescript-type-checking-performance" id="an-approach-to-optimizing-typescript-type-checking-performance" class="base_section__z_4nJ blogPost_section__aSmVz">
<!-- -->
<div class=" base_note____VWE blogPost_note__L3az7">
<p class="">Check out the discussion of this post on
                <a href="https://news.ycombinator.com/item?id=41226548" class="">Hacker News</a>.</p>
</div>
<p class="">As developers, we spend much of our time thinking about the runtime performance of our code. Things like asymptotic runtime complexity, cache misses, and memory usage are all important factors to consider. However, one area of performance that can be difficult to optimize is TypeScript’s type checking performance. This manifests as sluggish IDE responsiveness, extended compile times, or in extreme cases, TypeScript compiler crashes due to memory exhaustion.</p>
<p class="">When you run into one of these types of performance issues related to type-checking, it can be hard to how to start troubleshooting. Unlike runtime performance problems, we can’t rely on our usual debugging approaches. The type checker operates within the TypeScript compiler during build time and the language server in your editor while editing, making it challenging to apply conventional debugging approaches.</p>
<p class="">While the <a href="https://github.com/microsoft/TypeScript/wiki/Performance" class="">TypeScript team provides general guidance about type performance in their wiki</a>, it can be daunting to determine how to effectively measure type checker performance and identify appropriate strategies to address any discovered issues.</p>
<p class="">We recently faced a similar challenge when TypeScript 5.3 introduced changes to the type inference algorithm, resulting in a significant performance regression. So much so, that certain parts of our test suite would cause the TypeScript compiler to run out of memory, and froze any attempt to use the language server. It was time to roll up our sleeves and come up with a plan for measuring and improving the type inference performance of this specific construct.</p>
<p class="">As we worked through this problem, we were struck by the scarcity of detailed information on effective workflows beyond the basic advice to use <code class="">--extendedDiagnostics</code> and <code class="">--generateTrace</code>. This led us to explore the landscape of available tools and devise a strategy to leverage them effectively.</p>
<p class="">In this article, we’ll walk you through the approach we used and share some workflow tips along the way. We’ll use a simplified example, but keep in mind that our actual issue involved a more complex variation of the problem we’ll discuss.</p>
<p class="">Before we dive in, I’d like to extend special thanks to:</p>
<ul class="">
<li class="">
<p class="">My colleague at EdgeDB, Aleksandra Sikora, for her extensive work on TypeScript performance measurement and analysis.</p>
</li>
<li class="">
<p class="">David Blass for the excellent <a href="https://arktype.io/" class="">arktype</a> library and <code class="">attest</code> testing framework, and for his invaluable feedback on this article.</p>
</li>
<li class="">
<p class="">Larry Layland for his helpful suggestions during the review of this article.</p>
</li>
<li class="">
<p class="">The TypeScript team, especially those involved in documentation, for their guidance.</p>
</li>
</ul>
<div data-section-id="setting-the-stage" id="setting-the-stage" class="base_section__z_4nJ blogPost_section__aSmVz">
<h2 id="setting-the-stage" class="headerLink_header__L_1Jm">Setting the stage<span class="headerLink_popupWrapper__fYhfO">​<div class="headerLink_linkPopup__K0HFc"><div class="headerLink_popupBg__g_IfY"></div><div class="headerLink_linksInner__mj5XG"><a href="https://www.edgedb.com/blog/an-approach-to-optimizing-typescript-type-checking-performance#setting-the-stage"><svg width="18" height="14" viewBox="0 0 18 14" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10 2H3C2.44772 2 2 2.44772 2 3V7C2 7.55228 2.44772 8 3 8H10C10.5523 8 11 7.55228 11 7H13C13 8.65685 11.6569 10 10 10H3C1.34315 10 0 8.65685 0 7V3C0 1.34315 1.34315 0 3 0H10C11.6569 0 13 1.34315 13 3H11C11 2.44772 10.5523 2 10 2ZM15 6H8C7.44772 6 7 6.44772 7 7H5C5 5.34315 6.34315 4 8 4H15C16.6569 4 18 5.34315 18 7V11C18 12.6569 16.6569 14 15 14H8C6.34315 14 5 12.6569 5 11H7C7 11.5523 7.44772 12 8 12H15C15.5523 12 16 11.5523 16 11V7C16 6.44771 15.5523 6 15 6Z" fill="currentColor"></path></svg></a></div></div></span></h2>
<p class="">The EdgeDB query builder introspects the database to determine the valid operators as defined by the database itself, which includes the valid operands for a given operator, and it’s return type and cardinality. This information is used to create a set of overloads, 376 overloads in our initial implementation, for the <code class="">e.op</code> function, which is used to create expressions in the query builder.</p>
<p class="">For example:</p>
<div class="code_code__f6VbY code-language-typescript  blogPost_codeBlock__DLXTS" style="--maxLineLength:64;--code-max-height:12"><div class="code_highlightWrapper__8YM2j code_hasCopyButton__vL2_6"><div class="code_copyCodeButtonWrapper__gi2zF"><div class="code_copyCode__EvySm"><svg width="13" height="15" viewBox="0 0 13 15" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="3.5" y="3.5" width="9" height="11" rx="1.5" stroke="currentColor"></rect><rect width="10" height="12" rx="2" fill="currentColor"></rect></svg><span class="code_copyLabel__9W53T">Copy</span></div></div><div class="code_block__73rl_" translate="no"><pre><span class="tokens tokens-normal">e<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>User<span class="token punctuation">,</span> <span class="token punctuation">(</span>u<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  accountAge<span class="token operator">:</span> e<span class="token punctuation">.</span><span class="token function">op</span><span class="token punctuation">(</span>u<span class="token punctuation">.</span>createdAt<span class="token punctuation">,</span> <span class="token string">"-"</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span><span class="token function">datetime_of_statement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></pre></div></div></div>
<p class="">In this example, the <code class="">e.op</code> function will find the overload that takes a <code class="">datetime</code> value as the first operand, the string <code class="">"-"</code> as the operator, and another <code class="">datetime</code> as the second operand. It will find such an overload, and the return type of the expression will have an element type of <code class="">duration</code> with a cardinality of <code class="">One</code> (assuming <code class="">createdAt</code> is a required property).</p>
<p class="">However, it should give us a type error if, for instance, you tried to have a <code class="">str</code> type as the second operand, or tried to provide an operator like <code class="">ilike</code> (which is only defined for <code class="">str</code> operands).</p>
<p class="">Our query builder works with expression-based data, similar to an abstract syntax tree (AST) - a tree representation of the structure of code. Instead of TypeScript primitives, we use objects representing expressions of those types. These expressions can be combined and nested, much like how elements in an AST relate to each other. For this example, we’ll define <code class="">$Number</code>, <code class="">$String</code>, and <code class="">$Boolean</code> data types, along with operators that work with various combinations of these types. This approach allows us to model complex queries as composable expressions.</p>
<div class=" base_note____VWE blogPost_note__L3az7">
<p class="">In the actual query builder’s generated code, operands for scalar types are more complex. They can accept either literal scalars (such as <code class="">"a"</code> or <code class="">true</code>) or expressions of that type (like <code class="">e.select(someUser).name</code>). Due to this complexity, the approach we ultimately adopted is more sophisticated than the ones we’ll explore in this post.</p>
</div>
<p class="">Let’s take a look at one such operator, the <code class="">=</code> operator which should take operands of the same type, and return a <code class="">$Boolean</code> with a cardinality of <code class="">One</code>.</p>
<p class="">Our initial approach was to define operators like this:</p>
<div class="code_code__f6VbY code-language-typescript  blogPost_codeBlock__DLXTS" style="--maxLineLength:76;--code-max-height:12"><div class="code_highlightWrapper__8YM2j code_hasCopyButton__vL2_6"><div class="code_copyCodeButtonWrapper__gi2zF"><div class="code_copyCode__EvySm"><svg width="13" height="15" viewBox="0 0 13 15" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="3.5" y="3.5" width="9" height="11" rx="1.5" stroke="currentColor"></rect><rect width="10" height="12" rx="2" fill="currentColor"></rect></svg><span class="code_copyLabel__9W53T">Copy</span></div></div><div class="code_block__73rl_" translate="no"><pre><span class="tokens tokens-normal"><span class="token keyword">function</span> <span class="token generic-function"><span class="token function">op</span><span class="token generic class-name"><span class="token operator">&lt;</span>Opr1 <span class="token keyword">extends</span> TypeSet<span class="token operator">&lt;</span>$String<span class="token operator">&gt;</span><span class="token punctuation">,</span> Opr2 <span class="token keyword">extends</span> TypeSet<span class="token operator">&lt;</span>$String<span class="token operator">&gt;&gt;</span></span></span><span class="token punctuation">(</span>
  opr1<span class="token operator">:</span> Opr1<span class="token punctuation">,</span>
  op<span class="token operator">:</span> <span class="token string">"="</span><span class="token punctuation">,</span>
  opr2<span class="token operator">:</span> Opr2
<span class="token punctuation">)</span><span class="token operator">:</span> TypeSet<span class="token operator">&lt;</span>$Boolean<span class="token punctuation">,</span> Cardinality<span class="token punctuation">.</span>One<span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token generic-function"><span class="token function">op</span><span class="token generic class-name"><span class="token operator">&lt;</span>Opr1 <span class="token keyword">extends</span> TypeSet<span class="token operator">&lt;</span>$Number<span class="token operator">&gt;</span><span class="token punctuation">,</span> Opr2 <span class="token keyword">extends</span> TypeSet<span class="token operator">&lt;</span>$Number<span class="token operator">&gt;&gt;</span></span></span><span class="token punctuation">(</span>
  opr1<span class="token operator">:</span> Opr1<span class="token punctuation">,</span>
  op<span class="token operator">:</span> <span class="token string">"="</span><span class="token punctuation">,</span>
  opr2<span class="token operator">:</span> Opr2
<span class="token punctuation">)</span><span class="token operator">:</span> TypeSet<span class="token operator">&lt;</span>$Boolean<span class="token punctuation">,</span> Cardinality<span class="token punctuation">.</span>One<span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token generic-function"><span class="token function">op</span><span class="token generic class-name"><span class="token operator">&lt;</span>Opr1 <span class="token keyword">extends</span> TypeSet<span class="token operator">&lt;</span>$Boolean<span class="token operator">&gt;</span><span class="token punctuation">,</span> Opr2 <span class="token keyword">extends</span> TypeSet<span class="token operator">&lt;</span>$Boolean<span class="token operator">&gt;&gt;</span></span></span><span class="token punctuation">(</span>
  opr1<span class="token operator">:</span> Opr1<span class="token punctuation">,</span>
  op<span class="token operator">:</span> <span class="token string">"="</span><span class="token punctuation">,</span>
  opr2<span class="token operator">:</span> Opr2
<span class="token punctuation">)</span><span class="token operator">:</span> TypeSet<span class="token operator">&lt;</span>$Boolean<span class="token punctuation">,</span> Cardinality<span class="token punctuation">.</span>One<span class="token operator">&gt;</span><span class="token punctuation">;</span></span></pre></div></div></div>
<p class="">This naive approach works! It only defines overloads for valid operands and returns the correct expression type. It can even be nested since we have an overload defined for booleans:</p>
<div class="code_code__f6VbY code-language-typescript  blogPost_codeBlock__DLXTS" style="--maxLineLength:62;--code-max-height:12"><div class="code_highlightWrapper__8YM2j code_hasCopyButton__vL2_6"><div class="code_copyCodeButtonWrapper__gi2zF"><div class="code_copyCode__EvySm"><svg width="13" height="15" viewBox="0 0 13 15" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="3.5" y="3.5" width="9" height="11" rx="1.5" stroke="currentColor"></rect><rect width="10" height="12" rx="2" fill="currentColor"></rect></svg><span class="code_copyLabel__9W53T">Copy</span></div></div><div class="code_block__73rl_" translate="no"><pre><span class="tokens tokens-normal"><span class="token keyword">import</span> <span class="token punctuation">{</span> $<span class="token builtin">string</span><span class="token punctuation">,</span> $<span class="token builtin">number</span><span class="token punctuation">,</span> $<span class="token builtin">boolean</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./typesystem.js"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> op <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./operators.js"</span><span class="token punctuation">;</span>

<span class="token function">op</span><span class="token punctuation">(</span><span class="token function">$string</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"="</span><span class="token punctuation">,</span> <span class="token function">$string</span><span class="token punctuation">(</span><span class="token string">"b"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">op</span><span class="token punctuation">(</span><span class="token function">$number</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"="</span><span class="token punctuation">,</span> <span class="token function">$number</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">op</span><span class="token punctuation">(</span><span class="token function">op</span><span class="token punctuation">(</span><span class="token function">$string</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"="</span><span class="token punctuation">,</span> <span class="token function">$string</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"="</span><span class="token punctuation">,</span> <span class="token function">$boolean</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">op</span><span class="token punctuation">(</span><span class="token function">$string</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"ilike"</span><span class="token punctuation">,</span> <span class="token function">$string</span><span class="token punctuation">(</span><span class="token string">"Apex"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></pre></div></div></div>
<p class="">The issue with this approach is that the type checker has to go through all of the overloads to find the right match, and as the number of overloads increases, the amount of work the type checker has to do starts to be impacted by how far down the list it has to go to find a matching overload.</p>
<p class="">Let’s create a minimal TypeScript project to explore these concepts more directly. This project will include TypeScript configuration, several TypeScript modules, and a basic package.json file. We’ll use this setup to define a bunch more operators and various combinations, giving us a better sense of the type checking performance in an almost-real-world scenario.</p>
<div class="code_codeTabs__drHgm"><div class="code_tabs__FeTPK"><div class="code_tab__snml_ code_selected__dlkp9">index.ts</div><div class="code_tab__snml_">operators.ts</div><div class="code_tab__snml_">typesystem.ts</div><div class="code_tab__snml_">package.json</div><div class="code_tab__snml_">tsconfig.json</div></div><div class="code_tabContent__B1hng code_selected__dlkp9"><div class="code_code__f6VbY code-language-typescript  blogPost_codeBlock__DLXTS" style="--maxLineLength:62;--code-max-height:12"><div class="code_highlightWrapper__8YM2j code_hasCopyButton__vL2_6"><div class="code_copyCodeButtonWrapper__gi2zF"><div class="code_copyCode__EvySm"><svg width="13" height="15" viewBox="0 0 13 15" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="3.5" y="3.5" width="9" height="11" rx="1.5" stroke="currentColor"></rect><rect width="10" height="12" rx="2" fill="currentColor"></rect></svg><span class="code_copyLabel__9W53T">Copy</span></div></div><div class="code_block__73rl_" translate="no"><pre><span class="tokens tokens-normal"><span class="token keyword">import</span> <span class="token punctuation">{</span> $<span class="token builtin">string</span><span class="token punctuation">,</span> $<span class="token builtin">number</span><span class="token punctuation">,</span> $<span class="token builtin">boolean</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./typesystem.js"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> op <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./operators.js"</span><span class="token punctuation">;</span>

<span class="token function">op</span><span class="token punctuation">(</span><span class="token function">$string</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"="</span><span class="token punctuation">,</span> <span class="token function">$string</span><span class="token punctuation">(</span><span class="token string">"b"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">op</span><span class="token punctuation">(</span><span class="token function">$number</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"="</span><span class="token punctuation">,</span> <span class="token function">$number</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">op</span><span class="token punctuation">(</span><span class="token function">op</span><span class="token punctuation">(</span><span class="token function">$string</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"="</span><span class="token punctuation">,</span> <span class="token function">$string</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"="</span><span class="token punctuation">,</span> <span class="token function">$boolean</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">op</span><span class="token punctuation">(</span><span class="token function">$string</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"ilike"</span><span class="token punctuation">,</span> <span class="token function">$string</span><span class="token punctuation">(</span><span class="token string">"Apex"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></pre></div></div></div></div><div class="code_tabContent__B1hng"><div class="code_code__f6VbY code-language-typescript  blogPost_codeBlock__DLXTS" style="--maxLineLength:75;--code-max-height:12"><div class="code_highlightWrapper__8YM2j code_hasCopyButton__vL2_6"><div class="code_copyCodeButtonWrapper__gi2zF"><div class="code_copyCode__EvySm"><svg width="13" height="15" viewBox="0 0 13 15" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="3.5" y="3.5" width="9" height="11" rx="1.5" stroke="currentColor"></rect><rect width="10" height="12" rx="2" fill="currentColor"></rect></svg><span class="code_copyLabel__9W53T">Copy</span></div></div><div class="code_block__73rl_" translate="no"><pre><span class="tokens tokens-normal"><span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> $String<span class="token punctuation">,</span> $Number<span class="token punctuation">,</span> $Boolean<span class="token punctuation">,</span> TypeSet <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./typesystem.js"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Cardinality <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./typesystem.js"</span><span class="token punctuation">;</span>

<span class="token comment">// String comparisons</span>
<span class="token keyword">function</span> <span class="token generic-function"><span class="token function">op</span><span class="token generic class-name"><span class="token operator">&lt;</span>
  Opr1 <span class="token keyword">extends</span> TypeSet<span class="token operator">&lt;</span>$String<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  Opr2 <span class="token keyword">extends</span> TypeSet<span class="token operator">&lt;</span>$String<span class="token operator">&gt;</span>
<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>
  opr1<span class="token operator">:</span> Opr1<span class="token punctuation">,</span>
  op<span class="token operator">:</span> <span class="token string">"="</span><span class="token punctuation">,</span>
  opr2<span class="token operator">:</span> Opr2
<span class="token punctuation">)</span><span class="token operator">:</span> TypeSet<span class="token operator">&lt;</span>$Boolean<span class="token punctuation">,</span> Cardinality<span class="token punctuation">.</span>One<span class="token operator">&gt;</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token generic-function"><span class="token function">op</span><span class="token generic class-name"><span class="token operator">&lt;</span>
  Opr1 <span class="token keyword">extends</span> TypeSet<span class="token operator">&lt;</span>$String<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  Opr2 <span class="token keyword">extends</span> TypeSet<span class="token operator">&lt;</span>$String<span class="token operator">&gt;</span>
<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>
  opr1<span class="token operator">:</span> Opr1<span class="token punctuation">,</span>
  op<span class="token operator">:</span> <span class="token string">"!="</span><span class="token punctuation">,</span>
  opr2<span class="token operator">:</span> Opr2
<span class="token punctuation">)</span><span class="token operator">:</span> TypeSet<span class="token operator">&lt;</span>$Boolean<span class="token punctuation">,</span> Cardinality<span class="token punctuation">.</span>One<span class="token operator">&gt;</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token generic-function"><span class="token function">op</span><span class="token generic class-name"><span class="token operator">&lt;</span>
  Opr1 <span class="token keyword">extends</span> TypeSet<span class="token operator">&lt;</span>$String<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  Opr2 <span class="token keyword">extends</span> TypeSet<span class="token operator">&lt;</span>$String<span class="token operator">&gt;</span>
<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>
  opr1<span class="token operator">:</span> Opr1<span class="token punctuation">,</span>
  op<span class="token operator">:</span> <span class="token string">"&gt;"</span><span class="token punctuation">,</span>
  opr2<span class="token operator">:</span> Opr2
<span class="token punctuation">)</span><span class="token operator">:</span> TypeSet<span class="token operator">&lt;</span>$Boolean<span class="token punctuation">,</span> Cardinality<span class="token punctuation">.</span>One<span class="token operator">&gt;</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token generic-function"><span class="token function">op</span><span class="token generic class-name"><span class="token operator">&lt;</span>
  Opr1 <span class="token keyword">extends</span> TypeSet<span class="token operator">&lt;</span>$String<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  Opr2 <span class="token keyword">extends</span> TypeSet<span class="token operator">&lt;</span>$String<span class="token operator">&gt;</span>
<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>
  opr1<span class="token operator">:</span> Opr1<span class="token punctuation">,</span>
  op<span class="token operator">:</span> <span class="token string">"&lt;"</span><span class="token punctuation">,</span>
  opr2<span class="token operator">:</span> Opr2
<span class="token punctuation">)</span><span class="token operator">:</span> TypeSet<span class="token operator">&lt;</span>$Boolean<span class="token punctuation">,</span> Cardinality<span class="token punctuation">.</span>One<span class="token operator">&gt;</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token generic-function"><span class="token function">op</span><span class="token generic class-name"><span class="token operator">&lt;</span>
  Opr1 <span class="token keyword">extends</span> TypeSet<span class="token operator">&lt;</span>$String<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  Opr2 <span class="token keyword">extends</span> TypeSet<span class="token operator">&lt;</span>$String<span class="token operator">&gt;</span>
<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>
  opr1<span class="token operator">:</span> Opr1<span class="token punctuation">,</span>
  op<span class="token operator">:</span> <span class="token string">"&gt;="</span><span class="token punctuation">,</span>
  opr2<span class="token operator">:</span> Opr2
<span class="token punctuation">)</span><span class="token operator">:</span> TypeSet<span class="token operator">&lt;</span>$Boolean<span class="token punctuation">,</span> Cardinality<span class="token punctuation">.</span>One<span class="token operator">&gt;</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token generic-function"><span class="token function">op</span><span class="token generic class-name"><span class="token operator">&lt;</span>
  Opr1 <span class="token keyword">extends</span> TypeSet<span class="token operator">&lt;</span>$String<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  Opr2 <span class="token keyword">extends</span> TypeSet<span class="token operator">&lt;</span>$String<span class="token operator">&gt;</span>
<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>
  opr1<span class="token operator">:</span> Opr1<span class="token punctuation">,</span>
  op<span class="token operator">:</span> <span class="token string">"&lt;="</span><span class="token punctuation">,</span>
  opr2<span class="token operator">:</span> Opr2
<span class="token punctuation">)</span><span class="token operator">:</span> TypeSet<span class="token operator">&lt;</span>$Boolean<span class="token punctuation">,</span> Cardinality<span class="token punctuation">.</span>One<span class="token operator">&gt;</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token generic-function"><span class="token function">op</span><span class="token generic class-name"><span class="token operator">&lt;</span>
  Opr1 <span class="token keyword">extends</span> TypeSet<span class="token operator">&lt;</span>$String<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  Opr2 <span class="token keyword">extends</span> TypeSet<span class="token operator">&lt;</span>$String<span class="token operator">&gt;</span>
<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>
  opr1<span class="token operator">:</span> Opr1<span class="token punctuation">,</span>
  op<span class="token operator">:</span> <span class="token string">"?="</span><span class="token punctuation">,</span>
  opr2<span class="token operator">:</span> Opr2
<span class="token punctuation">)</span><span class="token operator">:</span> TypeSet<span class="token operator">&lt;</span>$Boolean<span class="token punctuation">,</span> Cardinality<span class="token punctuation">.</span>AtMostOne<span class="token operator">&gt;</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token generic-function"><span class="token function">op</span><span class="token generic class-name"><span class="token operator">&lt;</span>
  Opr1 <span class="token keyword">extends</span> TypeSet<span class="token operator">&lt;</span>$String<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  Opr2 <span class="token keyword">extends</span> TypeSet<span class="token operator">&lt;</span>$String<span class="token operator">&gt;</span>
<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>
  opr1<span class="token operator">:</span> Opr1<span class="token punctuation">,</span>
  op<span class="token operator">:</span> <span class="token string">"?!="</span><span class="token punctuation">,</span>
  opr2<span class="token operator">:</span> Opr2
<span class="token punctuation">)</span><span class="token operator">:</span> TypeSet<span class="token operator">&lt;</span>$Boolean<span class="token punctuation">,</span> Cardinality<span class="token punctuation">.</span>AtMostOne<span class="token operator">&gt;</span><span class="token punctuation">;</span>

<span class="token comment">// Number comparisons</span>
<span class="token keyword">function</span> <span class="token generic-function"><span class="token function">op</span><span class="token generic class-name"><span class="token operator">&lt;</span>
  Opr1 <span class="token keyword">extends</span> TypeSet<span class="token operator">&lt;</span>$Number<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  Opr2 <span class="token keyword">extends</span> TypeSet<span class="token operator">&lt;</span>$Number<span class="token operator">&gt;</span>
<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>
  opr1<span class="token operator">:</span> Opr1<span class="token punctuation">,</span>
  op<span class="token operator">:</span> <span class="token string">"="</span><span class="token punctuation">,</span>
  opr2<span class="token operator">:</span> Opr2
<span class="token punctuation">)</span><span class="token operator">:</span> TypeSet<span class="token operator">&lt;</span>$Boolean<span class="token punctuation">,</span> Cardinality<span class="token punctuation">.</span>One<span class="token operator">&gt;</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token generic-function"><span class="token function">op</span><span class="token generic class-name"><span class="token operator">&lt;</span>
  Opr1 <span class="token keyword">extends</span> TypeSet<span class="token operator">&lt;</span>$Number<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  Opr2 <span class="token keyword">extends</span> TypeSet<span class="token operator">&lt;</span>$Number<span class="token operator">&gt;</span>
<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>
  opr1<span class="token operator">:</span> Opr1<span class="token punctuation">,</span>
  op<span class="token operator">:</span> <span class="token string">"!="</span><span class="token punctuation">,</span>
  opr2<span class="token operator">:</span> Opr2
<span class="token punctuation">)</span><span class="token operator">:</span> TypeSet<span class="token operator">&lt;</span>$Boolean<span class="token punctuation">,</span> Cardinality<span class="token punctuation">.</span>One<span class="token operator">&gt;</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token generic-function"><span class="token function">op</span><span class="token generic class-name"><span class="token operator">&lt;</span>
  Opr1 <span class="token keyword">extends</span> TypeSet<span class="token operator">&lt;</span>$Number<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  Opr2 <span class="token keyword">extends</span> TypeSet<span class="token operator">&lt;</span>$Number<span class="token operator">&gt;</span>
<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>
  opr1<span class="token operator">:</span> Opr1<span class="token punctuation">,</span>
  op<span class="token operator">:</span> <span class="token string">"&gt;"</span><span class="token punctuation">,</span>
  opr2<span class="token operator">:</span> Opr2
<span class="token punctuation">)</span><span class="token operator">:</span> TypeSet<span class="token operator">&lt;</span>$Boolean<span class="token punctuation">,</span> Cardinality<span class="token punctuation">.</span>One<span class="token operator">&gt;</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token generic-function"><span class="token function">op</span><span class="token generic class-name"><span class="token operator">&lt;</span>
  Opr1 <span class="token keyword">extends</span> TypeSet<span class="token operator">&lt;</span>$Number<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  Opr2 <span class="token keyword">extends</span> TypeSet<span class="token operator">&lt;</span>$Number<span class="token operator">&gt;</span>
<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>
  opr1<span class="token operator">:</span> Opr1<span class="token punctuation">,</span>
  op<span class="token operator">:</span> <span class="token string">"&lt;"</span><span class="token punctuation">,</span>
  opr2<span class="token operator">:</span> Opr2
<span class="token punctuation">)</span><span class="token operator">:</span> TypeSet<span class="token operator">&lt;</span>$Boolean<span class="token punctuation">,</span> Cardinality<span class="token punctuation">.</span>One<span class="token operator">&gt;</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token generic-function"><span class="token function">op</span><span class="token generic class-name"><span class="token operator">&lt;</span>
  Opr1 <span class="token keyword">extends</span> TypeSet<span class="token operator">&lt;</span>$Number<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  Opr2 <span class="token keyword">extends</span> TypeSet<span class="token operator">&lt;</span>$Number<span class="token operator">&gt;</span>
<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>
  opr1<span class="token operator">:</span> Opr1<span class="token punctuation">,</span>
  op<span class="token operator">:</span> <span class="token string">"&gt;="</span><span class="token punctuation">,</span>
  opr2<span class="token operator">:</span> Opr2
<span class="token punctuation">)</span><span class="token operator">:</span> TypeSet<span class="token operator">&lt;</span>$Boolean<span class="token punctuation">,</span> Cardinality<span class="token punctuation">.</span>One<span class="token operator">&gt;</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token generic-function"><span class="token function">op</span><span class="token generic class-name"><span class="token operator">&lt;</span>
  Opr1 <span class="token keyword">extends</span> TypeSet<span class="token operator">&lt;</span>$Number<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  Opr2 <span class="token keyword">extends</span> TypeSet<span class="token operator">&lt;</span>$Number<span class="token operator">&gt;</span>
<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>
  opr1<span class="token operator">:</span> Opr1<span class="token punctuation">,</span>
  op<span class="token operator">:</span> <span class="token string">"&lt;="</span><span class="token punctuation">,</span>
  opr2<span class="token operator">:</span> Opr2
<span class="token punctuation">)</span><span class="token operator">:</span> TypeSet<span class="token operator">&lt;</span>$Boolean<span class="token punctuation">,</span> Cardinality<span class="token punctuation">.</span>One<span class="token operator">&gt;</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token generic-function"><span class="token function">op</span><span class="token generic class-name"><span class="token operator">&lt;</span>
  Opr1 <span class="token keyword">extends</span> TypeSet<span class="token operator">&lt;</span>$Number<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  Opr2 <span class="token keyword">extends</span> TypeSet<span class="token operator">&lt;</span>$Number<span class="token operator">&gt;</span>
<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>
  opr1<span class="token operator">:</span> Opr1<span class="token punctuation">,</span>
  op<span class="token operator">:</span> <span class="token string">"?="</span><span class="token punctuation">,</span>
  opr2<span class="token operator">:</span> Opr2
<span class="token punctuation">)</span><span class="token operator">:</span> TypeSet<span class="token operator">&lt;</span>$Boolean<span class="token punctuation">,</span> Cardinality<span class="token punctuation">.</span>AtMostOne<span class="token operator">&gt;</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token generic-function"><span class="token function">op</span><span class="token generic class-name"><span class="token operator">&lt;</span>
  Opr1 <span class="token keyword">extends</span> TypeSet<span class="token operator">&lt;</span>$Number<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  Opr2 <span class="token keyword">extends</span> TypeSet<span class="token operator">&lt;</span>$Number<span class="token operator">&gt;</span>
<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>
  opr1<span class="token operator">:</span> Opr1<span class="token punctuation">,</span>
  op<span class="token operator">:</span> <span class="token string">"?!="</span><span class="token punctuation">,</span>
  opr2<span class="token operator">:</span> Opr2
<span class="token punctuation">)</span><span class="token operator">:</span> TypeSet<span class="token operator">&lt;</span>$Boolean<span class="token punctuation">,</span> Cardinality<span class="token punctuation">.</span>AtMostOne<span class="token operator">&gt;</span><span class="token punctuation">;</span>

<span class="token comment">// Boolean comparisons</span>
<span class="token keyword">function</span> <span class="token generic-function"><span class="token function">op</span><span class="token generic class-name"><span class="token operator">&lt;</span>
  Opr1 <span class="token keyword">extends</span> TypeSet<span class="token operator">&lt;</span>$Boolean<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  Opr2 <span class="token keyword">extends</span> TypeSet<span class="token operator">&lt;</span>$Boolean<span class="token operator">&gt;</span>
<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>
  opr1<span class="token operator">:</span> Opr1<span class="token punctuation">,</span>
  op<span class="token operator">:</span> <span class="token string">"="</span><span class="token punctuation">,</span>
  opr2<span class="token operator">:</span> Opr2
<span class="token punctuation">)</span><span class="token operator">:</span> TypeSet<span class="token operator">&lt;</span>$Boolean<span class="token punctuation">,</span> Cardinality<span class="token punctuation">.</span>One<span class="token operator">&gt;</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token generic-function"><span class="token function">op</span><span class="token generic class-name"><span class="token operator">&lt;</span>
  Opr1 <span class="token keyword">extends</span> TypeSet<span class="token operator">&lt;</span>$Boolean<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  Opr2 <span class="token keyword">extends</span> TypeSet<span class="token operator">&lt;</span>$Boolean<span class="token operator">&gt;</span>
<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>
  opr1<span class="token operator">:</span> Opr1<span class="token punctuation">,</span>
  op<span class="token operator">:</span> <span class="token string">"!="</span><span class="token punctuation">,</span>
  opr2<span class="token operator">:</span> Opr2
<span class="token punctuation">)</span><span class="token operator">:</span> TypeSet<span class="token operator">&lt;</span>$Boolean<span class="token punctuation">,</span> Cardinality<span class="token punctuation">.</span>One<span class="token operator">&gt;</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token generic-function"><span class="token function">op</span><span class="token generic class-name"><span class="token operator">&lt;</span>
  Opr1 <span class="token keyword">extends</span> TypeSet<span class="token operator">&lt;</span>$Boolean<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  Opr2 <span class="token keyword">extends</span> TypeSet<span class="token operator">&lt;</span>$Boolean<span class="token operator">&gt;</span>
<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>
  opr1<span class="token operator">:</span> Opr1<span class="token punctuation">,</span>
  op<span class="token operator">:</span> <span class="token string">"&gt;"</span><span class="token punctuation">,</span>
  opr2<span class="token operator">:</span> Opr2
<span class="token punctuation">)</span><span class="token operator">:</span> TypeSet<span class="token operator">&lt;</span>$Boolean<span class="token punctuation">,</span> Cardinality<span class="token punctuation">.</span>One<span class="token operator">&gt;</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token generic-function"><span class="token function">op</span><span class="token generic class-name"><span class="token operator">&lt;</span>
  Opr1 <span class="token keyword">extends</span> TypeSet<span class="token operator">&lt;</span>$Boolean<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  Opr2 <span class="token keyword">extends</span> TypeSet<span class="token operator">&lt;</span>$Boolean<span class="token operator">&gt;</span>
<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>
  opr1<span class="token operator">:</span> Opr1<span class="token punctuation">,</span>
  op<span class="token operator">:</span> <span class="token string">"&lt;"</span><span class="token punctuation">,</span>
  opr2<span class="token operator">:</span> Opr2
<span class="token punctuation">)</span><span class="token operator">:</span> TypeSet<span class="token operator">&lt;</span>$Boolean<span class="token punctuation">,</span> Cardinality<span class="token punctuation">.</span>One<span class="token operator">&gt;</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token generic-function"><span class="token function">op</span><span class="token generic class-name"><span class="token operator">&lt;</span>
  Opr1 <span class="token keyword">extends</span> TypeSet<span class="token operator">&lt;</span>$Boolean<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  Opr2 <span class="token keyword">extends</span> TypeSet<span class="token operator">&lt;</span>$Boolean<span class="token operator">&gt;</span>
<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>
  opr1<span class="token operator">:</span> Opr1<span class="token punctuation">,</span>
  op<span class="token operator">:</span> <span class="token string">"&gt;="</span><span class="token punctuation">,</span>
  opr2<span class="token operator">:</span> Opr2
<span class="token punctuation">)</span><span class="token operator">:</span> TypeSet<span class="token operator">&lt;</span>$Boolean<span class="token punctuation">,</span> Cardinality<span class="token punctuation">.</span>One<span class="token operator">&gt;</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token generic-function"><span class="token function">op</span><span class="token generic class-name"><span class="token operator">&lt;</span>
  Opr1 <span class="token keyword">extends</span> TypeSet<span class="token operator">&lt;</span>$Boolean<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  Opr2 <span class="token keyword">extends</span> TypeSet<span class="token operator">&lt;</span>$Boolean<span class="token operator">&gt;</span>
<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>
  opr1<span class="token operator">:</span> Opr1<span class="token punctuation">,</span>
  op<span class="token operator">:</span> <span class="token string">"&lt;="</span><span class="token punctuation">,</span>
  opr2<span class="token operator">:</span> Opr2
<span class="token punctuation">)</span><span class="token operator">:</span> TypeSet<span class="token operator">&lt;</span>$Boolean<span class="token punctuation">,</span> Cardinality<span class="token punctuation">.</span>One<span class="token operator">&gt;</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token generic-function"><span class="token function">op</span><span class="token generic class-name"><span class="token operator">&lt;</span>
  Opr1 <span class="token keyword">extends</span> TypeSet<span class="token operator">&lt;</span>$Boolean<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  Opr2 <span class="token keyword">extends</span> TypeSet<span class="token operator">&lt;</span>$Boolean<span class="token operator">&gt;</span>
<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>
  opr1<span class="token operator">:</span> Opr1<span class="token punctuation">,</span>
  op<span class="token operator">:</span> <span class="token string">"?="</span><span class="token punctuation">,</span>
  opr2<span class="token operator">:</span> Opr2
<span class="token punctuation">)</span><span class="token operator">:</span> TypeSet<span class="token operator">&lt;</span>$Boolean<span class="token punctuation">,</span> Cardinality<span class="token punctuation">.</span>AtMostOne<span class="token operator">&gt;</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token generic-function"><span class="token function">op</span><span class="token generic class-name"><span class="token operator">&lt;</span>
  Opr1 <span class="token keyword">extends</span> TypeSet<span class="token operator">&lt;</span>$Boolean<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  Opr2 <span class="token keyword">extends</span> TypeSet<span class="token operator">&lt;</span>$Boolean<span class="token operator">&gt;</span>
<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>
  opr1<span class="token operator">:</span> Opr1<span class="token punctuation">,</span>
  op<span class="token operator">:</span> <span class="token string">"?!="</span><span class="token punctuation">,</span>
  opr2<span class="token operator">:</span> Opr2
<span class="token punctuation">)</span><span class="token operator">:</span> TypeSet<span class="token operator">&lt;</span>$Boolean<span class="token punctuation">,</span> Cardinality<span class="token punctuation">.</span>AtMostOne<span class="token operator">&gt;</span><span class="token punctuation">;</span>

<span class="token comment">// Boolean logical operations</span>
<span class="token keyword">function</span> <span class="token generic-function"><span class="token function">op</span><span class="token generic class-name"><span class="token operator">&lt;</span>
  Opr1 <span class="token keyword">extends</span> TypeSet<span class="token operator">&lt;</span>$Boolean<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  Opr2 <span class="token keyword">extends</span> TypeSet<span class="token operator">&lt;</span>$Boolean<span class="token operator">&gt;</span>
<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>
  opr1<span class="token operator">:</span> Opr1<span class="token punctuation">,</span>
  op<span class="token operator">:</span> <span class="token string">"and"</span><span class="token punctuation">,</span>
  opr2<span class="token operator">:</span> Opr2
<span class="token punctuation">)</span><span class="token operator">:</span> TypeSet<span class="token operator">&lt;</span>$Boolean<span class="token punctuation">,</span> Cardinality<span class="token punctuation">.</span>One<span class="token operator">&gt;</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token generic-function"><span class="token function">op</span><span class="token generic class-name"><span class="token operator">&lt;</span>
  Opr1 <span class="token keyword">extends</span> TypeSet<span class="token operator">&lt;</span>$Boolean<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  Opr2 <span class="token keyword">extends</span> TypeSet<span class="token operator">&lt;</span>$Boolean<span class="token operator">&gt;</span>
<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>
  opr1<span class="token operator">:</span> Opr1<span class="token punctuation">,</span>
  op<span class="token operator">:</span> <span class="token string">"or"</span><span class="token punctuation">,</span>
  opr2<span class="token operator">:</span> Opr2
<span class="token punctuation">)</span><span class="token operator">:</span> TypeSet<span class="token operator">&lt;</span>$Boolean<span class="token punctuation">,</span> Cardinality<span class="token punctuation">.</span>One<span class="token operator">&gt;</span><span class="token punctuation">;</span>

<span class="token comment">// Number arithmetic operations</span>
<span class="token keyword">function</span> <span class="token generic-function"><span class="token function">op</span><span class="token generic class-name"><span class="token operator">&lt;</span>
  Opr1 <span class="token keyword">extends</span> TypeSet<span class="token operator">&lt;</span>$Number<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  Opr2 <span class="token keyword">extends</span> TypeSet<span class="token operator">&lt;</span>$Number<span class="token operator">&gt;</span>
<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>
  opr1<span class="token operator">:</span> Opr1<span class="token punctuation">,</span>
  op<span class="token operator">:</span> <span class="token string">"+"</span><span class="token punctuation">,</span>
  opr2<span class="token operator">:</span> Opr2
<span class="token punctuation">)</span><span class="token operator">:</span> TypeSet<span class="token operator">&lt;</span>$Number<span class="token punctuation">,</span> Cardinality<span class="token punctuation">.</span>One<span class="token operator">&gt;</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token generic-function"><span class="token function">op</span><span class="token generic class-name"><span class="token operator">&lt;</span>
  Opr1 <span class="token keyword">extends</span> TypeSet<span class="token operator">&lt;</span>$Number<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  Opr2 <span class="token keyword">extends</span> TypeSet<span class="token operator">&lt;</span>$Number<span class="token operator">&gt;</span>
<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>
  opr1<span class="token operator">:</span> Opr1<span class="token punctuation">,</span>
  op<span class="token operator">:</span> <span class="token string">"-"</span><span class="token punctuation">,</span>
  opr2<span class="token operator">:</span> Opr2
<span class="token punctuation">)</span><span class="token operator">:</span> TypeSet<span class="token operator">&lt;</span>$Number<span class="token punctuation">,</span> Cardinality<span class="token punctuation">.</span>One<span class="token operator">&gt;</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token generic-function"><span class="token function">op</span><span class="token generic class-name"><span class="token operator">&lt;</span>
  Opr1 <span class="token keyword">extends</span> TypeSet<span class="token operator">&lt;</span>$Number<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  Opr2 <span class="token keyword">extends</span> TypeSet<span class="token operator">&lt;</span>$Number<span class="token operator">&gt;</span>
<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>
  opr1<span class="token operator">:</span> Opr1<span class="token punctuation">,</span>
  op<span class="token operator">:</span> <span class="token string">"*"</span><span class="token punctuation">,</span>
  opr2<span class="token operator">:</span> Opr2
<span class="token punctuation">)</span><span class="token operator">:</span> TypeSet<span class="token operator">&lt;</span>$Number<span class="token punctuation">,</span> Cardinality<span class="token punctuation">.</span>One<span class="token operator">&gt;</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token generic-function"><span class="token function">op</span><span class="token generic class-name"><span class="token operator">&lt;</span>
  Opr1 <span class="token keyword">extends</span> TypeSet<span class="token operator">&lt;</span>$Number<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  Opr2 <span class="token keyword">extends</span> TypeSet<span class="token operator">&lt;</span>$Number<span class="token operator">&gt;</span>
<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>
  opr1<span class="token operator">:</span> Opr1<span class="token punctuation">,</span>
  op<span class="token operator">:</span> <span class="token string">"/"</span><span class="token punctuation">,</span>
  opr2<span class="token operator">:</span> Opr2
<span class="token punctuation">)</span><span class="token operator">:</span> TypeSet<span class="token operator">&lt;</span>$Number<span class="token punctuation">,</span> Cardinality<span class="token punctuation">.</span>One<span class="token operator">&gt;</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token generic-function"><span class="token function">op</span><span class="token generic class-name"><span class="token operator">&lt;</span>
  Opr1 <span class="token keyword">extends</span> TypeSet<span class="token operator">&lt;</span>$Number<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  Opr2 <span class="token keyword">extends</span> TypeSet<span class="token operator">&lt;</span>$Number<span class="token operator">&gt;</span>
<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>
  opr1<span class="token operator">:</span> Opr1<span class="token punctuation">,</span>
  op<span class="token operator">:</span> <span class="token string">"%"</span><span class="token punctuation">,</span>
  opr2<span class="token operator">:</span> Opr2
<span class="token punctuation">)</span><span class="token operator">:</span> TypeSet<span class="token operator">&lt;</span>$Number<span class="token punctuation">,</span> Cardinality<span class="token punctuation">.</span>One<span class="token operator">&gt;</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token generic-function"><span class="token function">op</span><span class="token generic class-name"><span class="token operator">&lt;</span>
  Opr1 <span class="token keyword">extends</span> TypeSet<span class="token operator">&lt;</span>$Number<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  Opr2 <span class="token keyword">extends</span> TypeSet<span class="token operator">&lt;</span>$Number<span class="token operator">&gt;</span>
<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>
  opr1<span class="token operator">:</span> Opr1<span class="token punctuation">,</span>
  op<span class="token operator">:</span> <span class="token string">"//"</span><span class="token punctuation">,</span>
  opr2<span class="token operator">:</span> Opr2
<span class="token punctuation">)</span><span class="token operator">:</span> TypeSet<span class="token operator">&lt;</span>$Number<span class="token punctuation">,</span> Cardinality<span class="token punctuation">.</span>One<span class="token operator">&gt;</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token generic-function"><span class="token function">op</span><span class="token generic class-name"><span class="token operator">&lt;</span>
  Opr1 <span class="token keyword">extends</span> TypeSet<span class="token operator">&lt;</span>$Number<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  Opr2 <span class="token keyword">extends</span> TypeSet<span class="token operator">&lt;</span>$Number<span class="token operator">&gt;</span>
<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>
  opr1<span class="token operator">:</span> Opr1<span class="token punctuation">,</span>
  op<span class="token operator">:</span> <span class="token string">"^"</span><span class="token punctuation">,</span>
  opr2<span class="token operator">:</span> Opr2
<span class="token punctuation">)</span><span class="token operator">:</span> TypeSet<span class="token operator">&lt;</span>$Number<span class="token punctuation">,</span> Cardinality<span class="token punctuation">.</span>One<span class="token operator">&gt;</span><span class="token punctuation">;</span>

<span class="token comment">// Unary number operations</span>
<span class="token keyword">function</span> <span class="token generic-function"><span class="token function">op</span><span class="token generic class-name"><span class="token operator">&lt;</span>Opr <span class="token keyword">extends</span> TypeSet<span class="token operator">&lt;</span>$Number<span class="token operator">&gt;&gt;</span></span></span><span class="token punctuation">(</span>
  op<span class="token operator">:</span> <span class="token string">"+"</span><span class="token punctuation">,</span>
  opr<span class="token operator">:</span> Opr
<span class="token punctuation">)</span><span class="token operator">:</span> TypeSet<span class="token operator">&lt;</span>$Number<span class="token punctuation">,</span> Cardinality<span class="token punctuation">.</span>One<span class="token operator">&gt;</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token generic-function"><span class="token function">op</span><span class="token generic class-name"><span class="token operator">&lt;</span>Opr <span class="token keyword">extends</span> TypeSet<span class="token operator">&lt;</span>$Number<span class="token operator">&gt;&gt;</span></span></span><span class="token punctuation">(</span>
  op<span class="token operator">:</span> <span class="token string">"-"</span><span class="token punctuation">,</span>
  opr<span class="token operator">:</span> Opr
<span class="token punctuation">)</span><span class="token operator">:</span> TypeSet<span class="token operator">&lt;</span>$Number<span class="token punctuation">,</span> Cardinality<span class="token punctuation">.</span>One<span class="token operator">&gt;</span><span class="token punctuation">;</span>

<span class="token comment">// Unary boolean operation</span>
<span class="token keyword">function</span> <span class="token generic-function"><span class="token function">op</span><span class="token generic class-name"><span class="token operator">&lt;</span>Opr <span class="token keyword">extends</span> TypeSet<span class="token operator">&lt;</span>$Boolean<span class="token operator">&gt;&gt;</span></span></span><span class="token punctuation">(</span>
  op<span class="token operator">:</span> <span class="token string">"not"</span><span class="token punctuation">,</span>
  opr<span class="token operator">:</span> Opr
<span class="token punctuation">)</span><span class="token operator">:</span> TypeSet<span class="token operator">&lt;</span>$Boolean<span class="token punctuation">,</span> Cardinality<span class="token punctuation">.</span>One<span class="token operator">&gt;</span><span class="token punctuation">;</span>

<span class="token comment">// String-specific operations</span>
<span class="token keyword">function</span> <span class="token generic-function"><span class="token function">op</span><span class="token generic class-name"><span class="token operator">&lt;</span>
  Opr1 <span class="token keyword">extends</span> TypeSet<span class="token operator">&lt;</span>$String<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  Opr2 <span class="token keyword">extends</span> TypeSet<span class="token operator">&lt;</span>$String<span class="token operator">&gt;</span>
<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>
  opr1<span class="token operator">:</span> Opr1<span class="token punctuation">,</span>
  op<span class="token operator">:</span> <span class="token string">"ilike"</span><span class="token punctuation">,</span>
  opr2<span class="token operator">:</span> Opr2
<span class="token punctuation">)</span><span class="token operator">:</span> TypeSet<span class="token operator">&lt;</span>$Boolean<span class="token punctuation">,</span> Cardinality<span class="token punctuation">.</span>One<span class="token operator">&gt;</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token generic-function"><span class="token function">op</span><span class="token generic class-name"><span class="token operator">&lt;</span>
  Opr1 <span class="token keyword">extends</span> TypeSet<span class="token operator">&lt;</span>$String<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  Opr2 <span class="token keyword">extends</span> TypeSet<span class="token operator">&lt;</span>$String<span class="token operator">&gt;</span>
<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>
  opr1<span class="token operator">:</span> Opr1<span class="token punctuation">,</span>
  op<span class="token operator">:</span> <span class="token string">"not ilike"</span><span class="token punctuation">,</span>
  opr2<span class="token operator">:</span> Opr2
<span class="token punctuation">)</span><span class="token operator">:</span> TypeSet<span class="token operator">&lt;</span>$Boolean<span class="token punctuation">,</span> Cardinality<span class="token punctuation">.</span>One<span class="token operator">&gt;</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token generic-function"><span class="token function">op</span><span class="token generic class-name"><span class="token operator">&lt;</span>
  Opr1 <span class="token keyword">extends</span> TypeSet<span class="token operator">&lt;</span>$String<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  Opr2 <span class="token keyword">extends</span> TypeSet<span class="token operator">&lt;</span>$String<span class="token operator">&gt;</span>
<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>
  opr1<span class="token operator">:</span> Opr1<span class="token punctuation">,</span>
  op<span class="token operator">:</span> <span class="token string">"++"</span><span class="token punctuation">,</span>
  opr2<span class="token operator">:</span> Opr2
<span class="token punctuation">)</span><span class="token operator">:</span> TypeSet<span class="token operator">&lt;</span>$String<span class="token punctuation">,</span> Cardinality<span class="token punctuation">.</span>One<span class="token operator">&gt;</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">op</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token keyword">as</span> <span class="token builtin">any</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token punctuation">{</span> op <span class="token punctuation">}</span><span class="token punctuation">;</span></span></pre></div></div></div></div><div class="code_tabContent__B1hng"><div class="code_code__f6VbY code-language-typescript  blogPost_codeBlock__DLXTS" style="--maxLineLength:44;--code-max-height:12"><div class="code_highlightWrapper__8YM2j code_hasCopyButton__vL2_6"><div class="code_copyCodeButtonWrapper__gi2zF"><div class="code_copyCode__EvySm"><svg width="13" height="15" viewBox="0 0 13 15" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="3.5" y="3.5" width="9" height="11" rx="1.5" stroke="currentColor"></rect><rect width="10" height="12" rx="2" fill="currentColor"></rect></svg><span class="code_copyLabel__9W53T">Copy</span></div></div><div class="code_block__73rl_" translate="no"><pre><span class="tokens tokens-normal"><span class="token keyword">export</span> <span class="token keyword">enum</span> Cardinality <span class="token punctuation">{</span>
  AtMostOne <span class="token operator">=</span> <span class="token string">"AtMostOne"</span><span class="token punctuation">,</span>
  One <span class="token operator">=</span> <span class="token string">"One"</span><span class="token punctuation">,</span>
  Many <span class="token operator">=</span> <span class="token string">"Many"</span><span class="token punctuation">,</span>
  AtLeastOne <span class="token operator">=</span> <span class="token string">"AtLeastOne"</span><span class="token punctuation">,</span>
  Empty <span class="token operator">=</span> <span class="token string">"Empty"</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">BaseType</span> <span class="token punctuation">{</span>
  __name__<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  __tstype__<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">$String</span> <span class="token keyword">extends</span> <span class="token class-name">BaseType</span> <span class="token punctuation">{</span>
  __name__<span class="token operator">:</span> <span class="token string">"$String"</span><span class="token punctuation">;</span>
  __tstype__<span class="token operator">:</span> <span class="token string">"string"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">$string</span><span class="token punctuation">(</span>val<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    __element__<span class="token operator">:</span> <span class="token punctuation">{</span>
      __name__<span class="token operator">:</span> <span class="token string">"$String"</span><span class="token punctuation">,</span>
      __tstype__<span class="token operator">:</span> <span class="token string">"string"</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    __cardinality__<span class="token operator">:</span> Cardinality<span class="token punctuation">.</span>One<span class="token punctuation">,</span>
    __value__<span class="token operator">:</span> val<span class="token punctuation">,</span>
  <span class="token punctuation">}</span> <span class="token keyword">as</span> <span class="token keyword">const</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">$Number</span> <span class="token keyword">extends</span> <span class="token class-name">BaseType</span> <span class="token punctuation">{</span>
  __name__<span class="token operator">:</span> <span class="token string">"$Number"</span><span class="token punctuation">;</span>
  __tstype__<span class="token operator">:</span> <span class="token string">"number"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">$number</span><span class="token punctuation">(</span>val<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    __element__<span class="token operator">:</span> <span class="token punctuation">{</span>
      __name__<span class="token operator">:</span> <span class="token string">"$Number"</span><span class="token punctuation">,</span>
      __tstype__<span class="token operator">:</span> <span class="token string">"number"</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    __cardinality__<span class="token operator">:</span> Cardinality<span class="token punctuation">.</span>One<span class="token punctuation">,</span>
    __value__<span class="token operator">:</span> val<span class="token punctuation">,</span>
  <span class="token punctuation">}</span> <span class="token keyword">as</span> <span class="token keyword">const</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">$Boolean</span> <span class="token keyword">extends</span> <span class="token class-name">BaseType</span> <span class="token punctuation">{</span>
  __name__<span class="token operator">:</span> <span class="token string">"$Boolean"</span><span class="token punctuation">;</span>
  __tstype__<span class="token operator">:</span> <span class="token string">"boolean"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">$boolean</span><span class="token punctuation">(</span>val<span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    __element__<span class="token operator">:</span> <span class="token punctuation">{</span>
      __name__<span class="token operator">:</span> <span class="token string">"$Boolean"</span><span class="token punctuation">,</span>
      __tstype__<span class="token operator">:</span> <span class="token string">"boolean"</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    __cardinality__<span class="token operator">:</span> Cardinality<span class="token punctuation">.</span>One<span class="token punctuation">,</span>
    __value__<span class="token operator">:</span> val<span class="token punctuation">,</span>
  <span class="token punctuation">}</span> <span class="token keyword">as</span> <span class="token keyword">const</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">TypeSet<span class="token operator">&lt;</span>
  <span class="token constant">T</span> <span class="token keyword">extends</span> BaseType <span class="token operator">=</span> BaseType<span class="token punctuation">,</span>
  Card <span class="token keyword">extends</span> Cardinality <span class="token operator">=</span> Cardinality<span class="token punctuation">,</span>
<span class="token operator">&gt;</span></span> <span class="token punctuation">{</span>
  __element__<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">;</span>
  __cardinality__<span class="token operator">:</span> Card<span class="token punctuation">;</span>
<span class="token punctuation">}</span></span></pre></div></div></div></div><div class="code_tabContent__B1hng"><div class="code_code__f6VbY code-language-json  blogPost_codeBlock__DLXTS" style="--maxLineLength:57;--code-max-height:12"><div class="code_highlightWrapper__8YM2j code_hasCopyButton__vL2_6"><div class="code_copyCodeButtonWrapper__gi2zF"><div class="code_copyCode__EvySm"><svg width="13" height="15" viewBox="0 0 13 15" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="3.5" y="3.5" width="9" height="11" rx="1.5" stroke="currentColor"></rect><rect width="10" height="12" rx="2" fill="currentColor"></rect></svg><span class="code_copyLabel__9W53T">Copy</span></div></div><div class="code_block__73rl_" translate="no"><pre><span class="tokens tokens-normal"><span class="token punctuation">{</span>
  <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"tsperf-blog-post"</span><span class="token punctuation">,</span>
  <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"1.0.0"</span><span class="token punctuation">,</span>
  <span class="token property">"description"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
  <span class="token property">"main"</span><span class="token operator">:</span> <span class="token string">"index.js"</span><span class="token punctuation">,</span>
  <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"module"</span><span class="token punctuation">,</span>
  <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"test"</span><span class="token operator">:</span> <span class="token string">"echo \"Error: no test specified\" &amp;&amp; exit 1"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"keywords"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">"author"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
  <span class="token property">"license"</span><span class="token operator">:</span> <span class="token string">"ISC"</span><span class="token punctuation">,</span>
  <span class="token property">"devDependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"@ark/attest"</span><span class="token operator">:</span> <span class="token string">"^0.11.0"</span><span class="token punctuation">,</span>
    <span class="token property">"arktype"</span><span class="token operator">:</span> <span class="token string">"^2.0.0-beta.3"</span><span class="token punctuation">,</span>
    <span class="token property">"tsx"</span><span class="token operator">:</span> <span class="token string">"^4.16.2"</span><span class="token punctuation">,</span>
    <span class="token property">"typescript"</span><span class="token operator">:</span> <span class="token string">"^5.5.3"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></span></pre></div></div></div></div><div class="code_tabContent__B1hng"><div class="code_code__f6VbY code-language-json  blogPost_codeBlock__DLXTS" style="--maxLineLength:41;--code-max-height:12"><div class="code_highlightWrapper__8YM2j code_hasCopyButton__vL2_6"><div class="code_copyCodeButtonWrapper__gi2zF"><div class="code_copyCode__EvySm"><svg width="13" height="15" viewBox="0 0 13 15" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="3.5" y="3.5" width="9" height="11" rx="1.5" stroke="currentColor"></rect><rect width="10" height="12" rx="2" fill="currentColor"></rect></svg><span class="code_copyLabel__9W53T">Copy</span></div></div><div class="code_block__73rl_" translate="no"><pre><span class="tokens tokens-normal"><span class="token punctuation">{</span>
  <span class="token property">"compilerOptions"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"strict"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">"noImplicitAny"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">"strictNullChecks"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">"strictFunctionTypes"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">"strictPropertyInitialization"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">"strictBindCallApply"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">"noImplicitThis"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">"noImplicitReturns"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">"alwaysStrict"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">"esModuleInterop"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">"declaration"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">"target"</span><span class="token operator">:</span> <span class="token string">"ES2022"</span><span class="token punctuation">,</span>
    <span class="token property">"module"</span><span class="token operator">:</span> <span class="token string">"NodeNext"</span><span class="token punctuation">,</span>
    <span class="token property">"moduleResolution"</span><span class="token operator">:</span> <span class="token string">"NodeNext"</span><span class="token punctuation">,</span>
    <span class="token property">"skipLibCheck"</span><span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"include"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"./*.ts"</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span></span></pre></div></div></div></div></div>
</div>
<div data-section-id="how-do-we-quantify-the-type-checker-s-workload" id="how-do-we-quantify-the-type-checker-s-workload" class="base_section__z_4nJ blogPost_section__aSmVz">
<h2 id="how-do-we-quantify-the-type-checker-s-workload" class="headerLink_header__L_1Jm">How do we quantify the type checker’s workload?<span class="headerLink_popupWrapper__fYhfO">​<div class="headerLink_linkPopup__K0HFc"><div class="headerLink_popupBg__g_IfY"></div><div class="headerLink_linksInner__mj5XG"><a href="https://www.edgedb.com/blog/an-approach-to-optimizing-typescript-type-checking-performance#how-do-we-quantify-the-type-checker-s-workload"><svg width="18" height="14" viewBox="0 0 18 14" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10 2H3C2.44772 2 2 2.44772 2 3V7C2 7.55228 2.44772 8 3 8H10C10.5523 8 11 7.55228 11 7H13C13 8.65685 11.6569 10 10 10H3C1.34315 10 0 8.65685 0 7V3C0 1.34315 1.34315 0 3 0H10C11.6569 0 13 1.34315 13 3H11C11 2.44772 10.5523 2 10 2ZM15 6H8C7.44772 6 7 6.44772 7 7H5C5 5.34315 6.34315 4 8 4H15C16.6569 4 18 5.34315 18 7V11C18 12.6569 16.6569 14 15 14H8C6.34315 14 5 12.6569 5 11H7C7 11.5523 7.44772 12 8 12H15C15.5523 12 16 11.5523 16 11V7C16 6.44771 15.5523 6 15 6Z" fill="currentColor"></path></svg></a></div></div></span></h2>
<p class="">The simplest way to measure type checker performance is to get diagnostics from the compiler. You can invoke the compiler with a flag that will output helpful metrics about the compilation process. For our use case there are a few metrics we’re interested in, the total number of type instantiations, and to a lesser degree, the wall-time spent in the type checking step. You can get these diagnostics by running the TypeScript compiler with the <code class="">--extendedDiagnostics</code> flag.</p>
<p class="">The TypeScript type checker operates by analyzing the structure and relationships of types in your code. It performs type inference, checks for type compatibility, and ensures that operations are valid within the type system. During this process, the type checker often needs to create concrete instances of generic types, a process known as type instantiation. Each time a generic type is used with specific type arguments, a new type is instantiated. The number of type instantiations serves as a good proxy for the “amount of work” the type checker has to do because it directly correlates with the complexity of the type relationships in your code. More type instantiations generally indicate more complex type structures or a higher number of generic type usages, which require more processing time and memory from the type checker. By measuring the number of type instantiations, we can get a reliable, reproducible metric that reflects the workload on the type checker, independent of variations in hardware performance or other external factors.</p>
<p class="">Let’s run these diagnostics now, with the <code class="">--noEmit</code> flag to avoid actually emitting JavaScript files since we only care about the type checking performance at the moment.</p>
<div class="code_code__f6VbY code-language-bash  blogPost_codeBlock__DLXTS code_repl__r4TUI" style="--maxLineLength:40;--code-max-height:12"><div class="code_highlightWrapper__8YM2j code_hasCopyButton__vL2_6"><div class="code_copyCodeButtonWrapper__gi2zF"><div class="code_copyCode__EvySm"><svg width="13" height="15" viewBox="0 0 13 15" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="3.5" y="3.5" width="9" height="11" rx="1.5" stroke="currentColor"></rect><rect width="10" height="12" rx="2" fill="currentColor"></rect></svg><span class="code_copyLabel__9W53T">Copy</span></div></div><div class="code_block__73rl_" translate="no"><div class="code_codePart__T3ELt code-language-bash"><pre>$ </pre><pre><span class="tokens tokens-normal">npx tsc <span class="token parameter variable">--noEmit</span> <span class="token parameter variable">--extendedDiagnostics</span></span></pre></div><div class="code_outPart__nb_c_"><pre>Files:                         66
Lines of Library:           39995
Lines of Definitions:           0
Lines of TypeScript:          268
Lines of JavaScript:            0
Lines of JSON:                  0
Lines of Other:                 0
Identifiers:                43933
Symbols:                    29170
Types:                        288
Instantiations:               191
Memory used:               57207K
Assignability cache size:      33
Identity cache size:            0
Subtype cache size:            10
Strict subtype cache size:      0
I/O Read time:              0.01s
Parse time:                 0.28s
ResolveModule time:         0.00s
ResolveLibrary time:        0.06s
Program time:               0.39s
Bind time:                  0.16s
Check time:                 0.08s
printTime time:             0.00s
Emit time:                  0.00s
Total time:                 0.63s</pre></div></div></div></div>
<p class="">We see here that we are currently instantiating 191 types in the process of checking this project.</p>
<p class="">One drawback of using <code class="">--extendedDiagnostics</code> is that you do not get any real feedback about where to look to improve performance. The next tool we’ll look at, <code class="">--generateTrace</code>, gives you a more detailed breakdown of what is happening during the compilation process. It hooks into the type checker and provides a detailed report of what types are being instantiated, and how long it takes.</p>
<p class="">Let’s take a look at what we see when using <code class="">--generateTrace</code> which takes the name of a directory as an argument. We’ll use today’s date and time to make it easy to compare these values across time.</p>
<div class="code_code__f6VbY code-language-bash  blogPost_codeBlock__DLXTS code_repl__r4TUI code_showHighlight__tDAlE" style="--maxLineLength:48;--code-max-height:12"><div class="code_highlightWrapper__8YM2j code_hasCopyButton__vL2_6"><div class="code_copyCodeButtonWrapper__gi2zF"><div class="code_copyCode__EvySm"><svg width="13" height="15" viewBox="0 0 13 15" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="3.5" y="3.5" width="9" height="11" rx="1.5" stroke="currentColor"></rect><rect width="10" height="12" rx="2" fill="currentColor"></rect></svg><span class="code_copyLabel__9W53T">Copy</span></div></div><div class="code_block__73rl_" translate="no"><div class="code_codePart__T3ELt code-language-bash"><pre>$ </pre><pre><span class="tokens tokens-normal">npx tsc <span class="token parameter variable">--noEmit</span> <span class="token parameter variable">--generateTrace</span> 20240715T1634</span></pre></div><div class="code_outPart__nb_c_"><pre></pre></div></div></div><div class="code_highlightWrapper__8YM2j code_hasCopyButton__vL2_6"><div class="code_copyCodeButtonWrapper__gi2zF"><div class="code_copyCode__EvySm"><svg width="13" height="15" viewBox="0 0 13 15" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="3.5" y="3.5" width="9" height="11" rx="1.5" stroke="currentColor"></rect><rect width="10" height="12" rx="2" fill="currentColor"></rect></svg><span class="code_copyLabel__9W53T">Copy</span></div></div><div class="code_block__73rl_" translate="no"><div class="code_codePart__T3ELt code-language-bash"><pre>$ </pre><pre><span class="tokens tokens-normal"><span class="token function">ls</span> 20240715T1634</span></pre></div><div class="code_outPart__nb_c_"><pre>trace.json  types.json</pre></div></div></div></div>
<p class="">The TypeScript compiler will generate two files: <code class="">trace.json</code> and <code class="">types.json</code>. Loading <code class="">trace.json</code> into a trace viewer like <a href="https://ui.perfetto.dev/" class="">Perfetto</a>, we can now see what was happening when compiling our code.</p>
<p class="">The trace can give us some details about which expressions take the most time to check, but since it reports wall-time, it’s not a stable base to build our benchmark against. We’ll need to run this trace multiple times to get a good baseline. Luckily, our next tool gives us just such a stable measurement that is a good proxy for type-checker performance.</p>
</div>
<div data-section-id="marking-the-workbench" id="marking-the-workbench" class="base_section__z_4nJ blogPost_section__aSmVz">
<h2 id="marking-the-workbench" class="headerLink_header__L_1Jm">Marking the workbench<span class="headerLink_popupWrapper__fYhfO">​<div class="headerLink_linkPopup__K0HFc"><div class="headerLink_popupBg__g_IfY"></div><div class="headerLink_linksInner__mj5XG"><a href="https://www.edgedb.com/blog/an-approach-to-optimizing-typescript-type-checking-performance#marking-the-workbench"><svg width="18" height="14" viewBox="0 0 18 14" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10 2H3C2.44772 2 2 2.44772 2 3V7C2 7.55228 2.44772 8 3 8H10C10.5523 8 11 7.55228 11 7H13C13 8.65685 11.6569 10 10 10H3C1.34315 10 0 8.65685 0 7V3C0 1.34315 1.34315 0 3 0H10C11.6569 0 13 1.34315 13 3H11C11 2.44772 10.5523 2 10 2ZM15 6H8C7.44772 6 7 6.44772 7 7H5C5 5.34315 6.34315 4 8 4H15C16.6569 4 18 5.34315 18 7V11C18 12.6569 16.6569 14 15 14H8C6.34315 14 5 12.6569 5 11H7C7 11.5523 7.44772 12 8 12H15C15.5523 12 16 11.5523 16 11V7C16 6.44771 15.5523 6 15 6Z" fill="currentColor"></path></svg></a></div></div></span></h2>
<p class="">That tool is the fantastic <code class="">@arktype/attest</code> package which contains a really helpful benchmarking library that can measure type instantiations. Let’s replace our main script with a benchmarking script that we can run using Node.</p>
<div class="code_code__f6VbY code-language-typescript  blogPost_codeBlock__DLXTS code_collapsed__HCQkh" style="--maxLineLength:74;--code-max-height:12"><div class="code_highlightWrapper__8YM2j code_hasCopyButton__vL2_6"><div class="code_copyCodeButtonWrapper__gi2zF"><div class="code_copyCode__EvySm"><svg width="13" height="15" viewBox="0 0 13 15" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="3.5" y="3.5" width="9" height="11" rx="1.5" stroke="currentColor"></rect><rect width="10" height="12" rx="2" fill="currentColor"></rect></svg><span class="code_copyLabel__9W53T">Copy</span></div></div><div class="code_block__73rl_" translate="no"><pre><span class="tokens tokens-normal"> <span class="token keyword">import</span> <span class="token punctuation">{</span> bench <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@ark/attest"</span><span class="token punctuation">;</span>
 <span class="token keyword">import</span> <span class="token punctuation">{</span> $<span class="token builtin">string</span><span class="token punctuation">,</span> $<span class="token builtin">number</span><span class="token punctuation">,</span> $<span class="token builtin">boolean</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./typesystem.js"</span><span class="token punctuation">;</span>
 <span class="token keyword">import</span> <span class="token punctuation">{</span> op <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./operators.js"</span><span class="token punctuation">;</span>

 <span class="token comment">// Creating a baseline expression that does not appear in the benchmarked</span>
 <span class="token comment">// code gives more accurate results</span>
 bench<span class="token punctuation">.</span><span class="token function">baseline</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">$string</span><span class="token punctuation">(</span><span class="token string">"baseline"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token function">bench</span><span class="token punctuation">(</span><span class="token string">"string: ="</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> <span class="token function">op</span><span class="token punctuation">(</span><span class="token function">$string</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"="</span><span class="token punctuation">,</span> <span class="token function">$string</span><span class="token punctuation">(</span><span class="token string">"b"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">types</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"instantiations"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token function">bench</span><span class="token punctuation">(</span><span class="token string">"string: !="</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> <span class="token function">op</span><span class="token punctuation">(</span><span class="token function">$string</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"!="</span><span class="token punctuation">,</span> <span class="token function">$string</span><span class="token punctuation">(</span><span class="token string">"b"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">types</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"instantiations"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token function">bench</span><span class="token punctuation">(</span><span class="token string">"string: &gt;"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> <span class="token function">op</span><span class="token punctuation">(</span><span class="token function">$string</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"&gt;"</span><span class="token punctuation">,</span> <span class="token function">$string</span><span class="token punctuation">(</span><span class="token string">"b"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">types</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"instantiations"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token function">bench</span><span class="token punctuation">(</span><span class="token string">"string: &lt;"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> <span class="token function">op</span><span class="token punctuation">(</span><span class="token function">$string</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"&lt;"</span><span class="token punctuation">,</span> <span class="token function">$string</span><span class="token punctuation">(</span><span class="token string">"b"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">types</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"instantiations"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token function">bench</span><span class="token punctuation">(</span><span class="token string">"string: &gt;="</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> <span class="token function">op</span><span class="token punctuation">(</span><span class="token function">$string</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"&gt;="</span><span class="token punctuation">,</span> <span class="token function">$string</span><span class="token punctuation">(</span><span class="token string">"b"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">types</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"instantiations"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token function">bench</span><span class="token punctuation">(</span><span class="token string">"string: &lt;="</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> <span class="token function">op</span><span class="token punctuation">(</span><span class="token function">$string</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"&lt;="</span><span class="token punctuation">,</span> <span class="token function">$string</span><span class="token punctuation">(</span><span class="token string">"b"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">types</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"instantiations"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token function">bench</span><span class="token punctuation">(</span><span class="token string">"string: ?="</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> <span class="token function">op</span><span class="token punctuation">(</span><span class="token function">$string</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"?="</span><span class="token punctuation">,</span> <span class="token function">$string</span><span class="token punctuation">(</span><span class="token string">"b"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">types</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"instantiations"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token function">bench</span><span class="token punctuation">(</span><span class="token string">"string: ?!="</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> <span class="token function">op</span><span class="token punctuation">(</span><span class="token function">$string</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"?!="</span><span class="token punctuation">,</span> <span class="token function">$string</span><span class="token punctuation">(</span><span class="token string">"b"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">types</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"instantiations"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token function">bench</span><span class="token punctuation">(</span><span class="token string">"string: ++"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> <span class="token function">op</span><span class="token punctuation">(</span><span class="token function">$string</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"++"</span><span class="token punctuation">,</span> <span class="token function">$string</span><span class="token punctuation">(</span><span class="token string">"b"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">types</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"instantiations"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token function">bench</span><span class="token punctuation">(</span><span class="token string">"number: ="</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> <span class="token function">op</span><span class="token punctuation">(</span><span class="token function">$number</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"="</span><span class="token punctuation">,</span> <span class="token function">$number</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">types</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"instantiations"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token function">bench</span><span class="token punctuation">(</span><span class="token string">"number: !="</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> <span class="token function">op</span><span class="token punctuation">(</span><span class="token function">$number</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"!="</span><span class="token punctuation">,</span> <span class="token function">$number</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">types</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"instantiations"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token function">bench</span><span class="token punctuation">(</span><span class="token string">"number: &gt;"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> <span class="token function">op</span><span class="token punctuation">(</span><span class="token function">$number</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"&gt;"</span><span class="token punctuation">,</span> <span class="token function">$number</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">types</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"instantiations"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token function">bench</span><span class="token punctuation">(</span><span class="token string">"number: &lt;"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> <span class="token function">op</span><span class="token punctuation">(</span><span class="token function">$number</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"&lt;"</span><span class="token punctuation">,</span> <span class="token function">$number</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">types</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"instantiations"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token function">bench</span><span class="token punctuation">(</span><span class="token string">"number: &gt;="</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> <span class="token function">op</span><span class="token punctuation">(</span><span class="token function">$number</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"&gt;="</span><span class="token punctuation">,</span> <span class="token function">$number</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">types</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"instantiations"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token function">bench</span><span class="token punctuation">(</span><span class="token string">"number: &lt;="</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> <span class="token function">op</span><span class="token punctuation">(</span><span class="token function">$number</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"&lt;="</span><span class="token punctuation">,</span> <span class="token function">$number</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">types</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"instantiations"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token function">bench</span><span class="token punctuation">(</span><span class="token string">"number: ?="</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> <span class="token function">op</span><span class="token punctuation">(</span><span class="token function">$number</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"?="</span><span class="token punctuation">,</span> <span class="token function">$number</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">types</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"instantiations"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token function">bench</span><span class="token punctuation">(</span><span class="token string">"number: ?!="</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> <span class="token function">op</span><span class="token punctuation">(</span><span class="token function">$number</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"?!="</span><span class="token punctuation">,</span> <span class="token function">$number</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">types</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"instantiations"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token function">bench</span><span class="token punctuation">(</span><span class="token string">"number: +"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> <span class="token function">op</span><span class="token punctuation">(</span><span class="token function">$number</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"+"</span><span class="token punctuation">,</span> <span class="token function">$number</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">types</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"instantiations"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token function">bench</span><span class="token punctuation">(</span><span class="token string">"number: -"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> <span class="token function">op</span><span class="token punctuation">(</span><span class="token function">$number</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"-"</span><span class="token punctuation">,</span> <span class="token function">$number</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">types</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"instantiations"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token function">bench</span><span class="token punctuation">(</span><span class="token string">"number: *"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> <span class="token function">op</span><span class="token punctuation">(</span><span class="token function">$number</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"*"</span><span class="token punctuation">,</span> <span class="token function">$number</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">types</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"instantiations"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token function">bench</span><span class="token punctuation">(</span><span class="token string">"number: /"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> <span class="token function">op</span><span class="token punctuation">(</span><span class="token function">$number</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"/"</span><span class="token punctuation">,</span> <span class="token function">$number</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">types</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"instantiations"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token function">bench</span><span class="token punctuation">(</span><span class="token string">"number: %"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> <span class="token function">op</span><span class="token punctuation">(</span><span class="token function">$number</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"%"</span><span class="token punctuation">,</span> <span class="token function">$number</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">types</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"instantiations"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token function">bench</span><span class="token punctuation">(</span><span class="token string">"number: //"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> <span class="token function">op</span><span class="token punctuation">(</span><span class="token function">$number</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"//"</span><span class="token punctuation">,</span> <span class="token function">$number</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">types</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"instantiations"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token function">bench</span><span class="token punctuation">(</span><span class="token string">"number: ^"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> <span class="token function">op</span><span class="token punctuation">(</span><span class="token function">$number</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"^"</span><span class="token punctuation">,</span> <span class="token function">$number</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">types</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"instantiations"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token function">bench</span><span class="token punctuation">(</span><span class="token string">"number: unary +"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> <span class="token function">op</span><span class="token punctuation">(</span><span class="token string">"+"</span><span class="token punctuation">,</span> <span class="token function">$number</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">types</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"instantiations"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token function">bench</span><span class="token punctuation">(</span><span class="token string">"number: unary -"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> <span class="token function">op</span><span class="token punctuation">(</span><span class="token string">"-"</span><span class="token punctuation">,</span> <span class="token function">$number</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">types</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"instantiations"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token function">bench</span><span class="token punctuation">(</span><span class="token string">"boolean: ="</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> <span class="token function">op</span><span class="token punctuation">(</span><span class="token function">$boolean</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"="</span><span class="token punctuation">,</span> <span class="token function">$boolean</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">types</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"instantiations"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token function">bench</span><span class="token punctuation">(</span><span class="token string">"boolean: !="</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> <span class="token function">op</span><span class="token punctuation">(</span><span class="token function">$boolean</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"!="</span><span class="token punctuation">,</span> <span class="token function">$boolean</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">types</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"instantiations"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token function">bench</span><span class="token punctuation">(</span><span class="token string">"boolean: &gt;"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> <span class="token function">op</span><span class="token punctuation">(</span><span class="token function">$boolean</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"&gt;"</span><span class="token punctuation">,</span> <span class="token function">$boolean</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">types</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"instantiations"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token function">bench</span><span class="token punctuation">(</span><span class="token string">"boolean: &lt;"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> <span class="token function">op</span><span class="token punctuation">(</span><span class="token function">$boolean</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"&lt;"</span><span class="token punctuation">,</span> <span class="token function">$boolean</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">types</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"instantiations"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token function">bench</span><span class="token punctuation">(</span><span class="token string">"boolean: &gt;="</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> <span class="token function">op</span><span class="token punctuation">(</span><span class="token function">$boolean</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"&gt;="</span><span class="token punctuation">,</span> <span class="token function">$boolean</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">types</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"instantiations"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token function">bench</span><span class="token punctuation">(</span><span class="token string">"boolean: &lt;="</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> <span class="token function">op</span><span class="token punctuation">(</span><span class="token function">$boolean</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"&lt;="</span><span class="token punctuation">,</span> <span class="token function">$boolean</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">types</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"instantiations"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token function">bench</span><span class="token punctuation">(</span><span class="token string">"boolean: ?="</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> <span class="token function">op</span><span class="token punctuation">(</span><span class="token function">$boolean</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"?="</span><span class="token punctuation">,</span> <span class="token function">$boolean</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">types</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"instantiations"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token function">bench</span><span class="token punctuation">(</span><span class="token string">"boolean: ?!="</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> <span class="token function">op</span><span class="token punctuation">(</span><span class="token function">$boolean</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"?!="</span><span class="token punctuation">,</span> <span class="token function">$boolean</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">types</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"instantiations"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token function">bench</span><span class="token punctuation">(</span><span class="token string">"boolean: and"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> <span class="token function">op</span><span class="token punctuation">(</span><span class="token function">$boolean</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"and"</span><span class="token punctuation">,</span> <span class="token function">$boolean</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">types</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"instantiations"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token function">bench</span><span class="token punctuation">(</span><span class="token string">"boolean: or"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> <span class="token function">op</span><span class="token punctuation">(</span><span class="token function">$boolean</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"or"</span><span class="token punctuation">,</span> <span class="token function">$boolean</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">types</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"instantiations"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token function">bench</span><span class="token punctuation">(</span><span class="token string">"boolean: not"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> <span class="token function">op</span><span class="token punctuation">(</span><span class="token string">"not"</span><span class="token punctuation">,</span> <span class="token function">$boolean</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">types</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"instantiations"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token function">bench</span><span class="token punctuation">(</span><span class="token string">"nested boolean: ="</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> <span class="token function">op</span><span class="token punctuation">(</span><span class="token function">op</span><span class="token punctuation">(</span><span class="token function">$string</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"="</span><span class="token punctuation">,</span> <span class="token function">$string</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"="</span><span class="token punctuation">,</span> <span class="token function">$boolean</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">types</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"instantiations"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token function">bench</span><span class="token punctuation">(</span><span class="token string">"string: ilike"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> <span class="token function">op</span><span class="token punctuation">(</span><span class="token function">$string</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"ilike"</span><span class="token punctuation">,</span> <span class="token function">$string</span><span class="token punctuation">(</span><span class="token string">"apex"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">types</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"instantiations"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token function">bench</span><span class="token punctuation">(</span><span class="token string">"string: not ilike"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> <span class="token function">op</span><span class="token punctuation">(</span><span class="token function">$string</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"not ilike"</span><span class="token punctuation">,</span> <span class="token function">$string</span><span class="token punctuation">(</span><span class="token string">"apex"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">types</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"instantiations"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></pre></div></div><div class="code_showMore__zHUml">Show more<svg viewBox="0 0 9 8" xmlns="http://www.w3.org/2000/svg" width="9px" height="8px"><path d="M8.544 1.221L5.032 7.304a.814.814 0 0 1-1.41 0L.11 1.221A.814.814 0 0 1 .815 0H7.84a.814.814 0 0 1 .705 1.221z" fill="currentColor" fill-rule="nonzero"></path></svg></div></div>
<p class="">Running this benchmark with <code class="">tsx</code> will give us the following output:</p>
<div class="code_code__f6VbY code-language-bash  blogPost_codeBlock__DLXTS code_repl__r4TUI code_collapsed__HCQkh" style="--maxLineLength:73;--code-max-height:12"><div class="code_highlightWrapper__8YM2j code_hasCopyButton__vL2_6"><div class="code_copyCodeButtonWrapper__gi2zF"><div class="code_copyCode__EvySm"><svg width="13" height="15" viewBox="0 0 13 15" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="3.5" y="3.5" width="9" height="11" rx="1.5" stroke="currentColor"></rect><rect width="10" height="12" rx="2" fill="currentColor"></rect></svg><span class="code_copyLabel__9W53T">Copy</span></div></div><div class="code_block__73rl_" translate="no"><div class="code_codePart__T3ELt code-language-bash"><pre> $ </pre><pre><span class="tokens tokens-normal">npx tsx bench.ts</span></pre></div><div class="code_outPart__nb_c_"><pre> 🏌️  string: =
 ⛳ Result: 8 instantiations
 🎯 Baseline: 1 instantiations
 📈 'string: =' exceeded baseline by 700.00% (threshold is 20%).

 🏌️  string: !=
 ⛳ Result: 12 instantiations
 🎯 Baseline: 1 instantiations
 📈 'string: !=' exceeded baseline by 1100.00% (threshold is 20%).

 🏌️  string: &gt;
 ⛳ Result: 16 instantiations
 🎯 Baseline: 1 instantiations
 📈 'string: &gt;' exceeded baseline by 1500.00% (threshold is 20%).

 🏌️  string: &lt;
 ⛳ Result: 20 instantiations
 🎯 Baseline: 1 instantiations
 📈 'string: &lt;' exceeded baseline by 1900.00% (threshold is 20%).

 🏌️  string: &gt;=
 ⛳ Result: 24 instantiations
 🎯 Baseline: 1 instantiations
 📈 'string: &gt;=' exceeded baseline by 2300.00% (threshold is 20%).

 🏌️  string: &lt;=
 ⛳ Result: 28 instantiations
 🎯 Baseline: 1 instantiations
 📈 'string: &lt;=' exceeded baseline by 2700.00% (threshold is 20%).

 🏌️  string: ?=
 ⛳ Result: 32 instantiations
 🎯 Baseline: 1 instantiations
 📈 'string: ?=' exceeded baseline by 3100.00% (threshold is 20%).

 🏌️  string: ?!=
 ⛳ Result: 36 instantiations
 🎯 Baseline: 1 instantiations
 📈 'string: ?!=' exceeded baseline by 3500.00% (threshold is 20%).

 🏌️  string: ++
 ⛳ Result: 93 instantiations
 🎯 Baseline: 1 instantiations
 📈 'string: ++' exceeded baseline by 9200.00% (threshold is 20%).

 🏌️  number: =
 ⛳ Result: 17 instantiations
 🎯 Baseline: 1 instantiations
 📈 'number: =' exceeded baseline by 1600.00% (threshold is 20%).

 🏌️  number: !=
 ⛳ Result: 21 instantiations
 🎯 Baseline: 1 instantiations
 📈 'number: !=' exceeded baseline by 2000.00% (threshold is 20%).

 🏌️  number: &gt;
 ⛳ Result: 25 instantiations
 🎯 Baseline: 1 instantiations
 📈 'number: &gt;' exceeded baseline by 2400.00% (threshold is 20%).

 🏌️  number: &lt;
 ⛳ Result: 29 instantiations
 🎯 Baseline: 1 instantiations
 📈 'number: &lt;' exceeded baseline by 2800.00% (threshold is 20%).

 🏌️  number: &gt;=
 ⛳ Result: 33 instantiations
 🎯 Baseline: 1 instantiations
 📈 'number: &gt;=' exceeded baseline by 3200.00% (threshold is 20%).

 🏌️  number: &lt;=
 ⛳ Result: 37 instantiations
 🎯 Baseline: 1 instantiations
 📈 'number: &lt;=' exceeded baseline by 3600.00% (threshold is 20%).

 🏌️  number: ?=
 ⛳ Result: 41 instantiations
 🎯 Baseline: 1 instantiations
 📈 'number: ?=' exceeded baseline by 4000.00% (threshold is 20%).

 🏌️  number: ?!=
 ⛳ Result: 45 instantiations
 🎯 Baseline: 1 instantiations
 📈 'number: ?!=' exceeded baseline by 4400.00% (threshold is 20%).

 🏌️  number: +
 ⛳ Result: 71 instantiations
 🎯 Baseline: 1 instantiations
 📈 'number: +' exceeded baseline by 7000.00% (threshold is 20%).

 🏌️  number: -
 ⛳ Result: 75 instantiations
 🎯 Baseline: 1 instantiations
 📈 'number: -' exceeded baseline by 7400.00% (threshold is 20%).

 🏌️  number: *
 ⛳ Result: 79 instantiations
 🎯 Baseline: 1 instantiations
 📈 'number: *' exceeded baseline by 7800.00% (threshold is 20%).

 🏌️  number: /
 ⛳ Result: 83 instantiations
 🎯 Baseline: 1 instantiations
 📈 'number: /' exceeded baseline by 8200.00% (threshold is 20%).

 🏌️  number: %
 ⛳ Result: 87 instantiations
 🎯 Baseline: 1 instantiations
 📈 'number: %' exceeded baseline by 8600.00% (threshold is 20%).

 🏌️  number: //
 ⛳ Result: 91 instantiations
 🎯 Baseline: 1 instantiations
 📈 'number: //' exceeded baseline by 9000.00% (threshold is 20%).

 🏌️  number: ^
 ⛳ Result: 95 instantiations
 🎯 Baseline: 1 instantiations
 📈 'number: ^' exceeded baseline by 9400.00% (threshold is 20%).

 🏌️  number: unary +
 ⛳ Result: 5 instantiations
 🎯 Baseline: 1 instantiations
 📈 'number: unary +' exceeded baseline by 400.00% (threshold is 20%).

 🏌️  number: unary -
 ⛳ Result: 6 instantiations
 🎯 Baseline: 1 instantiations
 📈 'number: unary -' exceeded baseline by 500.00% (threshold is 20%).

 🏌️  boolean: =
 ⛳ Result: 20 instantiations
 🎯 Baseline: 1 instantiations
 📈 'boolean: =' exceeded baseline by 1900.00% (threshold is 20%).

 🏌️  boolean: !=
 ⛳ Result: 25 instantiations
 🎯 Baseline: 1 instantiations
 📈 'boolean: !=' exceeded baseline by 2400.00% (threshold is 20%).

 🏌️  boolean: &gt;
 ⛳ Result: 29 instantiations
 🎯 Baseline: 1 instantiations
 📈 'boolean: &gt;' exceeded baseline by 2800.00% (threshold is 20%).

 🏌️  boolean: &lt;
 ⛳ Result: 33 instantiations
 🎯 Baseline: 1 instantiations
 📈 'boolean: &lt;' exceeded baseline by 3200.00% (threshold is 20%).

 🏌️  boolean: &gt;=
 ⛳ Result: 37 instantiations
 🎯 Baseline: 1 instantiations
 📈 'boolean: &gt;=' exceeded baseline by 3600.00% (threshold is 20%).

 🏌️  boolean: &lt;=
 ⛳ Result: 41 instantiations
 🎯 Baseline: 1 instantiations
 📈 'boolean: &lt;=' exceeded baseline by 4000.00% (threshold is 20%).

 🏌️  boolean: ?=
 ⛳ Result: 45 instantiations
 🎯 Baseline: 1 instantiations
 📈 'boolean: ?=' exceeded baseline by 4400.00% (threshold is 20%).

 🏌️  boolean: ?!=
 ⛳ Result: 49 instantiations
 🎯 Baseline: 1 instantiations
 📈 'boolean: ?!=' exceeded baseline by 4800.00% (threshold is 20%).

 🏌️  boolean: and
 ⛳ Result: 53 instantiations
 🎯 Baseline: 1 instantiations
 📈 'boolean: and' exceeded baseline by 5200.00% (threshold is 20%).

 🏌️  boolean: or
 ⛳ Result: 57 instantiations
 🎯 Baseline: 1 instantiations
 📈 'boolean: or' exceeded baseline by 5600.00% (threshold is 20%).

 🏌️  boolean: not
 ⛳ Result: 3 instantiations
 🎯 Baseline: 1 instantiations
 📈 'boolean: not' exceeded baseline by 200.00% (threshold is 20%).

 🏌️  nested boolean: =
 ⛳ Result: 28 instantiations
 🎯 Baseline: 1 instantiations
 📈 'nested boolean: =' exceeded baseline by 2700.00% (threshold is 20%).

 🏌️  string: ilike
 ⛳ Result: 85 instantiations
 🎯 Baseline: 1 instantiations
 📈 'string: ilike' exceeded baseline by 8400.00% (threshold is 20%).

 🏌️  string: not ilike
 ⛳ Result: 89 instantiations
 🎯 Baseline: 1 instantiations
 📈 'string: not ilike' exceeded baseline by 8800.00% (threshold is 20%).

 ❌ 'string: =' exceeded baseline by 700.00% (threshold is 20%).
 ❌ 'string: !=' exceeded baseline by 1100.00% (threshold is 20%).
 ❌ 'string: &gt;' exceeded baseline by 1500.00% (threshold is 20%).
 ❌ 'string: &lt;' exceeded baseline by 1900.00% (threshold is 20%).
 ❌ 'string: &gt;=' exceeded baseline by 2300.00% (threshold is 20%).
 ❌ 'string: &lt;=' exceeded baseline by 2700.00% (threshold is 20%).
 ❌ 'string: ?=' exceeded baseline by 3100.00% (threshold is 20%).
 ❌ 'string: ?!=' exceeded baseline by 3500.00% (threshold is 20%).
 ❌ 'string: ++' exceeded baseline by 9200.00% (threshold is 20%).
 ❌ 'number: =' exceeded baseline by 1600.00% (threshold is 20%).
 ❌ 'number: !=' exceeded baseline by 2000.00% (threshold is 20%).
 ❌ 'number: &gt;' exceeded baseline by 2400.00% (threshold is 20%).
 ❌ 'number: &lt;' exceeded baseline by 2800.00% (threshold is 20%).
 ❌ 'number: &gt;=' exceeded baseline by 3200.00% (threshold is 20%).
 ❌ 'number: &lt;=' exceeded baseline by 3600.00% (threshold is 20%).
 ❌ 'number: ?=' exceeded baseline by 4000.00% (threshold is 20%).
 ❌ 'number: ?!=' exceeded baseline by 4400.00% (threshold is 20%).
 ❌ 'number: +' exceeded baseline by 7000.00% (threshold is 20%).
 ❌ 'number: -' exceeded baseline by 7400.00% (threshold is 20%).
 ❌ 'number: *' exceeded baseline by 7800.00% (threshold is 20%).
 ❌ 'number: /' exceeded baseline by 8200.00% (threshold is 20%).
 ❌ 'number: %' exceeded baseline by 8600.00% (threshold is 20%).
 ❌ 'number: //' exceeded baseline by 9000.00% (threshold is 20%).
 ❌ 'number: ^' exceeded baseline by 9400.00% (threshold is 20%).
 ❌ 'number: unary +' exceeded baseline by 400.00% (threshold is 20%).
 ❌ 'number: unary -' exceeded baseline by 500.00% (threshold is 20%).
 ❌ 'boolean: =' exceeded baseline by 1900.00% (threshold is 20%).
 ❌ 'boolean: !=' exceeded baseline by 2400.00% (threshold is 20%).
 ❌ 'boolean: &gt;' exceeded baseline by 2800.00% (threshold is 20%).
 ❌ 'boolean: &lt;' exceeded baseline by 3200.00% (threshold is 20%).
 ❌ 'boolean: &gt;=' exceeded baseline by 3600.00% (threshold is 20%).
 ❌ 'boolean: &lt;=' exceeded baseline by 4000.00% (threshold is 20%).
 ❌ 'boolean: ?=' exceeded baseline by 4400.00% (threshold is 20%).
 ❌ 'boolean: ?!=' exceeded baseline by 4800.00% (threshold is 20%).
 ❌ 'boolean: and' exceeded baseline by 5200.00% (threshold is 20%).
 ❌ 'boolean: or' exceeded baseline by 5600.00% (threshold is 20%).
 ❌ 'boolean: not' exceeded baseline by 200.00% (threshold is 20%).
 ❌ 'nested boolean: =' exceeded baseline by 2700.00% (threshold is 20%).
 ❌ 'string: ilike' exceeded baseline by 8400.00% (threshold is 20%).
 ❌ 'string: not ilike' exceeded baseline by 8800.00% (threshold is 20%).</pre></div></div></div><div class="code_showMore__zHUml">Show more<svg viewBox="0 0 9 8" xmlns="http://www.w3.org/2000/svg" width="9px" height="8px"><path d="M8.544 1.221L5.032 7.304a.814.814 0 0 1-1.41 0L.11 1.221A.814.814 0 0 1 .815 0H7.84a.814.814 0 0 1 .705 1.221z" fill="currentColor" fill-rule="nonzero"></path></svg></div></div>
<p class="">The <code class="">@arktype/attest</code> output provides a detailed breakdown of type instantiations for each expression, comparing them to our initial placeholder baseline. We’ll use these results as our actual baseline, updating our benchmark script with the real instantiation counts.</p>
</div>
<div data-section-id="the-bam-method" id="the-bam-method" class="base_section__z_4nJ blogPost_section__aSmVz">
<h2 id="the-bam-method" class="headerLink_header__L_1Jm">The BAM Method<span class="headerLink_popupWrapper__fYhfO">​<div class="headerLink_linkPopup__K0HFc"><div class="headerLink_popupBg__g_IfY"></div><div class="headerLink_linksInner__mj5XG"><a href="https://www.edgedb.com/blog/an-approach-to-optimizing-typescript-type-checking-performance#the-bam-method"><svg width="18" height="14" viewBox="0 0 18 14" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10 2H3C2.44772 2 2 2.44772 2 3V7C2 7.55228 2.44772 8 3 8H10C10.5523 8 11 7.55228 11 7H13C13 8.65685 11.6569 10 10 10H3C1.34315 10 0 8.65685 0 7V3C0 1.34315 1.34315 0 3 0H10C11.6569 0 13 1.34315 13 3H11C11 2.44772 10.5523 2 10 2ZM15 6H8C7.44772 6 7 6.44772 7 7H5C5 5.34315 6.34315 4 8 4H15C16.6569 4 18 5.34315 18 7V11C18 12.6569 16.6569 14 15 14H8C6.34315 14 5 12.6569 5 11H7C7 11.5523 7.44772 12 8 12H15C15.5523 12 16 11.5523 16 11V7C16 6.44771 15.5523 6 15 6Z" fill="currentColor"></path></svg></a></div></div></span></h2>
<p class="">To address TypeScript type inference performance issues, I propose the “BAM” method: Branch, Adjust, Measure. This iterative approach involves:</p>
<ol class="">
<li class="">
<p class=""><b class="">Branch</b>: Create a new branch for each experiment</p>
</li>
<li class="">
<p class=""><b class="">Adjust</b>: Make changes based on a hypothesis</p>
</li>
<li class="">
<p class=""><b class="">Measure</b>: Benchmark the changes to measure their impact</p>
</li>
</ol>
<p class="">By systematically applying this process, we can refine our code for better type inference performance. Crucially, the benchmarking step provides concrete measurements, ensuring we can verify our improvements.</p>
<p class="">First, we’ll <em class="">branch</em> to create a new experimental version of our code. Let’s assume that we’re working on a branch called <code class="">1234-some-perf-work</code>. We will name this new experimental branch <code class="">1234-experiments/union-operators</code>.</p>
<p class="">Our hypothesis is that defining a union to describe the various operators for a given operand-pair might be faster for the type checker to infer. This approach could potentially reduce the number of overloads the type checker needs to consider, as it groups similar operations together. By consolidating the operator types into a union, we might simplify the type inference process, potentially leading to fewer type instantiations and improved performance.</p>
<p class="">Then, we’ll <em class="">adjust</em> our implementation based on this hypothesis. After making these adjustments, we’ll <em class="">measure</em> the impact using our benchmarking tools to verify if our hypothesis leads to improved performance.</p>
<p class="">Branch:</p>
<div class="code_code__f6VbY code-language-bash  blogPost_codeBlock__DLXTS code_repl__r4TUI" style="--maxLineLength:70;--code-max-height:12"><div class="code_highlightWrapper__8YM2j code_hasCopyButton__vL2_6"><div class="code_copyCodeButtonWrapper__gi2zF"><div class="code_copyCode__EvySm"><svg width="13" height="15" viewBox="0 0 13 15" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="3.5" y="3.5" width="9" height="11" rx="1.5" stroke="currentColor"></rect><rect width="10" height="12" rx="2" fill="currentColor"></rect></svg><span class="code_copyLabel__9W53T">Copy</span></div></div><div class="code_block__73rl_" translate="no"><div class="code_codePart__T3ELt code-language-bash"><pre>$ </pre><pre><span class="tokens tokens-normal"><span class="token function">git</span> checkout <span class="token parameter variable">-b</span> <span class="token number">1234</span>-experiments/union-operators <span class="token number">1234</span>-some-perf-work</span></pre></div><div class="code_outPart__nb_c_"><pre></pre></div></div></div></div>
<p class="">Adjust:</p>
<div class="code_code__f6VbY code-language-typescript  blogPost_codeBlock__DLXTS code_collapsed__HCQkh" style="--maxLineLength:77;--code-max-height:12"><div class="code_highlightWrapper__8YM2j code_hasCopyButton__vL2_6"><div class="code_copyCodeButtonWrapper__gi2zF"><div class="code_copyCode__EvySm"><svg width="13" height="15" viewBox="0 0 13 15" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="3.5" y="3.5" width="9" height="11" rx="1.5" stroke="currentColor"></rect><rect width="10" height="12" rx="2" fill="currentColor"></rect></svg><span class="code_copyLabel__9W53T">Copy</span></div></div><div class="code_block__73rl_" translate="no"><pre><span class="tokens tokens-normal"> <span class="token keyword">function</span> <span class="token generic-function"><span class="token function">op</span><span class="token generic class-name"><span class="token operator">&lt;</span>Opr1 <span class="token keyword">extends</span> TypeSet<span class="token operator">&lt;</span>$String<span class="token operator">&gt;</span><span class="token punctuation">,</span> Opr2 <span class="token keyword">extends</span> TypeSet<span class="token operator">&lt;</span>$String<span class="token operator">&gt;&gt;</span></span></span><span class="token punctuation">(</span>
   opr1<span class="token operator">:</span> Opr1<span class="token punctuation">,</span>
   op<span class="token operator">:</span> <span class="token string">"="</span> <span class="token operator">|</span> <span class="token string">"!="</span> <span class="token operator">|</span> <span class="token string">"&gt;"</span> <span class="token operator">|</span> <span class="token string">"&lt;"</span> <span class="token operator">|</span> <span class="token string">"&gt;="</span> <span class="token operator">|</span> <span class="token string">"&lt;="</span> <span class="token operator">|</span> <span class="token string">"ilike"</span> <span class="token operator">|</span> <span class="token string">"not ilike"</span><span class="token punctuation">,</span>
   opr2<span class="token operator">:</span> Opr2<span class="token punctuation">,</span>
 <span class="token punctuation">)</span><span class="token operator">:</span> TypeSet<span class="token operator">&lt;</span>$Boolean<span class="token punctuation">,</span> Cardinality<span class="token punctuation">.</span>One<span class="token operator">&gt;</span><span class="token punctuation">;</span>
 <span class="token keyword">function</span> <span class="token generic-function"><span class="token function">op</span><span class="token generic class-name"><span class="token operator">&lt;</span>Opr1 <span class="token keyword">extends</span> TypeSet<span class="token operator">&lt;</span>$String<span class="token operator">&gt;</span><span class="token punctuation">,</span> Opr2 <span class="token keyword">extends</span> TypeSet<span class="token operator">&lt;</span>$String<span class="token operator">&gt;&gt;</span></span></span><span class="token punctuation">(</span>
   opr1<span class="token operator">:</span> Opr1<span class="token punctuation">,</span>
   op<span class="token operator">:</span> <span class="token string">"?="</span> <span class="token operator">|</span> <span class="token string">"!?="</span><span class="token punctuation">,</span>
   opr2<span class="token operator">:</span> Opr2<span class="token punctuation">,</span>
 <span class="token punctuation">)</span><span class="token operator">:</span> TypeSet<span class="token operator">&lt;</span>$Boolean<span class="token punctuation">,</span> Cardinality<span class="token punctuation">.</span>AtMostOne<span class="token operator">&gt;</span><span class="token punctuation">;</span>

 <span class="token keyword">function</span> <span class="token generic-function"><span class="token function">op</span><span class="token generic class-name"><span class="token operator">&lt;</span>Opr1 <span class="token keyword">extends</span> TypeSet<span class="token operator">&lt;</span>$Number<span class="token operator">&gt;</span><span class="token punctuation">,</span> Opr2 <span class="token keyword">extends</span> TypeSet<span class="token operator">&lt;</span>$Number<span class="token operator">&gt;&gt;</span></span></span><span class="token punctuation">(</span>
   opr1<span class="token operator">:</span> Opr1<span class="token punctuation">,</span>
   op<span class="token operator">:</span> <span class="token string">"="</span> <span class="token operator">|</span> <span class="token string">"!="</span> <span class="token operator">|</span> <span class="token string">"&gt;"</span> <span class="token operator">|</span> <span class="token string">"&lt;"</span> <span class="token operator">|</span> <span class="token string">"&gt;="</span> <span class="token operator">|</span> <span class="token string">"&lt;="</span><span class="token punctuation">,</span>
   opr2<span class="token operator">:</span> Opr2<span class="token punctuation">,</span>
 <span class="token punctuation">)</span><span class="token operator">:</span> TypeSet<span class="token operator">&lt;</span>$Boolean<span class="token punctuation">,</span> Cardinality<span class="token punctuation">.</span>One<span class="token operator">&gt;</span><span class="token punctuation">;</span>
 <span class="token keyword">function</span> <span class="token generic-function"><span class="token function">op</span><span class="token generic class-name"><span class="token operator">&lt;</span>Opr1 <span class="token keyword">extends</span> TypeSet<span class="token operator">&lt;</span>$Number<span class="token operator">&gt;</span><span class="token punctuation">,</span> Opr2 <span class="token keyword">extends</span> TypeSet<span class="token operator">&lt;</span>$Number<span class="token operator">&gt;&gt;</span></span></span><span class="token punctuation">(</span>
   opr1<span class="token operator">:</span> Opr1<span class="token punctuation">,</span>
   op<span class="token operator">:</span> <span class="token string">"?="</span> <span class="token operator">|</span> <span class="token string">"!?="</span><span class="token punctuation">,</span>
   opr2<span class="token operator">:</span> Opr2<span class="token punctuation">,</span>
 <span class="token punctuation">)</span><span class="token operator">:</span> TypeSet<span class="token operator">&lt;</span>$Boolean<span class="token punctuation">,</span> Cardinality<span class="token punctuation">.</span>AtMostOne<span class="token operator">&gt;</span><span class="token punctuation">;</span>

 <span class="token keyword">function</span> <span class="token generic-function"><span class="token function">op</span><span class="token generic class-name"><span class="token operator">&lt;</span>Opr1 <span class="token keyword">extends</span> TypeSet<span class="token operator">&lt;</span>$Boolean<span class="token operator">&gt;</span><span class="token punctuation">,</span> Opr2 <span class="token keyword">extends</span> TypeSet<span class="token operator">&lt;</span>$Boolean<span class="token operator">&gt;&gt;</span></span></span><span class="token punctuation">(</span>
   opr1<span class="token operator">:</span> Opr1<span class="token punctuation">,</span>
   op<span class="token operator">:</span> <span class="token string">"="</span> <span class="token operator">|</span> <span class="token string">"!="</span> <span class="token operator">|</span> <span class="token string">"&gt;"</span> <span class="token operator">|</span> <span class="token string">"&lt;"</span> <span class="token operator">|</span> <span class="token string">"&gt;="</span> <span class="token operator">|</span> <span class="token string">"&lt;="</span> <span class="token operator">|</span> <span class="token string">"and"</span> <span class="token operator">|</span> <span class="token string">"or"</span><span class="token punctuation">,</span>
   opr2<span class="token operator">:</span> Opr2<span class="token punctuation">,</span>
 <span class="token punctuation">)</span><span class="token operator">:</span> TypeSet<span class="token operator">&lt;</span>$Boolean<span class="token punctuation">,</span> Cardinality<span class="token punctuation">.</span>One<span class="token operator">&gt;</span><span class="token punctuation">;</span>
 <span class="token keyword">function</span> <span class="token generic-function"><span class="token function">op</span><span class="token generic class-name"><span class="token operator">&lt;</span>Opr1 <span class="token keyword">extends</span> TypeSet<span class="token operator">&lt;</span>$Boolean<span class="token operator">&gt;</span><span class="token punctuation">,</span> Opr2 <span class="token keyword">extends</span> TypeSet<span class="token operator">&lt;</span>$Boolean<span class="token operator">&gt;&gt;</span></span></span><span class="token punctuation">(</span>
   opr1<span class="token operator">:</span> Opr1<span class="token punctuation">,</span>
   op<span class="token operator">:</span> <span class="token string">"?="</span> <span class="token operator">|</span> <span class="token string">"!?="</span><span class="token punctuation">,</span>
   opr2<span class="token operator">:</span> Opr2<span class="token punctuation">,</span>
 <span class="token punctuation">)</span><span class="token operator">:</span> TypeSet<span class="token operator">&lt;</span>$Boolean<span class="token punctuation">,</span> Cardinality<span class="token punctuation">.</span>AtMostOne<span class="token operator">&gt;</span><span class="token punctuation">;</span>

 <span class="token keyword">function</span> <span class="token generic-function"><span class="token function">op</span><span class="token generic class-name"><span class="token operator">&lt;</span>Opr1 <span class="token keyword">extends</span> TypeSet<span class="token operator">&lt;</span>$Number<span class="token operator">&gt;</span><span class="token punctuation">,</span> Opr2 <span class="token keyword">extends</span> TypeSet<span class="token operator">&lt;</span>$Number<span class="token operator">&gt;&gt;</span></span></span><span class="token punctuation">(</span>
   opr1<span class="token operator">:</span> Opr1<span class="token punctuation">,</span>
   op<span class="token operator">:</span> <span class="token string">"+"</span> <span class="token operator">|</span> <span class="token string">"-"</span> <span class="token operator">|</span> <span class="token string">"*"</span> <span class="token operator">|</span> <span class="token string">"/"</span> <span class="token operator">|</span> <span class="token string">"%"</span> <span class="token operator">|</span> <span class="token string">"//"</span> <span class="token operator">|</span> <span class="token string">"^"</span><span class="token punctuation">,</span>
   opr2<span class="token operator">:</span> Opr2<span class="token punctuation">,</span>
 <span class="token punctuation">)</span><span class="token operator">:</span> TypeSet<span class="token operator">&lt;</span>$Number<span class="token punctuation">,</span> Cardinality<span class="token punctuation">.</span>One<span class="token operator">&gt;</span><span class="token punctuation">;</span>

 <span class="token keyword">function</span> <span class="token generic-function"><span class="token function">op</span><span class="token generic class-name"><span class="token operator">&lt;</span>Opr <span class="token keyword">extends</span> TypeSet<span class="token operator">&lt;</span>$Number<span class="token operator">&gt;&gt;</span></span></span><span class="token punctuation">(</span>
   op<span class="token operator">:</span> <span class="token string">"+"</span> <span class="token operator">|</span> <span class="token string">"-"</span><span class="token punctuation">,</span>
   opr<span class="token operator">:</span> Opr<span class="token punctuation">,</span>
 <span class="token punctuation">)</span><span class="token operator">:</span> TypeSet<span class="token operator">&lt;</span>$Number<span class="token punctuation">,</span> Cardinality<span class="token punctuation">.</span>One<span class="token operator">&gt;</span><span class="token punctuation">;</span>

 <span class="token keyword">function</span> <span class="token generic-function"><span class="token function">op</span><span class="token generic class-name"><span class="token operator">&lt;</span>Opr <span class="token keyword">extends</span> TypeSet<span class="token operator">&lt;</span>$Boolean<span class="token operator">&gt;&gt;</span></span></span><span class="token punctuation">(</span>
   op<span class="token operator">:</span> <span class="token string">"not"</span><span class="token punctuation">,</span>
   opr<span class="token operator">:</span> Opr<span class="token punctuation">,</span>
 <span class="token punctuation">)</span><span class="token operator">:</span> TypeSet<span class="token operator">&lt;</span>$Boolean<span class="token punctuation">,</span> Cardinality<span class="token punctuation">.</span>One<span class="token operator">&gt;</span><span class="token punctuation">;</span>

 <span class="token keyword">function</span> <span class="token generic-function"><span class="token function">op</span><span class="token generic class-name"><span class="token operator">&lt;</span>Opr1 <span class="token keyword">extends</span> TypeSet<span class="token operator">&lt;</span>$String<span class="token operator">&gt;</span><span class="token punctuation">,</span> Opr2 <span class="token keyword">extends</span> TypeSet<span class="token operator">&lt;</span>$String<span class="token operator">&gt;&gt;</span></span></span><span class="token punctuation">(</span>
   opr1<span class="token operator">:</span> Opr1<span class="token punctuation">,</span>
   op<span class="token operator">:</span> <span class="token string">"++"</span><span class="token punctuation">,</span>
   opr2<span class="token operator">:</span> Opr2<span class="token punctuation">,</span>
 <span class="token punctuation">)</span><span class="token operator">:</span> TypeSet<span class="token operator">&lt;</span>$String<span class="token punctuation">,</span> Cardinality<span class="token punctuation">.</span>One<span class="token operator">&gt;</span><span class="token punctuation">;</span></span></pre></div></div><div class="code_showMore__zHUml">Show more<svg viewBox="0 0 9 8" xmlns="http://www.w3.org/2000/svg" width="9px" height="8px"><path d="M8.544 1.221L5.032 7.304a.814.814 0 0 1-1.41 0L.11 1.221A.814.814 0 0 1 .815 0H7.84a.814.814 0 0 1 .705 1.221z" fill="currentColor" fill-rule="nonzero"></path></svg></div></div>
<p class="">Benchmark:</p>
<div class="code_code__f6VbY code-language-bash  blogPost_codeBlock__DLXTS code_repl__r4TUI code_collapsed__HCQkh" style="--maxLineLength:84;--code-max-height:12"><div class="code_highlightWrapper__8YM2j code_hasCopyButton__vL2_6"><div class="code_copyCodeButtonWrapper__gi2zF"><div class="code_copyCode__EvySm"><svg width="13" height="15" viewBox="0 0 13 15" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="3.5" y="3.5" width="9" height="11" rx="1.5" stroke="currentColor"></rect><rect width="10" height="12" rx="2" fill="currentColor"></rect></svg><span class="code_copyLabel__9W53T">Copy</span></div></div><div class="code_block__73rl_" translate="no"><div class="code_codePart__T3ELt code-language-bash"><pre> $ </pre><pre><span class="tokens tokens-normal">npx tsx bench.ts</span></pre></div><div class="code_outPart__nb_c_"><pre> 🏌️  string: =
 ⛳ Result: 12 instantiations
 🎯 Baseline: 8 instantiations
 📈 'string: =' exceeded baseline by 50.00% (threshold is 20%).

 🏌️  string: !=
 ⛳ Result: 12 instantiations
 🎯 Baseline: 12 instantiations
 📊 Delta: 0.00%

 🏌️  string: &gt;
 ⛳ Result: 12 instantiations
 🎯 Baseline: 16 instantiations
 📉 string: &gt; was under baseline by 25.00%! Consider setting a new baseline.

 🏌️  string: &lt;
 ⛳ Result: 12 instantiations
 🎯 Baseline: 20 instantiations
 📉 string: &lt; was under baseline by 40.00%! Consider setting a new baseline.

 🏌️  string: &gt;=
 ⛳ Result: 12 instantiations
 🎯 Baseline: 24 instantiations
 📉 string: &gt;= was under baseline by 50.00%! Consider setting a new baseline.

 🏌️  string: &lt;=
 ⛳ Result: 12 instantiations
 🎯 Baseline: 28 instantiations
 📉 string: &lt;= was under baseline by 57.14%! Consider setting a new baseline.

 🏌️  string: ?=
 ⛳ Result: 16 instantiations
 🎯 Baseline: 32 instantiations
 📉 string: ?= was under baseline by 50.00%! Consider setting a new baseline.

 🏌️  string: ?!=
 ⛳ Result: 16 instantiations
 🎯 Baseline: 36 instantiations
 📉 string: ?!= was under baseline by 55.56%! Consider setting a new baseline.

 🏌️  string: ++
 ⛳ Result: 8 instantiations
 🎯 Baseline: 102 instantiations
 📉 string: ++ was under baseline by 92.16%! Consider setting a new baseline.

 🏌️  number: =
 ⛳ Result: 16 instantiations
 🎯 Baseline: 26 instantiations
 📉 number: = was under baseline by 38.46%! Consider setting a new baseline.

 🏌️  number: !=
 ⛳ Result: 16 instantiations
 🎯 Baseline: 30 instantiations
 📉 number: != was under baseline by 46.67%! Consider setting a new baseline.

 🏌️  number: &gt;
 ⛳ Result: 16 instantiations
 🎯 Baseline: 34 instantiations
 📉 number: &gt; was under baseline by 52.94%! Consider setting a new baseline.

 🏌️  number: &lt;
 ⛳ Result: 16 instantiations
 🎯 Baseline: 38 instantiations
 📉 number: &lt; was under baseline by 57.89%! Consider setting a new baseline.

 🏌️  number: &gt;=
 ⛳ Result: 16 instantiations
 🎯 Baseline: 42 instantiations
 📉 number: &gt;= was under baseline by 61.90%! Consider setting a new baseline.

 🏌️  number: &lt;=
 ⛳ Result: 16 instantiations
 🎯 Baseline: 46 instantiations
 📉 number: &lt;= was under baseline by 65.22%! Consider setting a new baseline.

 🏌️  number: ?=
 ⛳ Result: 20 instantiations
 🎯 Baseline: 50 instantiations
 📉 number: ?= was under baseline by 60.00%! Consider setting a new baseline.

 🏌️  number: ?!=
 ⛳ Result: 20 instantiations
 🎯 Baseline: 54 instantiations
 📉 number: ?!= was under baseline by 62.96%! Consider setting a new baseline.

 🏌️  number: +
 ⛳ Result: 30 instantiations
 🎯 Baseline: 80 instantiations
 📉 number: + was under baseline by 62.50%! Consider setting a new baseline.

 🏌️  number: -
 ⛳ Result: 30 instantiations
 🎯 Baseline: 84 instantiations
 📉 number: - was under baseline by 64.29%! Consider setting a new baseline.

 🏌️  number: *
 ⛳ Result: 30 instantiations
 🎯 Baseline: 88 instantiations
 📉 number: * was under baseline by 65.91%! Consider setting a new baseline.

 🏌️  number: /
 ⛳ Result: 30 instantiations
 🎯 Baseline: 92 instantiations
 📉 number: / was under baseline by 67.39%! Consider setting a new baseline.

 🏌️  number: %
 ⛳ Result: 30 instantiations
 🎯 Baseline: 96 instantiations
 📉 number: % was under baseline by 68.75%! Consider setting a new baseline.

 🏌️  number: //
 ⛳ Result: 30 instantiations
 🎯 Baseline: 100 instantiations
 📉 number: // was under baseline by 70.00%! Consider setting a new baseline.

 🏌️  number: ^
 ⛳ Result: 30 instantiations
 🎯 Baseline: 104 instantiations
 📉 number: ^ was under baseline by 71.15%! Consider setting a new baseline.

 🏌️  number: unary +
 ⛳ Result: 6 instantiations
 🎯 Baseline: 5 instantiations
 📊 Delta: +20.00%

 🏌️  number: unary -
 ⛳ Result: 6 instantiations
 🎯 Baseline: 6 instantiations
 📊 Delta: 0.00%

 🏌️  boolean: =
 ⛳ Result: 22 instantiations
 🎯 Baseline: 44 instantiations
 📉 boolean: = was under baseline by 50.00%! Consider setting a new baseline.

 🏌️  boolean: !=
 ⛳ Result: 22 instantiations
 🎯 Baseline: 48 instantiations
 📉 boolean: != was under baseline by 54.17%! Consider setting a new baseline.

 🏌️  boolean: &gt;
 ⛳ Result: 22 instantiations
 🎯 Baseline: 52 instantiations
 📉 boolean: &gt; was under baseline by 57.69%! Consider setting a new baseline.

 🏌️  boolean: &lt;
 ⛳ Result: 22 instantiations
 🎯 Baseline: 56 instantiations
 📉 boolean: &lt; was under baseline by 60.71%! Consider setting a new baseline.

 🏌️  boolean: &gt;=
 ⛳ Result: 22 instantiations
 🎯 Baseline: 60 instantiations
 📉 boolean: &gt;= was under baseline by 63.33%! Consider setting a new baseline.

 🏌️  boolean: &lt;=
 ⛳ Result: 22 instantiations
 🎯 Baseline: 64 instantiations
 📉 boolean: &lt;= was under baseline by 65.63%! Consider setting a new baseline.

 🏌️  boolean: ?=
 ⛳ Result: 26 instantiations
 🎯 Baseline: 68 instantiations
 📉 boolean: ?= was under baseline by 61.76%! Consider setting a new baseline.

 🏌️  boolean: ?!=
 ⛳ Result: 26 instantiations
 🎯 Baseline: 72 instantiations
 📉 boolean: ?!= was under baseline by 63.89%! Consider setting a new baseline.

 🏌️  boolean: and
 ⛳ Result: 22 instantiations
 🎯 Baseline: 76 instantiations
 📉 boolean: and was under baseline by 71.05%! Consider setting a new baseline.

 🏌️  boolean: or
 ⛳ Result: 22 instantiations
 🎯 Baseline: 80 instantiations
 📉 boolean: or was under baseline by 72.50%! Consider setting a new baseline.

 🏌️  boolean: not
 ⛳ Result: 5 instantiations
 🎯 Baseline: 6 instantiations
 📊 Delta: -16.67%

 🏌️  nested boolean: =
 ⛳ Result: 41 instantiations
 🎯 Baseline: 48 instantiations
 📊 Delta: -14.58%

 🏌️  string: ilike
 ⛳ Result: 12 instantiations
 🎯 Baseline: 94 instantiations
 📉 string: ilike was under baseline by 87.23%! Consider setting a new baseline.

 🏌️  string: not ilike
 ⛳ Result: 12 instantiations
 🎯 Baseline: 98 instantiations
 📉 string: not ilike was under baseline by 87.76%! Consider setting a new baseline.

 ❌ 'string: =' exceeded baseline by 50.00% (threshold is 20%).</pre></div></div></div><div class="code_showMore__zHUml">Show more<svg viewBox="0 0 9 8" xmlns="http://www.w3.org/2000/svg" width="9px" height="8px"><path d="M8.544 1.221L5.032 7.304a.814.814 0 0 1-1.41 0L.11 1.221A.814.814 0 0 1 .815 0H7.84a.814.814 0 0 1 .705 1.221z" fill="currentColor" fill-rule="nonzero"></path></svg></div></div>
<p class="">Incredibly, everything with the exception of the very first operator and unary <code class="">+</code> got better. Let’s save a commit with these changes to this branch.</p>
<div class="code_code__f6VbY code-language-bash  blogPost_codeBlock__DLXTS code_repl__r4TUI" style="--maxLineLength:42;--code-max-height:12"><div class="code_highlightWrapper__8YM2j code_hasCopyButton__vL2_6"><div class="code_copyCodeButtonWrapper__gi2zF"><div class="code_copyCode__EvySm"><svg width="13" height="15" viewBox="0 0 13 15" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="3.5" y="3.5" width="9" height="11" rx="1.5" stroke="currentColor"></rect><rect width="10" height="12" rx="2" fill="currentColor"></rect></svg><span class="code_copyLabel__9W53T">Copy</span></div></div><div class="code_block__73rl_" translate="no"><div class="code_codePart__T3ELt code-language-bash"><pre>$ </pre><pre><span class="tokens tokens-normal"><span class="token function">git</span> commit <span class="token parameter variable">-m</span> <span class="token string">"Use a union of operators"</span></span></pre></div><div class="code_outPart__nb_c_"><pre></pre></div></div></div></div>
<p class="">I suggest making two separate commits: one with the changes to the implementation, and a second that updates the benchmark results. This makes it easier to compare approaches against the baseline, but also you can checkout the benchmark file across branches to compare how different approaches differ in the benchmarks. Let’s update the benchmark results in the <code class="">index.ts</code> file, and commit another change.</p>
<div class="code_code__f6VbY code-language-bash  blogPost_codeBlock__DLXTS code_repl__r4TUI" style="--maxLineLength:42;--code-max-height:12"><div class="code_highlightWrapper__8YM2j code_hasCopyButton__vL2_6"><div class="code_copyCodeButtonWrapper__gi2zF"><div class="code_copyCode__EvySm"><svg width="13" height="15" viewBox="0 0 13 15" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="3.5" y="3.5" width="9" height="11" rx="1.5" stroke="currentColor"></rect><rect width="10" height="12" rx="2" fill="currentColor"></rect></svg><span class="code_copyLabel__9W53T">Copy</span></div></div><div class="code_block__73rl_" translate="no"><div class="code_codePart__T3ELt code-language-bash"><pre>$ </pre><pre><span class="tokens tokens-normal"><span class="token function">git</span> commit <span class="token parameter variable">-m</span> <span class="token string">"Update benchmark results"</span></span></pre></div><div class="code_outPart__nb_c_"><pre></pre></div></div></div></div>
<p class="">Let’s branch again and explore a new hypothesis that builds on the existing construct. We will use the existing experiment as the starting point for our new branch rather than starting over from the base. However we should branch from the previous commit instead of the commit that updated the benchmarks. Let’s explore the hypothesis that the order of the overloads has an effect on the number of types the inference engine has to instantiate here. Let’s order them such that the same operators are grouped together.</p>
<div class="code_code__f6VbY code-language-bash  blogPost_codeBlock__DLXTS code_repl__r4TUI" style="--maxLineLength:76;--code-max-height:12"><div class="code_highlightWrapper__8YM2j code_hasCopyButton__vL2_6"><div class="code_copyCodeButtonWrapper__gi2zF"><div class="code_copyCode__EvySm"><svg width="13" height="15" viewBox="0 0 13 15" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="3.5" y="3.5" width="9" height="11" rx="1.5" stroke="currentColor"></rect><rect width="10" height="12" rx="2" fill="currentColor"></rect></svg><span class="code_copyLabel__9W53T">Copy</span></div></div><div class="code_block__73rl_" translate="no"><div class="code_codePart__T3ELt code-language-bash"><pre>$ </pre><pre><span class="tokens tokens-normal"><span class="token function">git</span> checkout <span class="token parameter variable">-b</span> <span class="token number">1234</span>-experiments/union-operators/group-by-operators HEAD~1</span></pre></div><div class="code_outPart__nb_c_"><pre></pre></div></div></div></div>
<p class="">Making our adjustments, we see the following benchmark results:</p>
<div class="code_code__f6VbY code-language-bash  blogPost_codeBlock__DLXTS code_repl__r4TUI code_collapsed__HCQkh" style="--maxLineLength:84;--code-max-height:12"><div class="code_highlightWrapper__8YM2j code_hasCopyButton__vL2_6"><div class="code_copyCodeButtonWrapper__gi2zF"><div class="code_copyCode__EvySm"><svg width="13" height="15" viewBox="0 0 13 15" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="3.5" y="3.5" width="9" height="11" rx="1.5" stroke="currentColor"></rect><rect width="10" height="12" rx="2" fill="currentColor"></rect></svg><span class="code_copyLabel__9W53T">Copy</span></div></div><div class="code_block__73rl_" translate="no"><div class="code_codePart__T3ELt code-language-bash"><pre> $ </pre><pre><span class="tokens tokens-normal">npx tsx bench.ts</span></pre></div><div class="code_outPart__nb_c_"><pre> 🏌️  string: =
 ⛳ Result: 12 instantiations
 🎯 Baseline: 8 instantiations
 📈 'string: =' exceeded baseline by 50.00% (threshold is 20%).

 🏌️  string: !=
 ⛳ Result: 12 instantiations
 🎯 Baseline: 12 instantiations
 📊 Delta: 0.00%

 🏌️  string: &gt;
 ⛳ Result: 12 instantiations
 🎯 Baseline: 16 instantiations
 📉 string: &gt; was under baseline by 25.00%! Consider setting a new baseline.

 🏌️  string: &lt;
 ⛳ Result: 12 instantiations
 🎯 Baseline: 20 instantiations
 📉 string: &lt; was under baseline by 40.00%! Consider setting a new baseline.

 🏌️  string: &gt;=
 ⛳ Result: 12 instantiations
 🎯 Baseline: 24 instantiations
 📉 string: &gt;= was under baseline by 50.00%! Consider setting a new baseline.

 🏌️  string: &lt;=
 ⛳ Result: 12 instantiations
 🎯 Baseline: 28 instantiations
 📉 string: &lt;= was under baseline by 57.14%! Consider setting a new baseline.

 🏌️  string: ?=
 ⛳ Result: 24 instantiations
 🎯 Baseline: 32 instantiations
 📉 string: ?= was under baseline by 25.00%! Consider setting a new baseline.

 🏌️  string: ?!=
 ⛳ Result: 24 instantiations
 🎯 Baseline: 36 instantiations
 📉 string: ?!= was under baseline by 33.33%! Consider setting a new baseline.

 🏌️  string: ++
 ⛳ Result: 8 instantiations
 🎯 Baseline: 102 instantiations
 📉 string: ++ was under baseline by 92.16%! Consider setting a new baseline.

 🏌️  number: =
 ⛳ Result: 14 instantiations
 🎯 Baseline: 26 instantiations
 📉 number: = was under baseline by 46.15%! Consider setting a new baseline.

 🏌️  number: !=
 ⛳ Result: 14 instantiations
 🎯 Baseline: 30 instantiations
 📉 number: != was under baseline by 53.33%! Consider setting a new baseline.

 🏌️  number: &gt;
 ⛳ Result: 14 instantiations
 🎯 Baseline: 34 instantiations
 📉 number: &gt; was under baseline by 58.82%! Consider setting a new baseline.

 🏌️  number: &lt;
 ⛳ Result: 14 instantiations
 🎯 Baseline: 38 instantiations
 📉 number: &lt; was under baseline by 63.16%! Consider setting a new baseline.

 🏌️  number: &gt;=
 ⛳ Result: 14 instantiations
 🎯 Baseline: 42 instantiations
 📉 number: &gt;= was under baseline by 66.67%! Consider setting a new baseline.

 🏌️  number: &lt;=
 ⛳ Result: 14 instantiations
 🎯 Baseline: 46 instantiations
 📉 number: &lt;= was under baseline by 69.57%! Consider setting a new baseline.

 🏌️  number: ?=
 ⛳ Result: 24 instantiations
 🎯 Baseline: 50 instantiations
 📉 number: ?= was under baseline by 52.00%! Consider setting a new baseline.

 🏌️  number: ?!=
 ⛳ Result: 24 instantiations
 🎯 Baseline: 54 instantiations
 📉 number: ?!= was under baseline by 55.56%! Consider setting a new baseline.

 🏌️  number: +
 ⛳ Result: 30 instantiations
 🎯 Baseline: 80 instantiations
 📉 number: + was under baseline by 62.50%! Consider setting a new baseline.

 🏌️  number: -
 ⛳ Result: 30 instantiations
 🎯 Baseline: 84 instantiations
 📉 number: - was under baseline by 64.29%! Consider setting a new baseline.

 🏌️  number: *
 ⛳ Result: 30 instantiations
 🎯 Baseline: 88 instantiations
 📉 number: * was under baseline by 65.91%! Consider setting a new baseline.

 🏌️  number: /
 ⛳ Result: 30 instantiations
 🎯 Baseline: 92 instantiations
 📉 number: / was under baseline by 67.39%! Consider setting a new baseline.

 🏌️  number: %
 ⛳ Result: 30 instantiations
 🎯 Baseline: 96 instantiations
 📉 number: % was under baseline by 68.75%! Consider setting a new baseline.

 🏌️  number: //
 ⛳ Result: 30 instantiations
 🎯 Baseline: 100 instantiations
 📉 number: // was under baseline by 70.00%! Consider setting a new baseline.

 🏌️  number: ^
 ⛳ Result: 30 instantiations
 🎯 Baseline: 104 instantiations
 📉 number: ^ was under baseline by 71.15%! Consider setting a new baseline.

 🏌️  number: unary +
 ⛳ Result: 6 instantiations
 🎯 Baseline: 5 instantiations
 📊 Delta: +20.00%

 🏌️  number: unary -
 ⛳ Result: 6 instantiations
 🎯 Baseline: 6 instantiations
 📊 Delta: 0.00%

 🏌️  boolean: =
 ⛳ Result: 18 instantiations
 🎯 Baseline: 44 instantiations
 📉 boolean: = was under baseline by 59.09%! Consider setting a new baseline.

 🏌️  boolean: !=
 ⛳ Result: 18 instantiations
 🎯 Baseline: 48 instantiations
 📉 boolean: != was under baseline by 62.50%! Consider setting a new baseline.

 🏌️  boolean: &gt;
 ⛳ Result: 18 instantiations
 🎯 Baseline: 52 instantiations
 📉 boolean: &gt; was under baseline by 65.38%! Consider setting a new baseline.

 🏌️  boolean: &lt;
 ⛳ Result: 18 instantiations
 🎯 Baseline: 56 instantiations
 📉 boolean: &lt; was under baseline by 67.86%! Consider setting a new baseline.

 🏌️  boolean: &gt;=
 ⛳ Result: 18 instantiations
 🎯 Baseline: 60 instantiations
 📉 boolean: &gt;= was under baseline by 70.00%! Consider setting a new baseline.

 🏌️  boolean: &lt;=
 ⛳ Result: 18 instantiations
 🎯 Baseline: 64 instantiations
 📉 boolean: &lt;= was under baseline by 71.88%! Consider setting a new baseline.

 🏌️  boolean: ?=
 ⛳ Result: 26 instantiations
 🎯 Baseline: 68 instantiations
 📉 boolean: ?= was under baseline by 61.76%! Consider setting a new baseline.

 🏌️  boolean: ?!=
 ⛳ Result: 26 instantiations
 🎯 Baseline: 72 instantiations
 📉 boolean: ?!= was under baseline by 63.89%! Consider setting a new baseline.

 🏌️  boolean: and
 ⛳ Result: 18 instantiations
 🎯 Baseline: 76 instantiations
 📉 boolean: and was under baseline by 76.32%! Consider setting a new baseline.

 🏌️  boolean: or
 ⛳ Result: 18 instantiations
 🎯 Baseline: 80 instantiations
 📉 boolean: or was under baseline by 77.50%! Consider setting a new baseline.

 🏌️  boolean: not
 ⛳ Result: 5 instantiations
 🎯 Baseline: 6 instantiations
 📊 Delta: -16.67%

 🏌️  nested boolean: =
 ⛳ Result: 39 instantiations
 🎯 Baseline: 48 instantiations
 📊 Delta: -18.75%

 🏌️  string: ilike
 ⛳ Result: 12 instantiations
 🎯 Baseline: 94 instantiations
 📉 string: ilike was under baseline by 87.23%! Consider setting a new baseline.

 🏌️  string: not ilike
 ⛳ Result: 12 instantiations
 🎯 Baseline: 98 instantiations
 📉 string: not ilike was under baseline by 87.76%! Consider setting a new baseline.

 ❌ 'string: =' exceeded baseline by 50.00% (threshold is 20%).</pre></div></div></div><div class="code_showMore__zHUml">Show more<svg viewBox="0 0 9 8" xmlns="http://www.w3.org/2000/svg" width="9px" height="8px"><path d="M8.544 1.221L5.032 7.304a.814.814 0 0 1-1.41 0L.11 1.221A.814.814 0 0 1 .815 0H7.84a.814.814 0 0 1 .705 1.221z" fill="currentColor" fill-rule="nonzero"></path></svg></div></div>
<p class="">This implementation is also great! Is it better than the previous experiment? We can check by checking out the benchmark commit from the other branch.</p>
<div class="code_code__f6VbY code-language-bash  blogPost_codeBlock__DLXTS code_repl__r4TUI code_showHighlight__tDAlE code_collapsed__HCQkh" style="--maxLineLength:65;--code-max-height:12"><div class="code_highlightWrapper__8YM2j code_hasCopyButton__vL2_6"><div class="code_copyCodeButtonWrapper__gi2zF"><div class="code_copyCode__EvySm"><svg width="13" height="15" viewBox="0 0 13 15" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="3.5" y="3.5" width="9" height="11" rx="1.5" stroke="currentColor"></rect><rect width="10" height="12" rx="2" fill="currentColor"></rect></svg><span class="code_copyLabel__9W53T">Copy</span></div></div><div class="code_block__73rl_" translate="no"><div class="code_codePart__T3ELt code-language-bash"><pre> $ </pre><pre><span class="tokens tokens-normal"><span class="token function">git</span> checkout <span class="token number">1234</span>-experiments/union-operators -- index.ts</span></pre></div><div class="code_outPart__nb_c_"><pre></pre></div></div></div><div class="code_highlightWrapper__8YM2j code_hasCopyButton__vL2_6"><div class="code_copyCodeButtonWrapper__gi2zF"><div class="code_copyCode__EvySm"><svg width="13" height="15" viewBox="0 0 13 15" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="3.5" y="3.5" width="9" height="11" rx="1.5" stroke="currentColor"></rect><rect width="10" height="12" rx="2" fill="currentColor"></rect></svg><span class="code_copyLabel__9W53T">Copy</span></div></div><div class="code_block__73rl_" translate="no"><div class="code_codePart__T3ELt code-language-bash"><pre> $ </pre><pre><span class="tokens tokens-normal">npx tsx index.ts</span></pre></div><div class="code_outPart__nb_c_"><pre> 🏌️  string: =
 ⛳ Result: 12 instantiations
 🎯 Baseline: 12 instantiations
 📊 Delta: 0.00%

 🏌️  string: !=
 ⛳ Result: 12 instantiations
 🎯 Baseline: 12 instantiations
 📊 Delta: 0.00%

 🏌️  string: &gt;
 ⛳ Result: 12 instantiations
 🎯 Baseline: 12 instantiations
 📊 Delta: 0.00%

 🏌️  string: &lt;
 ⛳ Result: 12 instantiations
 🎯 Baseline: 12 instantiations
 📊 Delta: 0.00%

 🏌️  string: &gt;=
 ⛳ Result: 12 instantiations
 🎯 Baseline: 12 instantiations
 📊 Delta: 0.00%

 🏌️  string: &lt;=
 ⛳ Result: 12 instantiations
 🎯 Baseline: 12 instantiations
 📊 Delta: 0.00%

 🏌️  string: ?=
 ⛳ Result: 24 instantiations
 🎯 Baseline: 16 instantiations
 📈 'string: ?=' exceeded baseline by 50.00% (threshold is 20%).

 🏌️  string: ?!=
 ⛳ Result: 24 instantiations
 🎯 Baseline: 16 instantiations
 📈 'string: ?!=' exceeded baseline by 50.00% (threshold is 20%).

 🏌️  string: ++
 ⛳ Result: 8 instantiations
 🎯 Baseline: 8 instantiations
 📊 Delta: 0.00%

 🏌️  number: =
 ⛳ Result: 14 instantiations
 🎯 Baseline: 16 instantiations
 📊 Delta: -12.50%

 🏌️  number: !=
 ⛳ Result: 14 instantiations
 🎯 Baseline: 16 instantiations
 📊 Delta: -12.50%

 🏌️  number: &gt;
 ⛳ Result: 14 instantiations
 🎯 Baseline: 16 instantiations
 📊 Delta: -12.50%

 🏌️  number: &lt;
 ⛳ Result: 14 instantiations
 🎯 Baseline: 16 instantiations
 📊 Delta: -12.50%

 🏌️  number: &gt;=
 ⛳ Result: 14 instantiations
 🎯 Baseline: 16 instantiations
 📊 Delta: -12.50%

 🏌️  number: &lt;=
 ⛳ Result: 14 instantiations
 🎯 Baseline: 16 instantiations
 📊 Delta: -12.50%

 🏌️  number: ?=
 ⛳ Result: 24 instantiations
 🎯 Baseline: 20 instantiations
 📊 Delta: +20.00%

 🏌️  number: ?!=
 ⛳ Result: 24 instantiations
 🎯 Baseline: 20 instantiations
 📊 Delta: +20.00%

 🏌️  number: +
 ⛳ Result: 30 instantiations
 🎯 Baseline: 30 instantiations
 📊 Delta: 0.00%

 🏌️  number: -
 ⛳ Result: 30 instantiations
 🎯 Baseline: 30 instantiations
 📊 Delta: 0.00%

 🏌️  number: *
 ⛳ Result: 30 instantiations
 🎯 Baseline: 30 instantiations
 📊 Delta: 0.00%

 🏌️  number: /
 ⛳ Result: 30 instantiations
 🎯 Baseline: 30 instantiations
 📊 Delta: 0.00%

 🏌️  number: %
 ⛳ Result: 30 instantiations
 🎯 Baseline: 30 instantiations
 📊 Delta: 0.00%

 🏌️  number: //
 ⛳ Result: 30 instantiations
 🎯 Baseline: 30 instantiations
 📊 Delta: 0.00%

 🏌️  number: ^
 ⛳ Result: 30 instantiations
 🎯 Baseline: 30 instantiations
 📊 Delta: 0.00%

 🏌️  number: unary +
 ⛳ Result: 6 instantiations
 🎯 Baseline: 6 instantiations
 📊 Delta: 0.00%

 🏌️  number: unary -
 ⛳ Result: 6 instantiations
 🎯 Baseline: 6 instantiations
 📊 Delta: 0.00%

 🏌️  boolean: =
 ⛳ Result: 18 instantiations
 🎯 Baseline: 22 instantiations
 📊 Delta: -18.18%

 🏌️  boolean: !=
 ⛳ Result: 18 instantiations
 🎯 Baseline: 22 instantiations
 📊 Delta: -18.18%

 🏌️  boolean: &gt;
 ⛳ Result: 18 instantiations
 🎯 Baseline: 22 instantiations
 📊 Delta: -18.18%

 🏌️  boolean: &lt;
 ⛳ Result: 18 instantiations
 🎯 Baseline: 22 instantiations
 📊 Delta: -18.18%

 🏌️  boolean: &gt;=
 ⛳ Result: 18 instantiations
 🎯 Baseline: 22 instantiations
 📊 Delta: -18.18%

 🏌️  boolean: &lt;=
 ⛳ Result: 18 instantiations
 🎯 Baseline: 22 instantiations
 📊 Delta: -18.18%

 🏌️  boolean: ?=
 ⛳ Result: 26 instantiations
 🎯 Baseline: 26 instantiations
 📊 Delta: 0.00%

 🏌️  boolean: ?!=
 ⛳ Result: 26 instantiations
 🎯 Baseline: 26 instantiations
 📊 Delta: 0.00%

 🏌️  boolean: and
 ⛳ Result: 18 instantiations
 🎯 Baseline: 22 instantiations
 📊 Delta: -18.18%

 🏌️  boolean: or
 ⛳ Result: 18 instantiations
 🎯 Baseline: 22 instantiations
 📊 Delta: -18.18%

 🏌️  boolean: not
 ⛳ Result: 5 instantiations
 🎯 Baseline: 5 instantiations
 📊 Delta: 0.00%

 🏌️  nested boolean: =
 ⛳ Result: 39 instantiations
 🎯 Baseline: 41 instantiations
 📊 Delta: -4.88%

 🏌️  string: ilike
 ⛳ Result: 12 instantiations
 🎯 Baseline: 12 instantiations
 📊 Delta: 0.00%

 🏌️  string: not ilike
 ⛳ Result: 12 instantiations
 🎯 Baseline: 12 instantiations
 📊 Delta: 0.00%

 ❌ 'string: ?=' exceeded baseline by 50.00% (threshold is 20%).
 ❌ 'string: ?!=' exceeded baseline by 50.00% (threshold is 20%).</pre></div></div></div><div class="code_showMore__zHUml">Show more<svg viewBox="0 0 9 8" xmlns="http://www.w3.org/2000/svg" width="9px" height="8px"><path d="M8.544 1.221L5.032 7.304a.814.814 0 0 1-1.41 0L.11 1.221A.814.814 0 0 1 .815 0H7.84a.814.814 0 0 1 .705 1.221z" fill="currentColor" fill-rule="nonzero"></path></svg></div></div>
<p class="">It looks like it’s consistently better with the exception of the <code class="">?=</code> and <code class="">?!=</code> operators, which makes some sense since it has moved further down the list of overloads. We can choose to abandon the original branch, and make this a new top-level experimental branch, or keep them both around. We’ll still split this experiment into two separate commits: the first that changes the implementation, and the second that updates the benchmarks.</p>
<p class="">Let’s look at another idea: maybe instead of clustering by operator, we should cluster by operand. After adjusting and benchmarking, it turns out this has roughly the same performance as <code class="">1234-experiments/union-operators</code> which since that branch just happened to be incidentally clustered by operand. A few of the operators got a little better, and a few got measureably worse. It is across-the-board worse than <code class="">1234-experiments/group-by-operator</code>, so we can abandon this new branch, and explore in other directions.</p>
<p class="">As you can see, having benchmarks that track the number of type instantiations for a given expression allows us to quantify our experiments, turning wild guesses on what might be faster into concrete measurements. Often, different patterns of making a type present different trade-offs and it is difficult to know the overall impact of a change if you do not have some kind of comprehensive way to quantify the impact of a change.</p>
</div>
<div data-section-id="some-general-advice" id="some-general-advice" class="base_section__z_4nJ blogPost_section__aSmVz">
<h2 id="some-general-advice" class="headerLink_header__L_1Jm">Some general advice<span class="headerLink_popupWrapper__fYhfO">​<div class="headerLink_linkPopup__K0HFc"><div class="headerLink_popupBg__g_IfY"></div><div class="headerLink_linksInner__mj5XG"><a href="https://www.edgedb.com/blog/an-approach-to-optimizing-typescript-type-checking-performance#some-general-advice"><svg width="18" height="14" viewBox="0 0 18 14" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10 2H3C2.44772 2 2 2.44772 2 3V7C2 7.55228 2.44772 8 3 8H10C10.5523 8 11 7.55228 11 7H13C13 8.65685 11.6569 10 10 10H3C1.34315 10 0 8.65685 0 7V3C0 1.34315 1.34315 0 3 0H10C11.6569 0 13 1.34315 13 3H11C11 2.44772 10.5523 2 10 2ZM15 6H8C7.44772 6 7 6.44772 7 7H5C5 5.34315 6.34315 4 8 4H15C16.6569 4 18 5.34315 18 7V11C18 12.6569 16.6569 14 15 14H8C6.34315 14 5 12.6569 5 11H7C7 11.5523 7.44772 12 8 12H15C15.5523 12 16 11.5523 16 11V7C16 6.44771 15.5523 6 15 6Z" fill="currentColor"></path></svg></a></div></div></span></h2>
<p class="">While the specific focus of this post is about <em class="">how</em> to measure changes, I’d like to also provide a few rules of thumb that might apply and can be good starting points for your own experiments. Some of this is general advice from the TypeScript wiki, and some of this I’ve discovered after doing experiments.</p>
<div data-section-id="prefer-interfaces-over-intersections" id="prefer-interfaces-over-intersections" class="base_section__z_4nJ blogPost_section__aSmVz">
<h3 id="prefer-interfaces-over-intersections" class="headerLink_header__L_1Jm">Prefer interfaces over intersections<span class="headerLink_popupWrapper__fYhfO">​<div class="headerLink_linkPopup__K0HFc"><div class="headerLink_popupBg__g_IfY"></div><div class="headerLink_linksInner__mj5XG"><a href="https://www.edgedb.com/blog/an-approach-to-optimizing-typescript-type-checking-performance#prefer-interfaces-over-intersections"><svg width="18" height="14" viewBox="0 0 18 14" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10 2H3C2.44772 2 2 2.44772 2 3V7C2 7.55228 2.44772 8 3 8H10C10.5523 8 11 7.55228 11 7H13C13 8.65685 11.6569 10 10 10H3C1.34315 10 0 8.65685 0 7V3C0 1.34315 1.34315 0 3 0H10C11.6569 0 13 1.34315 13 3H11C11 2.44772 10.5523 2 10 2ZM15 6H8C7.44772 6 7 6.44772 7 7H5C5 5.34315 6.34315 4 8 4H15C16.6569 4 18 5.34315 18 7V11C18 12.6569 16.6569 14 15 14H8C6.34315 14 5 12.6569 5 11H7C7 11.5523 7.44772 12 8 12H15C15.5523 12 16 11.5523 16 11V7C16 6.44771 15.5523 6 15 6Z" fill="currentColor"></path></svg></a></div></div></span></h3>
<p class="">As noted in the TypeScript performance wiki:</p>
<div class="blogPost_blockquote__7ONJQ"><div class="blogPost_quote__dcDj0">
<p class="">Type relationships between interfaces are also cached, as opposed to intersection types as a whole. A final noteworthy difference is that when checking against a target intersection type, every constituent is checked before checking against the “effective”/”flattened” type.</p>
</div></div>
<p class="">Example:</p>
<div class="code_code__f6VbY code-language-typescript  blogPost_codeBlock__DLXTS" style="--maxLineLength:34;--code-max-height:12"><div class="code_highlightWrapper__8YM2j code_hasCopyButton__vL2_6"><div class="code_copyCodeButtonWrapper__gi2zF"><div class="code_copyCode__EvySm"><svg width="13" height="15" viewBox="0 0 13 15" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="3.5" y="3.5" width="9" height="11" rx="1.5" stroke="currentColor"></rect><rect width="10" height="12" rx="2" fill="currentColor"></rect></svg><span class="code_copyLabel__9W53T">Copy</span></div></div><div class="code_diffLines__jSkgp"><div class="code_m__8KqxA"></div><div class="code_m__8KqxA"></div><div class="code_m__8KqxA"></div><div class="code_p__QNOEk"></div><div class="code_p__QNOEk"></div><div class="code_p__QNOEk"></div></div><div class="code_block__73rl_" translate="no"><pre><span class="tokens tokens-normal"><span class="token keyword">type</span> <span class="token class-name">Foo</span> <span class="token operator">=</span> Bar <span class="token operator">&amp;</span> Baz <span class="token operator">&amp;</span> <span class="token punctuation">{</span>
    someProp<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">interface</span> <span class="token class-name">Foo</span> <span class="token keyword">extends</span> <span class="token class-name">Bar</span><span class="token punctuation">,</span> Baz <span class="token punctuation">{</span>
    someProp<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></span></pre></div></div></div>
</div>
<div data-section-id="name-conditional-types" id="name-conditional-types" class="base_section__z_4nJ blogPost_section__aSmVz">
<h3 id="name-conditional-types" class="headerLink_header__L_1Jm">Name conditional types<span class="headerLink_popupWrapper__fYhfO">​<div class="headerLink_linkPopup__K0HFc"><div class="headerLink_popupBg__g_IfY"></div><div class="headerLink_linksInner__mj5XG"><a href="https://www.edgedb.com/blog/an-approach-to-optimizing-typescript-type-checking-performance#name-conditional-types"><svg width="18" height="14" viewBox="0 0 18 14" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10 2H3C2.44772 2 2 2.44772 2 3V7C2 7.55228 2.44772 8 3 8H10C10.5523 8 11 7.55228 11 7H13C13 8.65685 11.6569 10 10 10H3C1.34315 10 0 8.65685 0 7V3C0 1.34315 1.34315 0 3 0H10C11.6569 0 13 1.34315 13 3H11C11 2.44772 10.5523 2 10 2ZM15 6H8C7.44772 6 7 6.44772 7 7H5C5 5.34315 6.34315 4 8 4H15C16.6569 4 18 5.34315 18 7V11C18 12.6569 16.6569 14 15 14H8C6.34315 14 5 12.6569 5 11H7C7 11.5523 7.44772 12 8 12H15C15.5523 12 16 11.5523 16 11V7C16 6.44771 15.5523 6 15 6Z" fill="currentColor"></path></svg></a></div></div></span></h3>
<p class="">Another good one from the TypeScript performance wiki:</p>
<div class="blogPost_blockquote__7ONJQ"><div class="blogPost_quote__dcDj0">
<p class="">This is convenient, but today, every time <code class="">foo</code> is called, TypeScript has to re-run the conditional type. What’s more, relating any two instances of <code class="">SomeType</code> requires re-relating the structure of the return type of <code class="">foo</code>.</p>
<p class="">If the return type in this example was extracted out to a type alias, more information can be cached by the compiler:</p>
</div></div>
<p class="">Example:</p>
<div class="code_code__f6VbY code-language-typescript  blogPost_codeBlock__DLXTS" style="--maxLineLength:47;--code-max-height:12"><div class="code_highlightWrapper__8YM2j code_hasCopyButton__vL2_6"><div class="code_copyCodeButtonWrapper__gi2zF"><div class="code_copyCode__EvySm"><svg width="13" height="15" viewBox="0 0 13 15" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="3.5" y="3.5" width="9" height="11" rx="1.5" stroke="currentColor"></rect><rect width="10" height="12" rx="2" fill="currentColor"></rect></svg><span class="code_copyLabel__9W53T">Copy</span></div></div><div class="code_diffLines__jSkgp"><div class="code_m__8KqxA"></div><div class="code_m__8KqxA"></div><div class="code_m__8KqxA"></div><div class="code_m__8KqxA"></div><div class="code_m__8KqxA"></div><div class="code_m__8KqxA"></div><div class="code_m__8KqxA"></div><div class="code_p__QNOEk"></div><div class="code_p__QNOEk"></div><div class="code_p__QNOEk"></div><div class="code_p__QNOEk"></div><div class="code_p__QNOEk"></div><div class="code_p__QNOEk"></div><div class="code_p__QNOEk"></div><div class="code_p__QNOEk"></div><div class="code_p__QNOEk"></div></div><div class="code_block__73rl_" translate="no"><pre><span class="tokens tokens-normal"><span class="token keyword">interface</span> <span class="token class-name">SomeType<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span> <span class="token punctuation">{</span>
  <span class="token generic-function"><span class="token function">foo</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">U</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>x<span class="token operator">:</span> <span class="token constant">U</span><span class="token punctuation">)</span><span class="token operator">:</span>
    <span class="token constant">U</span> <span class="token keyword">extends</span> <span class="token class-name">TypeA<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span> <span class="token operator">?</span> ProcessTypeA<span class="token operator">&lt;</span><span class="token constant">U</span><span class="token punctuation">,</span> <span class="token constant">T</span><span class="token operator">&gt;</span> <span class="token operator">:</span>
    <span class="token constant">U</span> <span class="token keyword">extends</span> <span class="token class-name">TypeB<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span> <span class="token operator">?</span> ProcessTypeB<span class="token operator">&lt;</span><span class="token constant">U</span><span class="token punctuation">,</span> <span class="token constant">T</span><span class="token operator">&gt;</span> <span class="token operator">:</span>
    <span class="token constant">U</span> <span class="token keyword">extends</span> <span class="token class-name">TypeC<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span> <span class="token operator">?</span> ProcessTypeC<span class="token operator">&lt;</span><span class="token constant">U</span><span class="token punctuation">,</span> <span class="token constant">T</span><span class="token operator">&gt;</span> <span class="token operator">:</span>
    <span class="token constant">U</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">type</span> <span class="token class-name">FooResult<span class="token operator">&lt;</span><span class="token constant">U</span><span class="token punctuation">,</span> <span class="token constant">T</span><span class="token operator">&gt;</span></span> <span class="token operator">=</span>
  <span class="token constant">U</span> <span class="token keyword">extends</span> <span class="token class-name">TypeA<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span> <span class="token operator">?</span> ProcessTypeA<span class="token operator">&lt;</span><span class="token constant">U</span><span class="token punctuation">,</span> <span class="token constant">T</span><span class="token operator">&gt;</span> <span class="token operator">:</span>
  <span class="token constant">U</span> <span class="token keyword">extends</span> <span class="token class-name">TypeB<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span> <span class="token operator">?</span> ProcessTypeB<span class="token operator">&lt;</span><span class="token constant">U</span><span class="token punctuation">,</span> <span class="token constant">T</span><span class="token operator">&gt;</span> <span class="token operator">:</span>
  <span class="token constant">U</span> <span class="token keyword">extends</span> <span class="token class-name">TypeC<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span> <span class="token operator">?</span> ProcessTypeC<span class="token operator">&lt;</span><span class="token constant">U</span><span class="token punctuation">,</span> <span class="token constant">T</span><span class="token operator">&gt;</span> <span class="token operator">:</span>
  <span class="token constant">U</span><span class="token punctuation">;</span>

<span class="token keyword">interface</span> <span class="token class-name">SomeType<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span> <span class="token punctuation">{</span>
  <span class="token generic-function"><span class="token function">foo</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">U</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>x<span class="token operator">:</span> <span class="token constant">U</span><span class="token punctuation">)</span><span class="token operator">:</span> FooResult<span class="token operator">&lt;</span><span class="token constant">U</span><span class="token punctuation">,</span> <span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></span></pre></div></div></div>
</div>
<div data-section-id="move-expensive-types-into-generics" id="move-expensive-types-into-generics" class="base_section__z_4nJ blogPost_section__aSmVz">
<h3 id="move-expensive-types-into-generics" class="headerLink_header__L_1Jm">Move expensive types into generics<span class="headerLink_popupWrapper__fYhfO">​<div class="headerLink_linkPopup__K0HFc"><div class="headerLink_popupBg__g_IfY"></div><div class="headerLink_linksInner__mj5XG"><a href="https://www.edgedb.com/blog/an-approach-to-optimizing-typescript-type-checking-performance#move-expensive-types-into-generics"><svg width="18" height="14" viewBox="0 0 18 14" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10 2H3C2.44772 2 2 2.44772 2 3V7C2 7.55228 2.44772 8 3 8H10C10.5523 8 11 7.55228 11 7H13C13 8.65685 11.6569 10 10 10H3C1.34315 10 0 8.65685 0 7V3C0 1.34315 1.34315 0 3 0H10C11.6569 0 13 1.34315 13 3H11C11 2.44772 10.5523 2 10 2ZM15 6H8C7.44772 6 7 6.44772 7 7H5C5 5.34315 6.34315 4 8 4H15C16.6569 4 18 5.34315 18 7V11C18 12.6569 16.6569 14 15 14H8C6.34315 14 5 12.6569 5 11H7C7 11.5523 7.44772 12 8 12H15C15.5523 12 16 11.5523 16 11V7C16 6.44771 15.5523 6 15 6Z" fill="currentColor"></path></svg></a></div></div></span></h3>
<p class="">Type aliases have two “halves”:</p>
<ol class="">
<li class="">
<p class="">The “left” side of the alias, which is the name of the type alias and defines any generics and their constraints</p>
</li>
<li class="">
<p class="">The “right” side of the alias, which is the type that the alias refers to</p>
</li>
</ol>
<p class="">Moving expensive generic expressions from the “right” side of a type alias to a new generic parameter on the “left” can sometimes improve performance. However, this approach isn’t universally beneficial and may require providing default values or explicit generic arguments. Always measure the impact of such changes to ensure they actually improve performance in your specific case.</p>
<p class="">Example:</p>
<div class="code_code__f6VbY code-language-typescript  blogPost_codeBlock__DLXTS" style="--maxLineLength:75;--code-max-height:12"><div class="code_highlightWrapper__8YM2j code_hasCopyButton__vL2_6"><div class="code_copyCodeButtonWrapper__gi2zF"><div class="code_copyCode__EvySm"><svg width="13" height="15" viewBox="0 0 13 15" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="3.5" y="3.5" width="9" height="11" rx="1.5" stroke="currentColor"></rect><rect width="10" height="12" rx="2" fill="currentColor"></rect></svg><span class="code_copyLabel__9W53T">Copy</span></div></div><div class="code_diffLines__jSkgp"><div></div><div></div><div></div><div class="code_p__QNOEk"></div><div class="code_p__QNOEk"></div><div class="code_p__QNOEk"></div><div class="code_p__QNOEk"></div><div class="code_p__QNOEk"></div><div class="code_m__8KqxA"></div><div class="code_m__8KqxA"></div><div class="code_m__8KqxA"></div><div class="code_m__8KqxA"></div><div></div></div><div class="code_block__73rl_" translate="no"><pre><span class="tokens tokens-normal"><span class="token keyword">export</span> <span class="token keyword">function</span> op<span class="token operator">&lt;</span>
  Opr1 <span class="token keyword">extends</span> <span class="token class-name">TypeSet<span class="token operator">&lt;</span>$String<span class="token operator">&gt;</span></span><span class="token punctuation">,</span>
  Opr2 <span class="token keyword">extends</span> <span class="token class-name">TypeSet<span class="token operator">&lt;</span>$String<span class="token operator">&gt;</span></span><span class="token punctuation">,</span>
  Result <span class="token keyword">extends</span> <span class="token class-name">$expr_Operator<span class="token operator">&lt;</span>
    Opr1<span class="token punctuation">[</span><span class="token string">"__element__"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    multiplyCardinalities<span class="token operator">&lt;</span>paramCardinality<span class="token operator">&lt;</span>Opr1<span class="token operator">&gt;</span><span class="token punctuation">,</span> paramCardinality<span class="token operator">&lt;</span>Opr2<span class="token operator">&gt;&gt;</span>
  <span class="token operator">&gt;</span></span><span class="token punctuation">,</span>
<span class="token operator">&gt;</span><span class="token punctuation">(</span>op1<span class="token operator">:</span> Opr1<span class="token punctuation">,</span> op<span class="token operator">:</span> <span class="token string">"="</span><span class="token punctuation">,</span> op2<span class="token operator">:</span> Opr2<span class="token punctuation">)</span><span class="token operator">:</span> Result<span class="token punctuation">;</span>
<span class="token operator">&gt;</span><span class="token punctuation">(</span>op1<span class="token operator">:</span> Opr1<span class="token punctuation">,</span> op<span class="token operator">:</span> <span class="token string">"="</span><span class="token punctuation">,</span> op2<span class="token operator">:</span> Opr2<span class="token punctuation">)</span><span class="token operator">:</span> $expr_Operator<span class="token operator">&lt;</span>
   Opr1<span class="token punctuation">[</span><span class="token string">"__element__"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
   multiplyCardinalities<span class="token operator">&lt;</span>paramCardinality<span class="token operator">&lt;</span>Opr1<span class="token operator">&gt;</span><span class="token punctuation">,</span> paramCardinality<span class="token operator">&lt;</span>Opr2<span class="token operator">&gt;&gt;</span>
 <span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></span></pre></div></div></div>
</div>
<div data-section-id="order-of-conditionals-matters" id="order-of-conditionals-matters" class="base_section__z_4nJ blogPost_section__aSmVz">
<h3 id="order-of-conditionals-matters" class="headerLink_header__L_1Jm">Order of conditionals matters<span class="headerLink_popupWrapper__fYhfO">​<div class="headerLink_linkPopup__K0HFc"><div class="headerLink_popupBg__g_IfY"></div><div class="headerLink_linksInner__mj5XG"><a href="https://www.edgedb.com/blog/an-approach-to-optimizing-typescript-type-checking-performance#order-of-conditionals-matters"><svg width="18" height="14" viewBox="0 0 18 14" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10 2H3C2.44772 2 2 2.44772 2 3V7C2 7.55228 2.44772 8 3 8H10C10.5523 8 11 7.55228 11 7H13C13 8.65685 11.6569 10 10 10H3C1.34315 10 0 8.65685 0 7V3C0 1.34315 1.34315 0 3 0H10C11.6569 0 13 1.34315 13 3H11C11 2.44772 10.5523 2 10 2ZM15 6H8C7.44772 6 7 6.44772 7 7H5C5 5.34315 6.34315 4 8 4H15C16.6569 4 18 5.34315 18 7V11C18 12.6569 16.6569 14 15 14H8C6.34315 14 5 12.6569 5 11H7C7 11.5523 7.44772 12 8 12H15C15.5523 12 16 11.5523 16 11V7C16 6.44771 15.5523 6 15 6Z" fill="currentColor"></path></svg></a></div></div></span></h3>
<p class="">When creating a conditional type with a few conditions, the order of the conditions matters. The type checker will stop evaluating the rest of the conditions as soon as it finds a match, so you can “tune” how expensive a particular case is by moving it earlier or later in the conditional.</p>
<p class="">Here’s a very contrived example, which borrows an expensive type from <code class="">arktype</code>:</p>
<p class="">Example:</p>
<div class="code_code__f6VbY code-language-typescript  blogPost_codeBlock__DLXTS" style="--maxLineLength:55;--code-max-height:12"><div class="code_highlightWrapper__8YM2j code_hasCopyButton__vL2_6"><div class="code_copyCodeButtonWrapper__gi2zF"><div class="code_copyCode__EvySm"><svg width="13" height="15" viewBox="0 0 13 15" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="3.5" y="3.5" width="9" height="11" rx="1.5" stroke="currentColor"></rect><rect width="10" height="12" rx="2" fill="currentColor"></rect></svg><span class="code_copyLabel__9W53T">Copy</span></div></div><div class="code_block__73rl_" translate="no"><pre><span class="tokens tokens-normal"><span class="token keyword">import</span> <span class="token punctuation">{</span> bench <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@ark/attest"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> type<span class="token punctuation">,</span> <span class="token keyword">type</span> <span class="token class-name">inferAmbient</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"arktype"</span><span class="token punctuation">;</span>

bench<span class="token punctuation">.</span><span class="token function">baseline</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">type</span><span class="token punctuation">(</span><span class="token string">"never"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">type</span> <span class="token class-name">StrangeType<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token number">0</span>
  <span class="token operator">?</span> <span class="token number">0</span>
  <span class="token operator">:</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token number">1</span>
    <span class="token operator">?</span> <span class="token number">1</span>
    <span class="token operator">:</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token number">2</span>
      <span class="token operator">?</span> inferAmbient<span class="token operator">&lt;</span><span class="token string">"(0|(1|(2|(3|(4|5)[])[])[])[])[]"</span><span class="token operator">&gt;</span>
      <span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">;</span>

<span class="token function">bench</span><span class="token punctuation">(</span><span class="token string">"StrangeType: 0"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">type</span> <span class="token class-name"><span class="token constant">T</span></span> <span class="token operator">=</span> StrangeType<span class="token operator">&lt;</span><span class="token number">0</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">types</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">"instantiations"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">bench</span><span class="token punctuation">(</span><span class="token string">"StrangeType: 1"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">type</span> <span class="token class-name"><span class="token constant">T</span></span> <span class="token operator">=</span> StrangeType<span class="token operator">&lt;</span><span class="token number">1</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">types</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">"instantiations"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">bench</span><span class="token punctuation">(</span><span class="token string">"StrangeType: 2"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">type</span> <span class="token class-name"><span class="token constant">T</span></span> <span class="token operator">=</span> StrangeType<span class="token operator">&lt;</span><span class="token number">2</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">types</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">81</span><span class="token punctuation">,</span> <span class="token string">"instantiations"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">bench</span><span class="token punctuation">(</span><span class="token string">"StrangeType: 3"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">type</span> <span class="token class-name"><span class="token constant">T</span></span> <span class="token operator">=</span> StrangeType<span class="token operator">&lt;</span><span class="token number">3</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">types</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token string">"instantiations"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></pre></div></div></div>
<p class="">Our expensive conditional branch <code class="">2</code> takes 81 instantiations. Let’s move it first and see what happens:</p>
<div class="code_code__f6VbY code-language-typescript  blogPost_codeBlock__DLXTS" style="--maxLineLength:51;--code-max-height:12"><div class="code_highlightWrapper__8YM2j code_hasCopyButton__vL2_6"><div class="code_copyCodeButtonWrapper__gi2zF"><div class="code_copyCode__EvySm"><svg width="13" height="15" viewBox="0 0 13 15" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="3.5" y="3.5" width="9" height="11" rx="1.5" stroke="currentColor"></rect><rect width="10" height="12" rx="2" fill="currentColor"></rect></svg><span class="code_copyLabel__9W53T">Copy</span></div></div><div class="code_block__73rl_" translate="no"><pre><span class="tokens tokens-normal"><span class="token keyword">type</span> <span class="token class-name">StrangeType<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token number">2</span>
  <span class="token operator">?</span> inferAmbient<span class="token operator">&lt;</span><span class="token string">"(0|(1|(2|(3|(4|5)[])[])[])[])[]"</span><span class="token operator">&gt;</span>
  <span class="token operator">:</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token number">0</span>
    <span class="token operator">?</span> <span class="token number">0</span>
    <span class="token operator">:</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token number">1</span>
      <span class="token operator">?</span> <span class="token number">1</span>
      <span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">;</span></span></pre></div></div></div>
<p class="">In this version, the expensive case only costs 79 instantiations, but each of the earlier cases cost an additional instantiation due to the <code class="">T extends 2</code> check now coming before them.</p>
<p class="">Sometimes, it can be useful to rearrange your conditionals to either make the most expensive or the most common cases cheaper. Sometimes you have a clear win if the most expensive cases are also very common cases, but you’ll need to know a bit about the specifics of your use case to make that decision.</p>
</div>
</div>
<div data-section-id="the-next-generation-of-performance-tools" id="the-next-generation-of-performance-tools" class="base_section__z_4nJ blogPost_section__aSmVz">
<h2 id="the-next-generation-of-performance-tools" class="headerLink_header__L_1Jm">The next generation of performance tools<span class="headerLink_popupWrapper__fYhfO">​<div class="headerLink_linkPopup__K0HFc"><div class="headerLink_popupBg__g_IfY"></div><div class="headerLink_linksInner__mj5XG"><a href="https://www.edgedb.com/blog/an-approach-to-optimizing-typescript-type-checking-performance#the-next-generation-of-performance-tools"><svg width="18" height="14" viewBox="0 0 18 14" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10 2H3C2.44772 2 2 2.44772 2 3V7C2 7.55228 2.44772 8 3 8H10C10.5523 8 11 7.55228 11 7H13C13 8.65685 11.6569 10 10 10H3C1.34315 10 0 8.65685 0 7V3C0 1.34315 1.34315 0 3 0H10C11.6569 0 13 1.34315 13 3H11C11 2.44772 10.5523 2 10 2ZM15 6H8C7.44772 6 7 6.44772 7 7H5C5 5.34315 6.34315 4 8 4H15C16.6569 4 18 5.34315 18 7V11C18 12.6569 16.6569 14 15 14H8C6.34315 14 5 12.6569 5 11H7C7 11.5523 7.44772 12 8 12H15C15.5523 12 16 11.5523 16 11V7C16 6.44771 15.5523 6 15 6Z" fill="currentColor"></path></svg></a></div></div></span></h2>
<p class="">Like many performance related issues, learning the tips and tricks of improving type inference performance is a temporary skill, but learning how to measure and quantify the impact of a change is a perennial skill that will continue to be useful no matter how TypeScript evolves.</p>
<p class="">To that end, I’d love to see more tooling around type performance in the future. I’m aware of some projects that are in the early stage of development for this purpose. Here are some concrete things that are currently difficult that would improve this method of performance improvement iteration:</p>
<ol class="">
<li class="">
<p class="">Measure the impact of a change on the language server wall time</p>
</li>
<li class="">
<p class="">Trace the language server performance of a given expression and see what exactly the inference engine is doing (what types are being instantiated, what the call stack looks like, etc)</p>
</li>
<li class="">
<p class="">Linting tools that provide performance-specific guidance</p>
</li>
<li class="">
<p class="">Refactoring tool at the type level that help large refactors of types similar to runtime refactoring</p>
</li>
</ol>
</div>
</section>
</div></div></div><div class="shareAndSubscribe_container__bxp2G"><a class="shareAndSubscribe_iconLink__i3I1L" href="https://www.edgedb.com/blog"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="24" viewBox="0 0 16 24" fill="none"><path fill-rule="evenodd" clip-rule="evenodd" d="M6.61722 6.07588C6.49927 6.12468 6.38877 6.19702 6.29289 6.29289L3.29289 9.29289C2.90237 9.68342 2.90237 10.3166 3.29289 10.7071C3.68342 11.0976 4.31658 11.0976 4.70711 10.7071L6 9.41421V17C6 17.5523 6.44772 18 7 18H12C12.5523 18 13 17.5523 13 17C13 16.4477 12.5523 16 12 16H8V9.41421L9.29289 10.7071C9.68342 11.0976 10.3166 11.0976 10.7071 10.7071C11.0976 10.3166 11.0976 9.68342 10.7071 9.29289L7.70711 6.29289C7.41246 5.99825 6.97969 5.92591 6.61722 6.07588Z" fill="currentColor"></path></svg><span>All posts</span></a><a href="https://twitter.com/intent/tweet?text=An%20approach%20to%20optimizing%20TypeScript%20type%20checking%20performance%20edgedb.com%2Fblog%2Fan-approach-to-optimizing-typescript-type-checking-performance%20%40edgedatabase" class="shareAndSubscribe_iconLink__i3I1L" target="_blank"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M13.7142 10.6226L20.4162 3H18.8286L13.0068 9.61726L8.3604 3H3L10.0278 13.0074L3 20.9999H4.5876L10.7316 14.0104L15.6396 20.9999H21M5.1606 4.17142H7.5996L18.8274 19.8861H16.3878" fill="currentColor"></path></svg><span>Tweet</span></a><a href="https://news.ycombinator.com/submitlink?u=https%3A%2F%2Fedgedb.com%2Fblog%2Fan-approach-to-optimizing-typescript-type-checking-performance&amp;t=An%20approach%20to%20optimizing%20TypeScript%20type%20checking%20performance" class="shareAndSubscribe_iconLink__i3I1L" target="_blank"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M2 2V22H22V2H2ZM3.81818 3.81818H20.1818V20.1818H3.81818V3.81818ZM7.90909 7.45455L11.0909 12.9091V17.4545H12.9091V12.9091L16.0909 7.45455H14.2727L12 11.3466L9.72727 7.45455H7.90909Z" fill="currentColor"></path></svg><span>Share</span></a><div class="shareAndSubscribe_iconLink__i3I1L"><svg width="21" height="14" viewBox="0 0 21 14" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M0.441406 2.9233V0.478638H20.4414V2.96597L10.4747 9.4873L0.441406 2.9233ZM20.4414 13.8118H0.441406V5.3125L10.4747 11.8772L20.4414 5.35584V13.8118Z"></path></svg><span>Subscribe</span></div></div></div><div class="thumbnailsFooter_container__4eQ0Z"><h3 class="thumbnailsFooter_title__lmgf0">CHECK THE OTHER POSTS</h3><div class="thumbnailsFooter_posts__O_8wq"><a href="https://www.edgedb.com/blog/seamless-dx-with-vercel"><div><div class="lazyImage_wrapper__f6_0z thumbnailsFooter_postImage__AJhU4"><img src="./s_files/53aa9d7cb5c89672165220c8320ed5f2f4384256.webp" width="1920" height="800" loading="lazy"><div class="lazyImage_placeholder__z1C_i lazyImage_transition__gEVMC" style="background-image:url(data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wAARCAAhAFADASIAAhEBAxEB/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/8QAHwEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoL/8QAtREAAgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHBCSMzUvAVYnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6goOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4uPk5ebn6Onq8vP09fb3+Pn6/9oADAMBAAIRAxEAPwDhBThTRTxTJHrUyDNQrVu2j3sPSmhMvabYSXcyxxqWJ9K24IvJ+QjaF7Vs+FrBbW1+1yLgtxGPbuaTxFabCLqIfI/3sdjTv0M2tLlNJ+wq5BNjvWEkuDVlLjA61RJvrdcYzxVS4udxPNZ7XW1cZqBrnPelYLnCCnimCnKMmoNyaMZPtXQ+G9NOo3yRgHy1+Zz6CueU9h0rRstQns8+RK8ZPXa2M1SJZ6lLC+1UjTaijCgdhR9nM1u8Eyko4x9K84/t6/8A+fub/vs04a9fAf8AH3N/32aLCLmowPY3bwycFT+dQJPjkmqM9/NdSbppGdumWOTTDNgYzTJsXXuST1pouPes8y0nm+9FwsZVSL92iioRqSR1IKKKoliinnpRRQAJ1pzUUUCGGkNFFAz/2Q==)"></div></div><p class="thumbnailsFooter_postTitle__3eslK">Seamless DX with Vercel</p></div></a><a href="https://www.edgedb.com/blog/powering-webble-s-growth-how-edgedb-became-the-cornerstone-of-their-tech-stack"><div><div class="lazyImage_wrapper__f6_0z thumbnailsFooter_postImage__AJhU4"><img src="./s_files/c7bad5a9b005f83c11533e410c6cd6e461e9005c.webp" width="1920" height="800" loading="lazy"><div class="lazyImage_placeholder__z1C_i lazyImage_transition__gEVMC" style="background-image:url(data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wAARCAAhAFADASIAAhEBAxEB/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/8QAHwEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoL/8QAtREAAgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHBCSMzUvAVYnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6goOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4uPk5ebn6Onq8vP09fb3+Pn6/9oADAMBAAIRAxEAPwDjKei72CjqTgU2pIBi4j/3h/OqitQZN/Z1x/dX/vqj+zrj+6v/AH1Wq6ylspIFHpim7J8/60flXofVYeZjzsx5rd4WCyYBIzwaixWhqW03KK2eVxkHpzWeQQSO4riqwUJNI0i7oMGgfSjmjB9KzKDpRS5GPekzQAUZ5BHBFJSjGeaQEouJh1lc/wDAjQbiYniR/wDvo1EcdqKrnl3FZEhlYkF8sR3Jq5poU3TkEEFSfpzVDk1LbztbOXVQcjHNaU52mnLYUlpoayzMRkwSDkjGBT0k3NgxsvuRWd/akn/PNPzNH9qSf880/M13LE0+/wCBlyMqTj/SJMf3j/OmU5pCzs/Qsc00nJya82Vm7myEoooqRhRRRQA9elDdKKKroIZRRRUjCiiigD//2Q==)"></div></div><p class="thumbnailsFooter_postTitle__3eslK">Powering Webble’s Growth: How EdgeDB Became the Cornerstone of Their Tech Stack</p></div></a></div><a class="thumbnailsFooter_button__OIQoj" href="https://www.edgedb.com/blog"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="24" viewBox="0 0 16 24" fill="none"><path fill-rule="evenodd" clip-rule="evenodd" d="M6.61722 6.07588C6.49927 6.12468 6.38877 6.19702 6.29289 6.29289L3.29289 9.29289C2.90237 9.68342 2.90237 10.3166 3.29289 10.7071C3.68342 11.0976 4.31658 11.0976 4.70711 10.7071L6 9.41421V17C6 17.5523 6.44772 18 7 18H12C12.5523 18 13 17.5523 13 17C13 16.4477 12.5523 16 12 16H8V9.41421L9.29289 10.7071C9.68342 11.0976 10.3166 11.0976 10.7071 10.7071C11.0976 10.3166 11.0976 9.68342 10.7071 9.29289L7.70711 6.29289C7.41246 5.99825 6.97969 5.92591 6.61722 6.07588Z" fill="currentColor"></path></svg>ALL BLOG POSTS</a></div><div id="__blog_overlay_portal"></div><footer class="pageFooter_pageFooter__W51QO blogPost_pageFooter__f3_ol"><div data-theme="dark"><div class="pageFooter_footerContent__sXQCm"><div class="pageFooter_footerContent__tzWqG"><div class="pageFooter_linksGrid__4YMSV pageFooter_footerLinks__Lzh46"><div class="pageFooter_linksGroup__4T9R4"><div class="pageFooter_heading__Su_Zl">Product</div><a href="https://www.edgedb.com/">Home</a><a href="https://www.edgedb.com/cloud">Cloud</a><a href="https://www.edgedb.com/pricing">Pricing</a><a href="https://www.edgedbstatus.com/">Cloud Status</a></div><div class="pageFooter_linksGroup__4T9R4"><div class="pageFooter_heading__Su_Zl">Resources</div><a href="https://docs.edgedb.com/get-started/quickstart">Quickstart</a><a href="https://docs.edgedb.com/">Documentation</a><a href="https://docs.edgedb.com/tutorial">Tutorial</a><a href="https://docs.edgedb.com/easy-edgedb">Easy EdgeDB</a><a href="https://discord.gg/edgedb">Community Discord</a></div><div class="pageFooter_linksGroup__4T9R4"><div class="pageFooter_heading__Su_Zl">Company</div><a href="https://www.edgedb.com/about">About</a><a href="https://www.edgedb.com/presskit">Press Kit</a><a href="https://www.edgedb.com/terms-of-use">Terms of Use</a><a href="https://www.edgedb.com/privacy-policy">Privacy Policy</a><a href="https://www.edgedb.com/cloud-terms-and-conditions">Cloud Terms and Conditions</a></div></div><div class="pageFooter_subscribe__Q1zVi"><div class="pageFooter_heading__Su_Zl">Newsletter</div><div class="pageFooter_subscribeInput__T96Oc"><form novalidate=""><input type="email" required="" placeholder="Enter your email"><button type="submit">Subscribe</button></form></div><div class="pageFooter_message__JYO9h">Subscribe to our mailing list to be the first to know about new blog posts and announcements.</div><div class="pageFooter_rssLink__j6XNX"><a href="https://www.edgedb.com/rss.xml">RSS</a></div></div></div><div class="pageFooter_copyright__PhYtL"><a href="https://twitter.com/edgedatabase"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M13.7142 10.6226L20.4162 3H18.8286L13.0068 9.61726L8.3604 3H3L10.0278 13.0074L3 20.9999H4.5876L10.7316 14.0104L15.6396 20.9999H21M5.1606 4.17142H7.5996L18.8274 19.8861H16.3878" fill="currentColor"></path></svg></a><a href="https://github.com/edgedb"><svg width="35" height="35" viewBox="0 0 35 35"><path d="M17.499 4.284c-7.483 0-13.55 6.067-13.55 13.55 0 5.988 3.883 11.066 9.267 12.86.678.123.925-.295.925-.655 0-.32-.011-1.173-.018-2.304-3.77.819-4.564-1.817-4.564-1.817-.617-1.565-1.505-1.982-1.505-1.982-1.23-.84.093-.824.093-.824 1.36.096 2.075 1.397 2.075 1.397 1.21 2.07 3.172 1.472 3.944 1.126.123-.876.473-1.473.86-1.811-3.008-.342-6.172-1.505-6.172-6.698 0-1.479.528-2.688 1.395-3.636-.14-.343-.605-1.72.132-3.586 0 0 1.138-.365 3.727 1.389 1.08-.301 2.24-.45 3.392-.456 1.15.005 2.31.155 3.393.456 2.587-1.754 3.722-1.39 3.722-1.39.74 1.867.275 3.244.135 3.587.869.948 1.394 2.157 1.394 3.636 0 5.206-3.169 6.351-6.188 6.687.487.418.92 1.245.92 2.51 0 1.81-.016 3.272-.016 3.716 0 .363.243.785.931.652 5.38-1.796 9.26-6.87 9.26-12.856 0-7.484-6.068-13.551-13.552-13.551" fill-rule="evenodd"></path></svg></a><a href="https://discord.gg/edgedb"><svg width="35" height="35" viewBox="0 0 35 35" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M28.7657 7.07236C26.6752 6.11316 24.4334 5.40646 22.0896 5.0017C22.0469 4.99389 22.0042 5.01341 21.9823 5.05245C21.694 5.56523 21.3746 6.23419 21.151 6.75999C18.63 6.38257 16.1219 6.38257 13.6526 6.75999C13.4289 6.2225 13.098 5.56523 12.8084 5.05245C12.7864 5.01471 12.7438 4.99519 12.7011 5.0017C10.3585 5.40516 8.11677 6.11186 6.02498 7.07236C6.00687 7.08017 5.99135 7.0932 5.98105 7.11011C1.72894 13.4627 0.564116 19.6591 1.13554 25.7787C1.13813 25.8086 1.15493 25.8372 1.1782 25.8554C3.98362 27.9157 6.70115 29.1664 9.36821 29.9954C9.41089 30.0085 9.45612 29.9929 9.48328 29.9577C10.1142 29.0962 10.6766 28.1877 11.1588 27.2324C11.1872 27.1764 11.16 27.1101 11.1019 27.0879C10.2098 26.7496 9.36045 26.337 8.54338 25.8685C8.47876 25.8307 8.47358 25.7383 8.53304 25.694C8.70498 25.5652 8.87696 25.4311 9.04114 25.2958C9.07085 25.2711 9.11224 25.2658 9.14716 25.2815C14.5149 27.7322 20.3261 27.7322 25.6306 25.2815C25.6655 25.2645 25.7069 25.2698 25.7379 25.2945C25.9021 25.4298 26.074 25.5652 26.2473 25.694C26.3067 25.7383 26.3029 25.8307 26.2382 25.8685C25.4212 26.3461 24.5718 26.7496 23.6784 27.0866C23.6203 27.1088 23.5944 27.1764 23.6229 27.2324C24.1154 28.1864 24.6778 29.0948 25.297 29.9564C25.3229 29.9929 25.3694 30.0085 25.4121 29.9954C28.0921 29.1664 30.8096 27.9157 33.615 25.8554C33.6396 25.8372 33.6551 25.8099 33.6577 25.7799C34.3416 18.705 32.5122 12.5594 28.8083 7.1114C28.7993 7.0932 28.7838 7.08017 28.7657 7.07236ZM11.9603 22.0525C10.3443 22.0525 9.01269 20.5688 9.01269 18.7467C9.01269 16.9246 10.3185 15.4409 11.9603 15.4409C13.6151 15.4409 14.9338 16.9376 14.9079 18.7467C14.9079 20.5688 13.6022 22.0525 11.9603 22.0525ZM22.8588 22.0525C21.2428 22.0525 19.9112 20.5688 19.9112 18.7467C19.9112 16.9246 21.2169 15.4409 22.8588 15.4409C24.5136 15.4409 25.8323 16.9376 25.8064 18.7467C25.8064 20.5688 24.5136 22.0525 22.8588 22.0525Z"></path></svg></a><a href="https://youtube.com/@EdgeDB"><svg xmlns="http://www.w3.org/2000/svg" width="35" height="35" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M15.32 4.06c-.434-.772-.905-.914-1.864-.968C12.498 3.027 10.089 3 8.002 3c-2.091 0-4.501.027-5.458.091-.957.055-1.429.196-1.867.969C.23 4.831 0 6.159 0 8.497v.008c0 2.328.23 3.666.677 4.429.438.772.909.912 1.866.977.958.056 3.368.089 5.459.089 2.087 0 4.496-.033 5.455-.088.959-.065 1.43-.205 1.864-.977.451-.763.679-2.101.679-4.429v-.008c0-2.339-.228-3.667-.68-4.438zM6 11.5v-6l5 3-5 3z" clip-rule="evenodd"></path></svg></a><p class="pageFooter_label__3dLTH">©&nbsp;2024, EdgeDB Inc.</p></div></div></div></footer></div><div id="themeSwitcherPortalTarget"></div><div id="overlayPortalTarget"></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"slug":"an-approach-to-optimizing-typescript-type-checking-performance","post":{"id":"2024-07-11-ts-overload-perf/post","title":"An approach to optimizing TypeScript type checking performance","leadImage":{"filename":"2024-07-11-ts-overload-perf/images/tsperf.jpg","path":"/_images/_blog/4196cf87ed3e24e8d86af535487dd9b0db7e21ee","pathIncludesExt":false,"width":1920,"height":800,"brightness":39.70719696969697,"thumbnail":"data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wAARCAAhAFADASIAAhEBAxEB/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/8QAHwEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoL/8QAtREAAgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHBCSMzUvAVYnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6goOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4uPk5ebn6Onq8vP09fb3+Pn6/9oADAMBAAIRAxEAPwDjgM0Yp44oA5q7E3GkYFJWnbaek1ukjOwLDoKhvbRLbYFYsGz1rR0pJcxCqRbsUqAMnFXprSFfNVHcvEASCBg0TWsMcmwGXcWAyV4pezaD2iKIHI9KMc4q+1rD8wjd8o4Vsgdzio7iGGIkIZC6tj5hxQ6bSBTTKlGOKcBx9aXFRYu4UZ6UzPGKM80XCxpw3UAt4UfO5Dk/Lmq9zKjqgQ52knp/nNVM0A4q3UbViFTSdy9c3m9pBGqhGwC23k06eeKSUSCaQgMCEK8CqBOc+lGflp+0b3D2aNCS9WQYLEYl3DA6rUFxcvNI43sYy2QDVUHFLu60nUb3BQS2HCimZ5zSk5qLl2G0UUUhhRRRQAUUUUAFFFFABRRRQB//2Q=="},"leadImageAlt":null,"leadYT":null,"description":"A process for measuring and optimizing TypeScript type checking performance","headers":[{"id":"setting-the-stage","title":"Setting the stage","level":2},{"id":"how-do-we-quantify-the-type-checker-s-workload","title":"How do we quantify the type checker’s workload?","level":2},{"id":"marking-the-workbench","title":"Marking the workbench","level":2},{"id":"the-bam-method","title":"The BAM Method","level":2},{"id":"some-general-advice","title":"Some general advice","level":2},{"id":"prefer-interfaces-over-intersections","title":"Prefer interfaces over intersections","level":3},{"id":"name-conditional-types","title":"Name conditional types","level":3},{"id":"move-expensive-types-into-generics","title":"Move expensive types into generics","level":3},{"id":"order-of-conditionals-matters","title":"Order of conditionals matters","level":3},{"id":"the-next-generation-of-performance-tools","title":"The next generation of performance tools","level":2}],"document":["div",{"styles":["rstWrapper"]},["\n","\n","\n","\n","\n","\n",["section",{"styles":["section"],"data-section-id":"an-approach-to-optimizing-typescript-type-checking-performance","id":"an-approach-to-optimizing-typescript-type-checking-performance"},["\n","\n",["div",{"styles":["border_box","note"]},["\n",["p",{},["Check out the discussion of this post on\n                ",["a",{"href":"https://news.ycombinator.com/item?id=41226548"},["Hacker News"]],"."]],"\n"]],"\n",["p",{},["As developers, we spend much of our time thinking about the runtime performance of our code. Things like asymptotic runtime complexity, cache misses, and memory usage are all important factors to consider. However, one area of performance that can be difficult to optimize is TypeScript’s type checking performance. This manifests as sluggish IDE responsiveness, extended compile times, or in extreme cases, TypeScript compiler crashes due to memory exhaustion."]],"\n",["p",{},["When you run into one of these types of performance issues related to type-checking, it can be hard to how to start troubleshooting. Unlike runtime performance problems, we can’t rely on our usual debugging approaches. The type checker operates within the TypeScript compiler during build time and the language server in your editor while editing, making it challenging to apply conventional debugging approaches."]],"\n",["p",{},["While the ",["a",{"href":"https://github.com/microsoft/TypeScript/wiki/Performance"},["TypeScript team provides general guidance about type performance in their wiki"]],", it can be daunting to determine how to effectively measure type checker performance and identify appropriate strategies to address any discovered issues."]],"\n",["p",{},["We recently faced a similar challenge when TypeScript 5.3 introduced changes to the type inference algorithm, resulting in a significant performance regression. So much so, that certain parts of our test suite would cause the TypeScript compiler to run out of memory, and froze any attempt to use the language server. It was time to roll up our sleeves and come up with a plan for measuring and improving the type inference performance of this specific construct."]],"\n",["p",{},["As we worked through this problem, we were struck by the scarcity of detailed information on effective workflows beyond the basic advice to use ",["code",{},["--extendedDiagnostics"]]," and ",["code",{},["--generateTrace"]],". This led us to explore the landscape of available tools and devise a strategy to leverage them effectively."]],"\n",["p",{},["In this article, we’ll walk you through the approach we used and share some workflow tips along the way. We’ll use a simplified example, but keep in mind that our actual issue involved a more complex variation of the problem we’ll discuss."]],"\n",["p",{},["Before we dive in, I’d like to extend special thanks to:"]],"\n",["ul",{"styles":[]},["\n",["li",{},["\n",["p",{},["My colleague at EdgeDB, Aleksandra Sikora, for her extensive work on TypeScript performance measurement and analysis."]],"\n"]],"\n",["li",{},["\n",["p",{},["David Blass for the excellent ",["a",{"href":"https://arktype.io/"},["arktype"]]," library and ",["code",{},["attest"]]," testing framework, and for his invaluable feedback on this article."]],"\n"]],"\n",["li",{},["\n",["p",{},["Larry Layland for his helpful suggestions during the review of this article."]],"\n"]],"\n",["li",{},["\n",["p",{},["The TypeScript team, especially those involved in documentation, for their guidance."]],"\n"]],"\n"]],"\n",["div",{"styles":["section"],"data-section-id":"setting-the-stage","id":"setting-the-stage"},["\n",[4,{"id":"setting-the-stage","level":2},["Setting the stage"]],"\n",["p",{},["The EdgeDB query builder introspects the database to determine the valid operators as defined by the database itself, which includes the valid operands for a given operator, and it’s return type and cardinality. This information is used to create a set of overloads, 376 overloads in our initial implementation, for the ",["code",{},["e.op"]]," function, which is used to create expressions in the query builder."]],"\n",["p",{},["For example:"]],"\n",[2,{"language":"typescript","code":"e.select(e.User, (u) =\u003e ({\n  accountAge: e.op(u.createdAt, \"-\", e.datetime_of_statement()),\n}));","styles":["rest_border_box","codeBlock"],"collapsible":false},[]],"\n",["p",{},["In this example, the ",["code",{},["e.op"]]," function will find the overload that takes a ",["code",{},["datetime"]]," value as the first operand, the string ",["code",{},["\"-\""]]," as the operator, and another ",["code",{},["datetime"]]," as the second operand. It will find such an overload, and the return type of the expression will have an element type of ",["code",{},["duration"]]," with a cardinality of ",["code",{},["One"]]," (assuming ",["code",{},["createdAt"]]," is a required property)."]],"\n",["p",{},["However, it should give us a type error if, for instance, you tried to have a ",["code",{},["str"]]," type as the second operand, or tried to provide an operator like ",["code",{},["ilike"]]," (which is only defined for ",["code",{},["str"]]," operands)."]],"\n",["p",{},["Our query builder works with expression-based data, similar to an abstract syntax tree (AST) - a tree representation of the structure of code. Instead of TypeScript primitives, we use objects representing expressions of those types. These expressions can be combined and nested, much like how elements in an AST relate to each other. For this example, we’ll define ",["code",{},["$Number"]],", ",["code",{},["$String"]],", and ",["code",{},["$Boolean"]]," data types, along with operators that work with various combinations of these types. This approach allows us to model complex queries as composable expressions."]],"\n",["div",{"styles":["border_box","note"]},["\n",["p",{},["In the actual query builder’s generated code, operands for scalar types are more complex. They can accept either literal scalars (such as ",["code",{},["\"a\""]]," or ",["code",{},["true"]],") or expressions of that type (like ",["code",{},["e.select(someUser).name"]],"). Due to this complexity, the approach we ultimately adopted is more sophisticated than the ones we’ll explore in this post."]],"\n"]],"\n",["p",{},["Let’s take a look at one such operator, the ",["code",{},["="]]," operator which should take operands of the same type, and return a ",["code",{},["$Boolean"]]," with a cardinality of ",["code",{},["One"]],"."]],"\n",["p",{},["Our initial approach was to define operators like this:"]],"\n",[2,{"language":"typescript","code":"function op\u003cOpr1 extends TypeSet\u003c$String\u003e, Opr2 extends TypeSet\u003c$String\u003e\u003e(\n  opr1: Opr1,\n  op: \"=\",\n  opr2: Opr2\n): TypeSet\u003c$Boolean, Cardinality.One\u003e;\nfunction op\u003cOpr1 extends TypeSet\u003c$Number\u003e, Opr2 extends TypeSet\u003c$Number\u003e\u003e(\n  opr1: Opr1,\n  op: \"=\",\n  opr2: Opr2\n): TypeSet\u003c$Boolean, Cardinality.One\u003e;\nfunction op\u003cOpr1 extends TypeSet\u003c$Boolean\u003e, Opr2 extends TypeSet\u003c$Boolean\u003e\u003e(\n  opr1: Opr1,\n  op: \"=\",\n  opr2: Opr2\n): TypeSet\u003c$Boolean, Cardinality.One\u003e;","styles":["rest_border_box","codeBlock"],"collapsible":false},[]],"\n",["p",{},["This naive approach works! It only defines overloads for valid operands and returns the correct expression type. It can even be nested since we have an overload defined for booleans:"]],"\n",[2,{"language":"typescript","code":"import { $string, $number, $boolean } from \"./typesystem.js\";\nimport { op } from \"./operators.js\";\n\nop($string(\"a\"), \"=\", $string(\"b\"));\nop($number(1), \"=\", $number(1));\nop(op($string(\"a\"), \"=\", $string(\"a\")), \"=\", $boolean(false));\nop($string(\"a\"), \"ilike\", $string(\"Apex\"));","styles":["rest_border_box","codeBlock"],"collapsible":false},[]],"\n",["p",{},["The issue with this approach is that the type checker has to go through all of the overloads to find the right match, and as the number of overloads increases, the amount of work the type checker has to do starts to be impacted by how far down the list it has to go to find a matching overload."]],"\n",["p",{},["Let’s create a minimal TypeScript project to explore these concepts more directly. This project will include TypeScript configuration, several TypeScript modules, and a basic package.json file. We’ll use this setup to define a bunch more operators and various combinations, giving us a better sense of the type checking performance in an almost-real-world scenario."]],"\n",[3,{"styles":["raisedCodeBlock"],"tabs":[{"name":"index.ts","lang":"typescript","kind":"code","codeBlock":[[2,{"language":"typescript","code":"import { $string, $number, $boolean } from \"./typesystem.js\";\nimport { op } from \"./operators.js\";\n\nop($string(\"a\"), \"=\", $string(\"b\"));\nop($number(1), \"=\", $number(1));\nop(op($string(\"a\"), \"=\", $string(\"a\")), \"=\", $boolean(false));\nop($string(\"a\"), \"ilike\", $string(\"Apex\"));","styles":["rest_border_box","codeBlock"],"collapsible":false},[]]]},{"name":"operators.ts","lang":"typescript","kind":"code","codeBlock":[[2,{"language":"typescript","code":"import type { $String, $Number, $Boolean, TypeSet } from \"./typesystem.js\";\nimport { Cardinality } from \"./typesystem.js\";\n\n// String comparisons\nfunction op\u003c\n  Opr1 extends TypeSet\u003c$String\u003e,\n  Opr2 extends TypeSet\u003c$String\u003e\n\u003e(\n  opr1: Opr1,\n  op: \"=\",\n  opr2: Opr2\n): TypeSet\u003c$Boolean, Cardinality.One\u003e;\n\nfunction op\u003c\n  Opr1 extends TypeSet\u003c$String\u003e,\n  Opr2 extends TypeSet\u003c$String\u003e\n\u003e(\n  opr1: Opr1,\n  op: \"!=\",\n  opr2: Opr2\n): TypeSet\u003c$Boolean, Cardinality.One\u003e;\n\nfunction op\u003c\n  Opr1 extends TypeSet\u003c$String\u003e,\n  Opr2 extends TypeSet\u003c$String\u003e\n\u003e(\n  opr1: Opr1,\n  op: \"\u003e\",\n  opr2: Opr2\n): TypeSet\u003c$Boolean, Cardinality.One\u003e;\n\nfunction op\u003c\n  Opr1 extends TypeSet\u003c$String\u003e,\n  Opr2 extends TypeSet\u003c$String\u003e\n\u003e(\n  opr1: Opr1,\n  op: \"\u003c\",\n  opr2: Opr2\n): TypeSet\u003c$Boolean, Cardinality.One\u003e;\n\nfunction op\u003c\n  Opr1 extends TypeSet\u003c$String\u003e,\n  Opr2 extends TypeSet\u003c$String\u003e\n\u003e(\n  opr1: Opr1,\n  op: \"\u003e=\",\n  opr2: Opr2\n): TypeSet\u003c$Boolean, Cardinality.One\u003e;\n\nfunction op\u003c\n  Opr1 extends TypeSet\u003c$String\u003e,\n  Opr2 extends TypeSet\u003c$String\u003e\n\u003e(\n  opr1: Opr1,\n  op: \"\u003c=\",\n  opr2: Opr2\n): TypeSet\u003c$Boolean, Cardinality.One\u003e;\n\nfunction op\u003c\n  Opr1 extends TypeSet\u003c$String\u003e,\n  Opr2 extends TypeSet\u003c$String\u003e\n\u003e(\n  opr1: Opr1,\n  op: \"?=\",\n  opr2: Opr2\n): TypeSet\u003c$Boolean, Cardinality.AtMostOne\u003e;\n\nfunction op\u003c\n  Opr1 extends TypeSet\u003c$String\u003e,\n  Opr2 extends TypeSet\u003c$String\u003e\n\u003e(\n  opr1: Opr1,\n  op: \"?!=\",\n  opr2: Opr2\n): TypeSet\u003c$Boolean, Cardinality.AtMostOne\u003e;\n\n// Number comparisons\nfunction op\u003c\n  Opr1 extends TypeSet\u003c$Number\u003e,\n  Opr2 extends TypeSet\u003c$Number\u003e\n\u003e(\n  opr1: Opr1,\n  op: \"=\",\n  opr2: Opr2\n): TypeSet\u003c$Boolean, Cardinality.One\u003e;\n\nfunction op\u003c\n  Opr1 extends TypeSet\u003c$Number\u003e,\n  Opr2 extends TypeSet\u003c$Number\u003e\n\u003e(\n  opr1: Opr1,\n  op: \"!=\",\n  opr2: Opr2\n): TypeSet\u003c$Boolean, Cardinality.One\u003e;\n\nfunction op\u003c\n  Opr1 extends TypeSet\u003c$Number\u003e,\n  Opr2 extends TypeSet\u003c$Number\u003e\n\u003e(\n  opr1: Opr1,\n  op: \"\u003e\",\n  opr2: Opr2\n): TypeSet\u003c$Boolean, Cardinality.One\u003e;\n\nfunction op\u003c\n  Opr1 extends TypeSet\u003c$Number\u003e,\n  Opr2 extends TypeSet\u003c$Number\u003e\n\u003e(\n  opr1: Opr1,\n  op: \"\u003c\",\n  opr2: Opr2\n): TypeSet\u003c$Boolean, Cardinality.One\u003e;\n\nfunction op\u003c\n  Opr1 extends TypeSet\u003c$Number\u003e,\n  Opr2 extends TypeSet\u003c$Number\u003e\n\u003e(\n  opr1: Opr1,\n  op: \"\u003e=\",\n  opr2: Opr2\n): TypeSet\u003c$Boolean, Cardinality.One\u003e;\n\nfunction op\u003c\n  Opr1 extends TypeSet\u003c$Number\u003e,\n  Opr2 extends TypeSet\u003c$Number\u003e\n\u003e(\n  opr1: Opr1,\n  op: \"\u003c=\",\n  opr2: Opr2\n): TypeSet\u003c$Boolean, Cardinality.One\u003e;\n\nfunction op\u003c\n  Opr1 extends TypeSet\u003c$Number\u003e,\n  Opr2 extends TypeSet\u003c$Number\u003e\n\u003e(\n  opr1: Opr1,\n  op: \"?=\",\n  opr2: Opr2\n): TypeSet\u003c$Boolean, Cardinality.AtMostOne\u003e;\n\nfunction op\u003c\n  Opr1 extends TypeSet\u003c$Number\u003e,\n  Opr2 extends TypeSet\u003c$Number\u003e\n\u003e(\n  opr1: Opr1,\n  op: \"?!=\",\n  opr2: Opr2\n): TypeSet\u003c$Boolean, Cardinality.AtMostOne\u003e;\n\n// Boolean comparisons\nfunction op\u003c\n  Opr1 extends TypeSet\u003c$Boolean\u003e,\n  Opr2 extends TypeSet\u003c$Boolean\u003e\n\u003e(\n  opr1: Opr1,\n  op: \"=\",\n  opr2: Opr2\n): TypeSet\u003c$Boolean, Cardinality.One\u003e;\n\nfunction op\u003c\n  Opr1 extends TypeSet\u003c$Boolean\u003e,\n  Opr2 extends TypeSet\u003c$Boolean\u003e\n\u003e(\n  opr1: Opr1,\n  op: \"!=\",\n  opr2: Opr2\n): TypeSet\u003c$Boolean, Cardinality.One\u003e;\n\nfunction op\u003c\n  Opr1 extends TypeSet\u003c$Boolean\u003e,\n  Opr2 extends TypeSet\u003c$Boolean\u003e\n\u003e(\n  opr1: Opr1,\n  op: \"\u003e\",\n  opr2: Opr2\n): TypeSet\u003c$Boolean, Cardinality.One\u003e;\n\nfunction op\u003c\n  Opr1 extends TypeSet\u003c$Boolean\u003e,\n  Opr2 extends TypeSet\u003c$Boolean\u003e\n\u003e(\n  opr1: Opr1,\n  op: \"\u003c\",\n  opr2: Opr2\n): TypeSet\u003c$Boolean, Cardinality.One\u003e;\n\nfunction op\u003c\n  Opr1 extends TypeSet\u003c$Boolean\u003e,\n  Opr2 extends TypeSet\u003c$Boolean\u003e\n\u003e(\n  opr1: Opr1,\n  op: \"\u003e=\",\n  opr2: Opr2\n): TypeSet\u003c$Boolean, Cardinality.One\u003e;\n\nfunction op\u003c\n  Opr1 extends TypeSet\u003c$Boolean\u003e,\n  Opr2 extends TypeSet\u003c$Boolean\u003e\n\u003e(\n  opr1: Opr1,\n  op: \"\u003c=\",\n  opr2: Opr2\n): TypeSet\u003c$Boolean, Cardinality.One\u003e;\n\nfunction op\u003c\n  Opr1 extends TypeSet\u003c$Boolean\u003e,\n  Opr2 extends TypeSet\u003c$Boolean\u003e\n\u003e(\n  opr1: Opr1,\n  op: \"?=\",\n  opr2: Opr2\n): TypeSet\u003c$Boolean, Cardinality.AtMostOne\u003e;\n\nfunction op\u003c\n  Opr1 extends TypeSet\u003c$Boolean\u003e,\n  Opr2 extends TypeSet\u003c$Boolean\u003e\n\u003e(\n  opr1: Opr1,\n  op: \"?!=\",\n  opr2: Opr2\n): TypeSet\u003c$Boolean, Cardinality.AtMostOne\u003e;\n\n// Boolean logical operations\nfunction op\u003c\n  Opr1 extends TypeSet\u003c$Boolean\u003e,\n  Opr2 extends TypeSet\u003c$Boolean\u003e\n\u003e(\n  opr1: Opr1,\n  op: \"and\",\n  opr2: Opr2\n): TypeSet\u003c$Boolean, Cardinality.One\u003e;\n\nfunction op\u003c\n  Opr1 extends TypeSet\u003c$Boolean\u003e,\n  Opr2 extends TypeSet\u003c$Boolean\u003e\n\u003e(\n  opr1: Opr1,\n  op: \"or\",\n  opr2: Opr2\n): TypeSet\u003c$Boolean, Cardinality.One\u003e;\n\n// Number arithmetic operations\nfunction op\u003c\n  Opr1 extends TypeSet\u003c$Number\u003e,\n  Opr2 extends TypeSet\u003c$Number\u003e\n\u003e(\n  opr1: Opr1,\n  op: \"+\",\n  opr2: Opr2\n): TypeSet\u003c$Number, Cardinality.One\u003e;\n\nfunction op\u003c\n  Opr1 extends TypeSet\u003c$Number\u003e,\n  Opr2 extends TypeSet\u003c$Number\u003e\n\u003e(\n  opr1: Opr1,\n  op: \"-\",\n  opr2: Opr2\n): TypeSet\u003c$Number, Cardinality.One\u003e;\n\nfunction op\u003c\n  Opr1 extends TypeSet\u003c$Number\u003e,\n  Opr2 extends TypeSet\u003c$Number\u003e\n\u003e(\n  opr1: Opr1,\n  op: \"*\",\n  opr2: Opr2\n): TypeSet\u003c$Number, Cardinality.One\u003e;\n\nfunction op\u003c\n  Opr1 extends TypeSet\u003c$Number\u003e,\n  Opr2 extends TypeSet\u003c$Number\u003e\n\u003e(\n  opr1: Opr1,\n  op: \"/\",\n  opr2: Opr2\n): TypeSet\u003c$Number, Cardinality.One\u003e;\n\nfunction op\u003c\n  Opr1 extends TypeSet\u003c$Number\u003e,\n  Opr2 extends TypeSet\u003c$Number\u003e\n\u003e(\n  opr1: Opr1,\n  op: \"%\",\n  opr2: Opr2\n): TypeSet\u003c$Number, Cardinality.One\u003e;\n\nfunction op\u003c\n  Opr1 extends TypeSet\u003c$Number\u003e,\n  Opr2 extends TypeSet\u003c$Number\u003e\n\u003e(\n  opr1: Opr1,\n  op: \"//\",\n  opr2: Opr2\n): TypeSet\u003c$Number, Cardinality.One\u003e;\n\nfunction op\u003c\n  Opr1 extends TypeSet\u003c$Number\u003e,\n  Opr2 extends TypeSet\u003c$Number\u003e\n\u003e(\n  opr1: Opr1,\n  op: \"^\",\n  opr2: Opr2\n): TypeSet\u003c$Number, Cardinality.One\u003e;\n\n// Unary number operations\nfunction op\u003cOpr extends TypeSet\u003c$Number\u003e\u003e(\n  op: \"+\",\n  opr: Opr\n): TypeSet\u003c$Number, Cardinality.One\u003e;\n\nfunction op\u003cOpr extends TypeSet\u003c$Number\u003e\u003e(\n  op: \"-\",\n  opr: Opr\n): TypeSet\u003c$Number, Cardinality.One\u003e;\n\n// Unary boolean operation\nfunction op\u003cOpr extends TypeSet\u003c$Boolean\u003e\u003e(\n  op: \"not\",\n  opr: Opr\n): TypeSet\u003c$Boolean, Cardinality.One\u003e;\n\n// String-specific operations\nfunction op\u003c\n  Opr1 extends TypeSet\u003c$String\u003e,\n  Opr2 extends TypeSet\u003c$String\u003e\n\u003e(\n  opr1: Opr1,\n  op: \"ilike\",\n  opr2: Opr2\n): TypeSet\u003c$Boolean, Cardinality.One\u003e;\n\nfunction op\u003c\n  Opr1 extends TypeSet\u003c$String\u003e,\n  Opr2 extends TypeSet\u003c$String\u003e\n\u003e(\n  opr1: Opr1,\n  op: \"not ilike\",\n  opr2: Opr2\n): TypeSet\u003c$Boolean, Cardinality.One\u003e;\n\nfunction op\u003c\n  Opr1 extends TypeSet\u003c$String\u003e,\n  Opr2 extends TypeSet\u003c$String\u003e\n\u003e(\n  opr1: Opr1,\n  op: \"++\",\n  opr2: Opr2\n): TypeSet\u003c$String, Cardinality.One\u003e;\n\nfunction op(...args: any[]) {\n  return {} as any;\n}\n\nexport { op };","styles":["rest_border_box","codeBlock"],"collapsible":false},[]]]},{"name":"typesystem.ts","lang":"typescript","kind":"code","codeBlock":[[2,{"language":"typescript","code":"export enum Cardinality {\n  AtMostOne = \"AtMostOne\",\n  One = \"One\",\n  Many = \"Many\",\n  AtLeastOne = \"AtLeastOne\",\n  Empty = \"Empty\",\n}\n\nexport interface BaseType {\n  __name__: string;\n  __tstype__: string;\n}\n\nexport interface $String extends BaseType {\n  __name__: \"$String\";\n  __tstype__: \"string\";\n}\n\nexport function $string(val: string) {\n  return {\n    __element__: {\n      __name__: \"$String\",\n      __tstype__: \"string\",\n    },\n    __cardinality__: Cardinality.One,\n    __value__: val,\n  } as const;\n}\n\nexport interface $Number extends BaseType {\n  __name__: \"$Number\";\n  __tstype__: \"number\";\n}\n\nexport function $number(val: number) {\n  return {\n    __element__: {\n      __name__: \"$Number\",\n      __tstype__: \"number\",\n    },\n    __cardinality__: Cardinality.One,\n    __value__: val,\n  } as const;\n}\n\nexport interface $Boolean extends BaseType {\n  __name__: \"$Boolean\";\n  __tstype__: \"boolean\";\n}\n\nexport function $boolean(val: boolean) {\n  return {\n    __element__: {\n      __name__: \"$Boolean\",\n      __tstype__: \"boolean\",\n    },\n    __cardinality__: Cardinality.One,\n    __value__: val,\n  } as const;\n}\n\nexport interface TypeSet\u003c\n  T extends BaseType = BaseType,\n  Card extends Cardinality = Cardinality,\n\u003e {\n  __element__: T;\n  __cardinality__: Card;\n}","styles":["rest_border_box","codeBlock"],"collapsible":false},[]]]},{"name":"package.json","lang":"json","kind":"code","codeBlock":[[2,{"language":"json","code":"{\n  \"name\": \"tsperf-blog-post\",\n  \"version\": \"1.0.0\",\n  \"description\": \"\",\n  \"main\": \"index.js\",\n  \"type\": \"module\",\n  \"scripts\": {\n    \"test\": \"echo \\\"Error: no test specified\\\" \u0026\u0026 exit 1\"\n  },\n  \"keywords\": [],\n  \"author\": \"\",\n  \"license\": \"ISC\",\n  \"devDependencies\": {\n    \"@ark/attest\": \"^0.11.0\",\n    \"arktype\": \"^2.0.0-beta.3\",\n    \"tsx\": \"^4.16.2\",\n    \"typescript\": \"^5.5.3\"\n  }\n}","styles":["rest_border_box","codeBlock"],"collapsible":false},[]]]},{"name":"tsconfig.json","lang":"json","kind":"code","codeBlock":[[2,{"language":"json","code":"{\n  \"compilerOptions\": {\n    \"strict\": true,\n    \"noImplicitAny\": true,\n    \"strictNullChecks\": true,\n    \"strictFunctionTypes\": true,\n    \"strictPropertyInitialization\": true,\n    \"strictBindCallApply\": true,\n    \"noImplicitThis\": true,\n    \"noImplicitReturns\": true,\n    \"alwaysStrict\": true,\n    \"esModuleInterop\": true,\n    \"declaration\": true,\n    \"target\": \"ES2022\",\n    \"module\": \"NodeNext\",\n    \"moduleResolution\": \"NodeNext\",\n    \"skipLibCheck\": true\n  },\n  \"include\": [\"./*.ts\"]\n}","styles":["rest_border_box","codeBlock"],"collapsible":false},[]]]}]},[]],"\n"]],"\n",["div",{"styles":["section"],"data-section-id":"how-do-we-quantify-the-type-checker-s-workload","id":"how-do-we-quantify-the-type-checker-s-workload"},["\n",[4,{"id":"how-do-we-quantify-the-type-checker-s-workload","level":2},["How do we quantify the type checker’s workload?"]],"\n",["p",{},["The simplest way to measure type checker performance is to get diagnostics from the compiler. You can invoke the compiler with a flag that will output helpful metrics about the compilation process. For our use case there are a few metrics we’re interested in, the total number of type instantiations, and to a lesser degree, the wall-time spent in the type checking step. You can get these diagnostics by running the TypeScript compiler with the ",["code",{},["--extendedDiagnostics"]]," flag."]],"\n",["p",{},["The TypeScript type checker operates by analyzing the structure and relationships of types in your code. It performs type inference, checks for type compatibility, and ensures that operations are valid within the type system. During this process, the type checker often needs to create concrete instances of generic types, a process known as type instantiation. Each time a generic type is used with specific type arguments, a new type is instantiated. The number of type instantiations serves as a good proxy for the “amount of work” the type checker has to do because it directly correlates with the complexity of the type relationships in your code. More type instantiations generally indicate more complex type structures or a higher number of generic type usages, which require more processing time and memory from the type checker. By measuring the number of type instantiations, we can get a reliable, reproducible metric that reflects the workload on the type checker, independent of variations in hardware performance or other external factors."]],"\n",["p",{},["Let’s run these diagnostics now, with the ",["code",{},["--noEmit"]]," flag to avoid actually emitting JavaScript files since we only care about the type checking performance at the moment."]],"\n",[2,{"language":"bash","code":"$ npx tsc --noEmit --extendedDiagnostics\nFiles:                         66\nLines of Library:           39995\nLines of Definitions:           0\nLines of TypeScript:          268\nLines of JavaScript:            0\nLines of JSON:                  0\nLines of Other:                 0\nIdentifiers:                43933\nSymbols:                    29170\nTypes:                        288\nInstantiations:               191\nMemory used:               57207K\nAssignability cache size:      33\nIdentity cache size:            0\nSubtype cache size:            10\nStrict subtype cache size:      0\nI/O Read time:              0.01s\nParse time:                 0.28s\nResolveModule time:         0.00s\nResolveLibrary time:        0.06s\nProgram time:               0.39s\nBind time:                  0.16s\nCheck time:                 0.08s\nprintTime time:             0.00s\nEmit time:                  0.00s\nTotal time:                 0.63s","styles":["rest_border_box","codeBlock"],"collapsible":false},[]],"\n",["p",{},["We see here that we are currently instantiating 191 types in the process of checking this project."]],"\n",["p",{},["One drawback of using ",["code",{},["--extendedDiagnostics"]]," is that you do not get any real feedback about where to look to improve performance. The next tool we’ll look at, ",["code",{},["--generateTrace"]],", gives you a more detailed breakdown of what is happening during the compilation process. It hooks into the type checker and provides a detailed report of what types are being instantiated, and how long it takes."]],"\n",["p",{},["Let’s take a look at what we see when using ",["code",{},["--generateTrace"]]," which takes the name of a directory as an argument. We’ll use today’s date and time to make it easy to compare these values across time."]],"\n",[2,{"language":"bash","code":"$ npx tsc --noEmit --generateTrace 20240715T1634\n$ ls 20240715T1634\ntrace.json  types.json","styles":["rest_border_box","codeBlock"],"collapsible":false},[]],"\n",["p",{},["The TypeScript compiler will generate two files: ",["code",{},["trace.json"]]," and ",["code",{},["types.json"]],". Loading ",["code",{},["trace.json"]]," into a trace viewer like ",["a",{"href":"https://ui.perfetto.dev"},["Perfetto"]],", we can now see what was happening when compiling our code."]],"\n",["p",{},["The trace can give us some details about which expressions take the most time to check, but since it reports wall-time, it’s not a stable base to build our benchmark against. We’ll need to run this trace multiple times to get a good baseline. Luckily, our next tool gives us just such a stable measurement that is a good proxy for type-checker performance."]],"\n"]],"\n",["div",{"styles":["section"],"data-section-id":"marking-the-workbench","id":"marking-the-workbench"},["\n",[4,{"id":"marking-the-workbench","level":2},["Marking the workbench"]],"\n",["p",{},["That tool is the fantastic ",["code",{},["@arktype/attest"]]," package which contains a really helpful benchmarking library that can measure type instantiations. Let’s replace our main script with a benchmarking script that we can run using Node."]],"\n",[2,{"language":"typescript","code":" import { bench } from \"@ark/attest\";\n import { $string, $number, $boolean } from \"./typesystem.js\";\n import { op } from \"./operators.js\";\n\n // Creating a baseline expression that does not appear in the benchmarked\n // code gives more accurate results\n bench.baseline(() =\u003e $string(\"baseline\"));\n\n bench(\"string: =\", () =\u003e {\n   return op($string(\"a\"), \"=\", $string(\"b\"));\n }).types([1, \"instantiations\"]);\n\n bench(\"string: !=\", () =\u003e {\n   return op($string(\"a\"), \"!=\", $string(\"b\"));\n }).types([1, \"instantiations\"]);\n\n bench(\"string: \u003e\", () =\u003e {\n   return op($string(\"a\"), \"\u003e\", $string(\"b\"));\n }).types([1, \"instantiations\"]);\n\n bench(\"string: \u003c\", () =\u003e {\n   return op($string(\"a\"), \"\u003c\", $string(\"b\"));\n }).types([1, \"instantiations\"]);\n\n bench(\"string: \u003e=\", () =\u003e {\n   return op($string(\"a\"), \"\u003e=\", $string(\"b\"));\n }).types([1, \"instantiations\"]);\n\n bench(\"string: \u003c=\", () =\u003e {\n   return op($string(\"a\"), \"\u003c=\", $string(\"b\"));\n }).types([1, \"instantiations\"]);\n\n bench(\"string: ?=\", () =\u003e {\n   return op($string(\"a\"), \"?=\", $string(\"b\"));\n }).types([1, \"instantiations\"]);\n\n bench(\"string: ?!=\", () =\u003e {\n   return op($string(\"a\"), \"?!=\", $string(\"b\"));\n }).types([1, \"instantiations\"]);\n\n bench(\"string: ++\", () =\u003e {\n   return op($string(\"a\"), \"++\", $string(\"b\"));\n }).types([1, \"instantiations\"]);\n\n bench(\"number: =\", () =\u003e {\n   return op($number(1), \"=\", $number(1));\n }).types([1, \"instantiations\"]);\n\n bench(\"number: !=\", () =\u003e {\n   return op($number(1), \"!=\", $number(1));\n }).types([1, \"instantiations\"]);\n\n bench(\"number: \u003e\", () =\u003e {\n   return op($number(1), \"\u003e\", $number(1));\n }).types([1, \"instantiations\"]);\n\n bench(\"number: \u003c\", () =\u003e {\n   return op($number(1), \"\u003c\", $number(1));\n }).types([1, \"instantiations\"]);\n\n bench(\"number: \u003e=\", () =\u003e {\n   return op($number(1), \"\u003e=\", $number(1));\n }).types([1, \"instantiations\"]);\n\n bench(\"number: \u003c=\", () =\u003e {\n   return op($number(1), \"\u003c=\", $number(1));\n }).types([1, \"instantiations\"]);\n\n bench(\"number: ?=\", () =\u003e {\n   return op($number(1), \"?=\", $number(1));\n }).types([1, \"instantiations\"]);\n\n bench(\"number: ?!=\", () =\u003e {\n   return op($number(1), \"?!=\", $number(1));\n }).types([1, \"instantiations\"]);\n\n bench(\"number: +\", () =\u003e {\n   return op($number(1), \"+\", $number(1));\n }).types([1, \"instantiations\"]);\n\n bench(\"number: -\", () =\u003e {\n   return op($number(1), \"-\", $number(1));\n }).types([1, \"instantiations\"]);\n\n bench(\"number: *\", () =\u003e {\n   return op($number(1), \"*\", $number(1));\n }).types([1, \"instantiations\"]);\n\n bench(\"number: /\", () =\u003e {\n   return op($number(1), \"/\", $number(1));\n }).types([1, \"instantiations\"]);\n\n bench(\"number: %\", () =\u003e {\n   return op($number(1), \"%\", $number(1));\n }).types([1, \"instantiations\"]);\n\n bench(\"number: //\", () =\u003e {\n   return op($number(1), \"//\", $number(1));\n }).types([1, \"instantiations\"]);\n\n bench(\"number: ^\", () =\u003e {\n   return op($number(1), \"^\", $number(1));\n }).types([1, \"instantiations\"]);\n\n bench(\"number: unary +\", () =\u003e {\n   return op(\"+\", $number(1));\n }).types([1, \"instantiations\"]);\n\n bench(\"number: unary -\", () =\u003e {\n   return op(\"-\", $number(1));\n }).types([1, \"instantiations\"]);\n\n bench(\"boolean: =\", () =\u003e {\n   return op($boolean(true), \"=\", $boolean(false));\n }).types([1, \"instantiations\"]);\n\n bench(\"boolean: !=\", () =\u003e {\n   return op($boolean(true), \"!=\", $boolean(false));\n }).types([1, \"instantiations\"]);\n\n bench(\"boolean: \u003e\", () =\u003e {\n   return op($boolean(true), \"\u003e\", $boolean(false));\n }).types([1, \"instantiations\"]);\n\n bench(\"boolean: \u003c\", () =\u003e {\n   return op($boolean(true), \"\u003c\", $boolean(false));\n }).types([1, \"instantiations\"]);\n\n bench(\"boolean: \u003e=\", () =\u003e {\n   return op($boolean(true), \"\u003e=\", $boolean(false));\n }).types([1, \"instantiations\"]);\n\n bench(\"boolean: \u003c=\", () =\u003e {\n   return op($boolean(true), \"\u003c=\", $boolean(false));\n }).types([1, \"instantiations\"]);\n\n bench(\"boolean: ?=\", () =\u003e {\n   return op($boolean(true), \"?=\", $boolean(false));\n }).types([1, \"instantiations\"]);\n\n bench(\"boolean: ?!=\", () =\u003e {\n   return op($boolean(true), \"?!=\", $boolean(false));\n }).types([1, \"instantiations\"]);\n\n bench(\"boolean: and\", () =\u003e {\n   return op($boolean(true), \"and\", $boolean(false));\n }).types([1, \"instantiations\"]);\n\n bench(\"boolean: or\", () =\u003e {\n   return op($boolean(true), \"or\", $boolean(false));\n }).types([1, \"instantiations\"]);\n\n bench(\"boolean: not\", () =\u003e {\n   return op(\"not\", $boolean(true));\n }).types([1, \"instantiations\"]);\n\n bench(\"nested boolean: =\", () =\u003e {\n   return op(op($string(\"a\"), \"=\", $string(\"a\")), \"=\", $boolean(false));\n }).types([1, \"instantiations\"]);\n\n bench(\"string: ilike\", () =\u003e {\n   return op($string(\"a\"), \"ilike\", $string(\"apex\"));\n }).types([1, \"instantiations\"]);\n\n bench(\"string: not ilike\", () =\u003e {\n   return op($string(\"a\"), \"not ilike\", $string(\"apex\"));\n }).types([1, \"instantiations\"]);","styles":["rest_border_box","codeBlock"],"collapsible":true},[]],"\n",["p",{},["Running this benchmark with ",["code",{},["tsx"]]," will give us the following output:"]],"\n",[2,{"language":"bash","code":" $ npx tsx bench.ts\n 🏌️  string: =\n ⛳ Result: 8 instantiations\n 🎯 Baseline: 1 instantiations\n 📈 'string: =' exceeded baseline by 700.00% (threshold is 20%).\n\n 🏌️  string: !=\n ⛳ Result: 12 instantiations\n 🎯 Baseline: 1 instantiations\n 📈 'string: !=' exceeded baseline by 1100.00% (threshold is 20%).\n\n 🏌️  string: \u003e\n ⛳ Result: 16 instantiations\n 🎯 Baseline: 1 instantiations\n 📈 'string: \u003e' exceeded baseline by 1500.00% (threshold is 20%).\n\n 🏌️  string: \u003c\n ⛳ Result: 20 instantiations\n 🎯 Baseline: 1 instantiations\n 📈 'string: \u003c' exceeded baseline by 1900.00% (threshold is 20%).\n\n 🏌️  string: \u003e=\n ⛳ Result: 24 instantiations\n 🎯 Baseline: 1 instantiations\n 📈 'string: \u003e=' exceeded baseline by 2300.00% (threshold is 20%).\n\n 🏌️  string: \u003c=\n ⛳ Result: 28 instantiations\n 🎯 Baseline: 1 instantiations\n 📈 'string: \u003c=' exceeded baseline by 2700.00% (threshold is 20%).\n\n 🏌️  string: ?=\n ⛳ Result: 32 instantiations\n 🎯 Baseline: 1 instantiations\n 📈 'string: ?=' exceeded baseline by 3100.00% (threshold is 20%).\n\n 🏌️  string: ?!=\n ⛳ Result: 36 instantiations\n 🎯 Baseline: 1 instantiations\n 📈 'string: ?!=' exceeded baseline by 3500.00% (threshold is 20%).\n\n 🏌️  string: ++\n ⛳ Result: 93 instantiations\n 🎯 Baseline: 1 instantiations\n 📈 'string: ++' exceeded baseline by 9200.00% (threshold is 20%).\n\n 🏌️  number: =\n ⛳ Result: 17 instantiations\n 🎯 Baseline: 1 instantiations\n 📈 'number: =' exceeded baseline by 1600.00% (threshold is 20%).\n\n 🏌️  number: !=\n ⛳ Result: 21 instantiations\n 🎯 Baseline: 1 instantiations\n 📈 'number: !=' exceeded baseline by 2000.00% (threshold is 20%).\n\n 🏌️  number: \u003e\n ⛳ Result: 25 instantiations\n 🎯 Baseline: 1 instantiations\n 📈 'number: \u003e' exceeded baseline by 2400.00% (threshold is 20%).\n\n 🏌️  number: \u003c\n ⛳ Result: 29 instantiations\n 🎯 Baseline: 1 instantiations\n 📈 'number: \u003c' exceeded baseline by 2800.00% (threshold is 20%).\n\n 🏌️  number: \u003e=\n ⛳ Result: 33 instantiations\n 🎯 Baseline: 1 instantiations\n 📈 'number: \u003e=' exceeded baseline by 3200.00% (threshold is 20%).\n\n 🏌️  number: \u003c=\n ⛳ Result: 37 instantiations\n 🎯 Baseline: 1 instantiations\n 📈 'number: \u003c=' exceeded baseline by 3600.00% (threshold is 20%).\n\n 🏌️  number: ?=\n ⛳ Result: 41 instantiations\n 🎯 Baseline: 1 instantiations\n 📈 'number: ?=' exceeded baseline by 4000.00% (threshold is 20%).\n\n 🏌️  number: ?!=\n ⛳ Result: 45 instantiations\n 🎯 Baseline: 1 instantiations\n 📈 'number: ?!=' exceeded baseline by 4400.00% (threshold is 20%).\n\n 🏌️  number: +\n ⛳ Result: 71 instantiations\n 🎯 Baseline: 1 instantiations\n 📈 'number: +' exceeded baseline by 7000.00% (threshold is 20%).\n\n 🏌️  number: -\n ⛳ Result: 75 instantiations\n 🎯 Baseline: 1 instantiations\n 📈 'number: -' exceeded baseline by 7400.00% (threshold is 20%).\n\n 🏌️  number: *\n ⛳ Result: 79 instantiations\n 🎯 Baseline: 1 instantiations\n 📈 'number: *' exceeded baseline by 7800.00% (threshold is 20%).\n\n 🏌️  number: /\n ⛳ Result: 83 instantiations\n 🎯 Baseline: 1 instantiations\n 📈 'number: /' exceeded baseline by 8200.00% (threshold is 20%).\n\n 🏌️  number: %\n ⛳ Result: 87 instantiations\n 🎯 Baseline: 1 instantiations\n 📈 'number: %' exceeded baseline by 8600.00% (threshold is 20%).\n\n 🏌️  number: //\n ⛳ Result: 91 instantiations\n 🎯 Baseline: 1 instantiations\n 📈 'number: //' exceeded baseline by 9000.00% (threshold is 20%).\n\n 🏌️  number: ^\n ⛳ Result: 95 instantiations\n 🎯 Baseline: 1 instantiations\n 📈 'number: ^' exceeded baseline by 9400.00% (threshold is 20%).\n\n 🏌️  number: unary +\n ⛳ Result: 5 instantiations\n 🎯 Baseline: 1 instantiations\n 📈 'number: unary +' exceeded baseline by 400.00% (threshold is 20%).\n\n 🏌️  number: unary -\n ⛳ Result: 6 instantiations\n 🎯 Baseline: 1 instantiations\n 📈 'number: unary -' exceeded baseline by 500.00% (threshold is 20%).\n\n 🏌️  boolean: =\n ⛳ Result: 20 instantiations\n 🎯 Baseline: 1 instantiations\n 📈 'boolean: =' exceeded baseline by 1900.00% (threshold is 20%).\n\n 🏌️  boolean: !=\n ⛳ Result: 25 instantiations\n 🎯 Baseline: 1 instantiations\n 📈 'boolean: !=' exceeded baseline by 2400.00% (threshold is 20%).\n\n 🏌️  boolean: \u003e\n ⛳ Result: 29 instantiations\n 🎯 Baseline: 1 instantiations\n 📈 'boolean: \u003e' exceeded baseline by 2800.00% (threshold is 20%).\n\n 🏌️  boolean: \u003c\n ⛳ Result: 33 instantiations\n 🎯 Baseline: 1 instantiations\n 📈 'boolean: \u003c' exceeded baseline by 3200.00% (threshold is 20%).\n\n 🏌️  boolean: \u003e=\n ⛳ Result: 37 instantiations\n 🎯 Baseline: 1 instantiations\n 📈 'boolean: \u003e=' exceeded baseline by 3600.00% (threshold is 20%).\n\n 🏌️  boolean: \u003c=\n ⛳ Result: 41 instantiations\n 🎯 Baseline: 1 instantiations\n 📈 'boolean: \u003c=' exceeded baseline by 4000.00% (threshold is 20%).\n\n 🏌️  boolean: ?=\n ⛳ Result: 45 instantiations\n 🎯 Baseline: 1 instantiations\n 📈 'boolean: ?=' exceeded baseline by 4400.00% (threshold is 20%).\n\n 🏌️  boolean: ?!=\n ⛳ Result: 49 instantiations\n 🎯 Baseline: 1 instantiations\n 📈 'boolean: ?!=' exceeded baseline by 4800.00% (threshold is 20%).\n\n 🏌️  boolean: and\n ⛳ Result: 53 instantiations\n 🎯 Baseline: 1 instantiations\n 📈 'boolean: and' exceeded baseline by 5200.00% (threshold is 20%).\n\n 🏌️  boolean: or\n ⛳ Result: 57 instantiations\n 🎯 Baseline: 1 instantiations\n 📈 'boolean: or' exceeded baseline by 5600.00% (threshold is 20%).\n\n 🏌️  boolean: not\n ⛳ Result: 3 instantiations\n 🎯 Baseline: 1 instantiations\n 📈 'boolean: not' exceeded baseline by 200.00% (threshold is 20%).\n\n 🏌️  nested boolean: =\n ⛳ Result: 28 instantiations\n 🎯 Baseline: 1 instantiations\n 📈 'nested boolean: =' exceeded baseline by 2700.00% (threshold is 20%).\n\n 🏌️  string: ilike\n ⛳ Result: 85 instantiations\n 🎯 Baseline: 1 instantiations\n 📈 'string: ilike' exceeded baseline by 8400.00% (threshold is 20%).\n\n 🏌️  string: not ilike\n ⛳ Result: 89 instantiations\n 🎯 Baseline: 1 instantiations\n 📈 'string: not ilike' exceeded baseline by 8800.00% (threshold is 20%).\n\n ❌ 'string: =' exceeded baseline by 700.00% (threshold is 20%).\n ❌ 'string: !=' exceeded baseline by 1100.00% (threshold is 20%).\n ❌ 'string: \u003e' exceeded baseline by 1500.00% (threshold is 20%).\n ❌ 'string: \u003c' exceeded baseline by 1900.00% (threshold is 20%).\n ❌ 'string: \u003e=' exceeded baseline by 2300.00% (threshold is 20%).\n ❌ 'string: \u003c=' exceeded baseline by 2700.00% (threshold is 20%).\n ❌ 'string: ?=' exceeded baseline by 3100.00% (threshold is 20%).\n ❌ 'string: ?!=' exceeded baseline by 3500.00% (threshold is 20%).\n ❌ 'string: ++' exceeded baseline by 9200.00% (threshold is 20%).\n ❌ 'number: =' exceeded baseline by 1600.00% (threshold is 20%).\n ❌ 'number: !=' exceeded baseline by 2000.00% (threshold is 20%).\n ❌ 'number: \u003e' exceeded baseline by 2400.00% (threshold is 20%).\n ❌ 'number: \u003c' exceeded baseline by 2800.00% (threshold is 20%).\n ❌ 'number: \u003e=' exceeded baseline by 3200.00% (threshold is 20%).\n ❌ 'number: \u003c=' exceeded baseline by 3600.00% (threshold is 20%).\n ❌ 'number: ?=' exceeded baseline by 4000.00% (threshold is 20%).\n ❌ 'number: ?!=' exceeded baseline by 4400.00% (threshold is 20%).\n ❌ 'number: +' exceeded baseline by 7000.00% (threshold is 20%).\n ❌ 'number: -' exceeded baseline by 7400.00% (threshold is 20%).\n ❌ 'number: *' exceeded baseline by 7800.00% (threshold is 20%).\n ❌ 'number: /' exceeded baseline by 8200.00% (threshold is 20%).\n ❌ 'number: %' exceeded baseline by 8600.00% (threshold is 20%).\n ❌ 'number: //' exceeded baseline by 9000.00% (threshold is 20%).\n ❌ 'number: ^' exceeded baseline by 9400.00% (threshold is 20%).\n ❌ 'number: unary +' exceeded baseline by 400.00% (threshold is 20%).\n ❌ 'number: unary -' exceeded baseline by 500.00% (threshold is 20%).\n ❌ 'boolean: =' exceeded baseline by 1900.00% (threshold is 20%).\n ❌ 'boolean: !=' exceeded baseline by 2400.00% (threshold is 20%).\n ❌ 'boolean: \u003e' exceeded baseline by 2800.00% (threshold is 20%).\n ❌ 'boolean: \u003c' exceeded baseline by 3200.00% (threshold is 20%).\n ❌ 'boolean: \u003e=' exceeded baseline by 3600.00% (threshold is 20%).\n ❌ 'boolean: \u003c=' exceeded baseline by 4000.00% (threshold is 20%).\n ❌ 'boolean: ?=' exceeded baseline by 4400.00% (threshold is 20%).\n ❌ 'boolean: ?!=' exceeded baseline by 4800.00% (threshold is 20%).\n ❌ 'boolean: and' exceeded baseline by 5200.00% (threshold is 20%).\n ❌ 'boolean: or' exceeded baseline by 5600.00% (threshold is 20%).\n ❌ 'boolean: not' exceeded baseline by 200.00% (threshold is 20%).\n ❌ 'nested boolean: =' exceeded baseline by 2700.00% (threshold is 20%).\n ❌ 'string: ilike' exceeded baseline by 8400.00% (threshold is 20%).\n ❌ 'string: not ilike' exceeded baseline by 8800.00% (threshold is 20%).","styles":["rest_border_box","codeBlock"],"collapsible":true},[]],"\n",["p",{},["The ",["code",{},["@arktype/attest"]]," output provides a detailed breakdown of type instantiations for each expression, comparing them to our initial placeholder baseline. We’ll use these results as our actual baseline, updating our benchmark script with the real instantiation counts."]],"\n"]],"\n",["div",{"styles":["section"],"data-section-id":"the-bam-method","id":"the-bam-method"},["\n",[4,{"id":"the-bam-method","level":2},["The BAM Method"]],"\n",["p",{},["To address TypeScript type inference performance issues, I propose the “BAM” method: Branch, Adjust, Measure. This iterative approach involves:"]],"\n",["ol",{},["\n",["li",{},["\n",["p",{},[["b",{},["Branch"]],": Create a new branch for each experiment"]],"\n"]],"\n",["li",{},["\n",["p",{},[["b",{},["Adjust"]],": Make changes based on a hypothesis"]],"\n"]],"\n",["li",{},["\n",["p",{},[["b",{},["Measure"]],": Benchmark the changes to measure their impact"]],"\n"]],"\n"]],"\n",["p",{},["By systematically applying this process, we can refine our code for better type inference performance. Crucially, the benchmarking step provides concrete measurements, ensuring we can verify our improvements."]],"\n",["p",{},["First, we’ll ",["em",{},["branch"]]," to create a new experimental version of our code. Let’s assume that we’re working on a branch called ",["code",{},["1234-some-perf-work"]],". We will name this new experimental branch ",["code",{},["1234-experiments/union-operators"]],"."]],"\n",["p",{},["Our hypothesis is that defining a union to describe the various operators for a given operand-pair might be faster for the type checker to infer. This approach could potentially reduce the number of overloads the type checker needs to consider, as it groups similar operations together. By consolidating the operator types into a union, we might simplify the type inference process, potentially leading to fewer type instantiations and improved performance."]],"\n",["p",{},["Then, we’ll ",["em",{},["adjust"]]," our implementation based on this hypothesis. After making these adjustments, we’ll ",["em",{},["measure"]]," the impact using our benchmarking tools to verify if our hypothesis leads to improved performance."]],"\n",["p",{},["Branch:"]],"\n",[2,{"language":"bash","code":"$ git checkout -b 1234-experiments/union-operators 1234-some-perf-work","styles":["rest_border_box","codeBlock"],"collapsible":false},[]],"\n",["p",{},["Adjust:"]],"\n",[2,{"language":"typescript","code":" function op\u003cOpr1 extends TypeSet\u003c$String\u003e, Opr2 extends TypeSet\u003c$String\u003e\u003e(\n   opr1: Opr1,\n   op: \"=\" | \"!=\" | \"\u003e\" | \"\u003c\" | \"\u003e=\" | \"\u003c=\" | \"ilike\" | \"not ilike\",\n   opr2: Opr2,\n ): TypeSet\u003c$Boolean, Cardinality.One\u003e;\n function op\u003cOpr1 extends TypeSet\u003c$String\u003e, Opr2 extends TypeSet\u003c$String\u003e\u003e(\n   opr1: Opr1,\n   op: \"?=\" | \"!?=\",\n   opr2: Opr2,\n ): TypeSet\u003c$Boolean, Cardinality.AtMostOne\u003e;\n\n function op\u003cOpr1 extends TypeSet\u003c$Number\u003e, Opr2 extends TypeSet\u003c$Number\u003e\u003e(\n   opr1: Opr1,\n   op: \"=\" | \"!=\" | \"\u003e\" | \"\u003c\" | \"\u003e=\" | \"\u003c=\",\n   opr2: Opr2,\n ): TypeSet\u003c$Boolean, Cardinality.One\u003e;\n function op\u003cOpr1 extends TypeSet\u003c$Number\u003e, Opr2 extends TypeSet\u003c$Number\u003e\u003e(\n   opr1: Opr1,\n   op: \"?=\" | \"!?=\",\n   opr2: Opr2,\n ): TypeSet\u003c$Boolean, Cardinality.AtMostOne\u003e;\n\n function op\u003cOpr1 extends TypeSet\u003c$Boolean\u003e, Opr2 extends TypeSet\u003c$Boolean\u003e\u003e(\n   opr1: Opr1,\n   op: \"=\" | \"!=\" | \"\u003e\" | \"\u003c\" | \"\u003e=\" | \"\u003c=\" | \"and\" | \"or\",\n   opr2: Opr2,\n ): TypeSet\u003c$Boolean, Cardinality.One\u003e;\n function op\u003cOpr1 extends TypeSet\u003c$Boolean\u003e, Opr2 extends TypeSet\u003c$Boolean\u003e\u003e(\n   opr1: Opr1,\n   op: \"?=\" | \"!?=\",\n   opr2: Opr2,\n ): TypeSet\u003c$Boolean, Cardinality.AtMostOne\u003e;\n\n function op\u003cOpr1 extends TypeSet\u003c$Number\u003e, Opr2 extends TypeSet\u003c$Number\u003e\u003e(\n   opr1: Opr1,\n   op: \"+\" | \"-\" | \"*\" | \"/\" | \"%\" | \"//\" | \"^\",\n   opr2: Opr2,\n ): TypeSet\u003c$Number, Cardinality.One\u003e;\n\n function op\u003cOpr extends TypeSet\u003c$Number\u003e\u003e(\n   op: \"+\" | \"-\",\n   opr: Opr,\n ): TypeSet\u003c$Number, Cardinality.One\u003e;\n\n function op\u003cOpr extends TypeSet\u003c$Boolean\u003e\u003e(\n   op: \"not\",\n   opr: Opr,\n ): TypeSet\u003c$Boolean, Cardinality.One\u003e;\n\n function op\u003cOpr1 extends TypeSet\u003c$String\u003e, Opr2 extends TypeSet\u003c$String\u003e\u003e(\n   opr1: Opr1,\n   op: \"++\",\n   opr2: Opr2,\n ): TypeSet\u003c$String, Cardinality.One\u003e;","styles":["rest_border_box","codeBlock"],"collapsible":true},[]],"\n",["p",{},["Benchmark:"]],"\n",[2,{"language":"bash","code":" $ npx tsx bench.ts\n 🏌️  string: =\n ⛳ Result: 12 instantiations\n 🎯 Baseline: 8 instantiations\n 📈 'string: =' exceeded baseline by 50.00% (threshold is 20%).\n\n 🏌️  string: !=\n ⛳ Result: 12 instantiations\n 🎯 Baseline: 12 instantiations\n 📊 Delta: 0.00%\n\n 🏌️  string: \u003e\n ⛳ Result: 12 instantiations\n 🎯 Baseline: 16 instantiations\n 📉 string: \u003e was under baseline by 25.00%! Consider setting a new baseline.\n\n 🏌️  string: \u003c\n ⛳ Result: 12 instantiations\n 🎯 Baseline: 20 instantiations\n 📉 string: \u003c was under baseline by 40.00%! Consider setting a new baseline.\n\n 🏌️  string: \u003e=\n ⛳ Result: 12 instantiations\n 🎯 Baseline: 24 instantiations\n 📉 string: \u003e= was under baseline by 50.00%! Consider setting a new baseline.\n\n 🏌️  string: \u003c=\n ⛳ Result: 12 instantiations\n 🎯 Baseline: 28 instantiations\n 📉 string: \u003c= was under baseline by 57.14%! Consider setting a new baseline.\n\n 🏌️  string: ?=\n ⛳ Result: 16 instantiations\n 🎯 Baseline: 32 instantiations\n 📉 string: ?= was under baseline by 50.00%! Consider setting a new baseline.\n\n 🏌️  string: ?!=\n ⛳ Result: 16 instantiations\n 🎯 Baseline: 36 instantiations\n 📉 string: ?!= was under baseline by 55.56%! Consider setting a new baseline.\n\n 🏌️  string: ++\n ⛳ Result: 8 instantiations\n 🎯 Baseline: 102 instantiations\n 📉 string: ++ was under baseline by 92.16%! Consider setting a new baseline.\n\n 🏌️  number: =\n ⛳ Result: 16 instantiations\n 🎯 Baseline: 26 instantiations\n 📉 number: = was under baseline by 38.46%! Consider setting a new baseline.\n\n 🏌️  number: !=\n ⛳ Result: 16 instantiations\n 🎯 Baseline: 30 instantiations\n 📉 number: != was under baseline by 46.67%! Consider setting a new baseline.\n\n 🏌️  number: \u003e\n ⛳ Result: 16 instantiations\n 🎯 Baseline: 34 instantiations\n 📉 number: \u003e was under baseline by 52.94%! Consider setting a new baseline.\n\n 🏌️  number: \u003c\n ⛳ Result: 16 instantiations\n 🎯 Baseline: 38 instantiations\n 📉 number: \u003c was under baseline by 57.89%! Consider setting a new baseline.\n\n 🏌️  number: \u003e=\n ⛳ Result: 16 instantiations\n 🎯 Baseline: 42 instantiations\n 📉 number: \u003e= was under baseline by 61.90%! Consider setting a new baseline.\n\n 🏌️  number: \u003c=\n ⛳ Result: 16 instantiations\n 🎯 Baseline: 46 instantiations\n 📉 number: \u003c= was under baseline by 65.22%! Consider setting a new baseline.\n\n 🏌️  number: ?=\n ⛳ Result: 20 instantiations\n 🎯 Baseline: 50 instantiations\n 📉 number: ?= was under baseline by 60.00%! Consider setting a new baseline.\n\n 🏌️  number: ?!=\n ⛳ Result: 20 instantiations\n 🎯 Baseline: 54 instantiations\n 📉 number: ?!= was under baseline by 62.96%! Consider setting a new baseline.\n\n 🏌️  number: +\n ⛳ Result: 30 instantiations\n 🎯 Baseline: 80 instantiations\n 📉 number: + was under baseline by 62.50%! Consider setting a new baseline.\n\n 🏌️  number: -\n ⛳ Result: 30 instantiations\n 🎯 Baseline: 84 instantiations\n 📉 number: - was under baseline by 64.29%! Consider setting a new baseline.\n\n 🏌️  number: *\n ⛳ Result: 30 instantiations\n 🎯 Baseline: 88 instantiations\n 📉 number: * was under baseline by 65.91%! Consider setting a new baseline.\n\n 🏌️  number: /\n ⛳ Result: 30 instantiations\n 🎯 Baseline: 92 instantiations\n 📉 number: / was under baseline by 67.39%! Consider setting a new baseline.\n\n 🏌️  number: %\n ⛳ Result: 30 instantiations\n 🎯 Baseline: 96 instantiations\n 📉 number: % was under baseline by 68.75%! Consider setting a new baseline.\n\n 🏌️  number: //\n ⛳ Result: 30 instantiations\n 🎯 Baseline: 100 instantiations\n 📉 number: // was under baseline by 70.00%! Consider setting a new baseline.\n\n 🏌️  number: ^\n ⛳ Result: 30 instantiations\n 🎯 Baseline: 104 instantiations\n 📉 number: ^ was under baseline by 71.15%! Consider setting a new baseline.\n\n 🏌️  number: unary +\n ⛳ Result: 6 instantiations\n 🎯 Baseline: 5 instantiations\n 📊 Delta: +20.00%\n\n 🏌️  number: unary -\n ⛳ Result: 6 instantiations\n 🎯 Baseline: 6 instantiations\n 📊 Delta: 0.00%\n\n 🏌️  boolean: =\n ⛳ Result: 22 instantiations\n 🎯 Baseline: 44 instantiations\n 📉 boolean: = was under baseline by 50.00%! Consider setting a new baseline.\n\n 🏌️  boolean: !=\n ⛳ Result: 22 instantiations\n 🎯 Baseline: 48 instantiations\n 📉 boolean: != was under baseline by 54.17%! Consider setting a new baseline.\n\n 🏌️  boolean: \u003e\n ⛳ Result: 22 instantiations\n 🎯 Baseline: 52 instantiations\n 📉 boolean: \u003e was under baseline by 57.69%! Consider setting a new baseline.\n\n 🏌️  boolean: \u003c\n ⛳ Result: 22 instantiations\n 🎯 Baseline: 56 instantiations\n 📉 boolean: \u003c was under baseline by 60.71%! Consider setting a new baseline.\n\n 🏌️  boolean: \u003e=\n ⛳ Result: 22 instantiations\n 🎯 Baseline: 60 instantiations\n 📉 boolean: \u003e= was under baseline by 63.33%! Consider setting a new baseline.\n\n 🏌️  boolean: \u003c=\n ⛳ Result: 22 instantiations\n 🎯 Baseline: 64 instantiations\n 📉 boolean: \u003c= was under baseline by 65.63%! Consider setting a new baseline.\n\n 🏌️  boolean: ?=\n ⛳ Result: 26 instantiations\n 🎯 Baseline: 68 instantiations\n 📉 boolean: ?= was under baseline by 61.76%! Consider setting a new baseline.\n\n 🏌️  boolean: ?!=\n ⛳ Result: 26 instantiations\n 🎯 Baseline: 72 instantiations\n 📉 boolean: ?!= was under baseline by 63.89%! Consider setting a new baseline.\n\n 🏌️  boolean: and\n ⛳ Result: 22 instantiations\n 🎯 Baseline: 76 instantiations\n 📉 boolean: and was under baseline by 71.05%! Consider setting a new baseline.\n\n 🏌️  boolean: or\n ⛳ Result: 22 instantiations\n 🎯 Baseline: 80 instantiations\n 📉 boolean: or was under baseline by 72.50%! Consider setting a new baseline.\n\n 🏌️  boolean: not\n ⛳ Result: 5 instantiations\n 🎯 Baseline: 6 instantiations\n 📊 Delta: -16.67%\n\n 🏌️  nested boolean: =\n ⛳ Result: 41 instantiations\n 🎯 Baseline: 48 instantiations\n 📊 Delta: -14.58%\n\n 🏌️  string: ilike\n ⛳ Result: 12 instantiations\n 🎯 Baseline: 94 instantiations\n 📉 string: ilike was under baseline by 87.23%! Consider setting a new baseline.\n\n 🏌️  string: not ilike\n ⛳ Result: 12 instantiations\n 🎯 Baseline: 98 instantiations\n 📉 string: not ilike was under baseline by 87.76%! Consider setting a new baseline.\n\n ❌ 'string: =' exceeded baseline by 50.00% (threshold is 20%).","styles":["rest_border_box","codeBlock"],"collapsible":true},[]],"\n",["p",{},["Incredibly, everything with the exception of the very first operator and unary ",["code",{},["+"]]," got better. Let’s save a commit with these changes to this branch."]],"\n",[2,{"language":"bash","code":"$ git commit -m \"Use a union of operators\"","styles":["rest_border_box","codeBlock"],"collapsible":false},[]],"\n",["p",{},["I suggest making two separate commits: one with the changes to the implementation, and a second that updates the benchmark results. This makes it easier to compare approaches against the baseline, but also you can checkout the benchmark file across branches to compare how different approaches differ in the benchmarks. Let’s update the benchmark results in the ",["code",{},["index.ts"]]," file, and commit another change."]],"\n",[2,{"language":"bash","code":"$ git commit -m \"Update benchmark results\"","styles":["rest_border_box","codeBlock"],"collapsible":false},[]],"\n",["p",{},["Let’s branch again and explore a new hypothesis that builds on the existing construct. We will use the existing experiment as the starting point for our new branch rather than starting over from the base. However we should branch from the previous commit instead of the commit that updated the benchmarks. Let’s explore the hypothesis that the order of the overloads has an effect on the number of types the inference engine has to instantiate here. Let’s order them such that the same operators are grouped together."]],"\n",[2,{"language":"bash","code":"$ git checkout -b 1234-experiments/union-operators/group-by-operators HEAD~1","styles":["rest_border_box","codeBlock"],"collapsible":false},[]],"\n",["p",{},["Making our adjustments, we see the following benchmark results:"]],"\n",[2,{"language":"bash","code":" $ npx tsx bench.ts\n 🏌️  string: =\n ⛳ Result: 12 instantiations\n 🎯 Baseline: 8 instantiations\n 📈 'string: =' exceeded baseline by 50.00% (threshold is 20%).\n\n 🏌️  string: !=\n ⛳ Result: 12 instantiations\n 🎯 Baseline: 12 instantiations\n 📊 Delta: 0.00%\n\n 🏌️  string: \u003e\n ⛳ Result: 12 instantiations\n 🎯 Baseline: 16 instantiations\n 📉 string: \u003e was under baseline by 25.00%! Consider setting a new baseline.\n\n 🏌️  string: \u003c\n ⛳ Result: 12 instantiations\n 🎯 Baseline: 20 instantiations\n 📉 string: \u003c was under baseline by 40.00%! Consider setting a new baseline.\n\n 🏌️  string: \u003e=\n ⛳ Result: 12 instantiations\n 🎯 Baseline: 24 instantiations\n 📉 string: \u003e= was under baseline by 50.00%! Consider setting a new baseline.\n\n 🏌️  string: \u003c=\n ⛳ Result: 12 instantiations\n 🎯 Baseline: 28 instantiations\n 📉 string: \u003c= was under baseline by 57.14%! Consider setting a new baseline.\n\n 🏌️  string: ?=\n ⛳ Result: 24 instantiations\n 🎯 Baseline: 32 instantiations\n 📉 string: ?= was under baseline by 25.00%! Consider setting a new baseline.\n\n 🏌️  string: ?!=\n ⛳ Result: 24 instantiations\n 🎯 Baseline: 36 instantiations\n 📉 string: ?!= was under baseline by 33.33%! Consider setting a new baseline.\n\n 🏌️  string: ++\n ⛳ Result: 8 instantiations\n 🎯 Baseline: 102 instantiations\n 📉 string: ++ was under baseline by 92.16%! Consider setting a new baseline.\n\n 🏌️  number: =\n ⛳ Result: 14 instantiations\n 🎯 Baseline: 26 instantiations\n 📉 number: = was under baseline by 46.15%! Consider setting a new baseline.\n\n 🏌️  number: !=\n ⛳ Result: 14 instantiations\n 🎯 Baseline: 30 instantiations\n 📉 number: != was under baseline by 53.33%! Consider setting a new baseline.\n\n 🏌️  number: \u003e\n ⛳ Result: 14 instantiations\n 🎯 Baseline: 34 instantiations\n 📉 number: \u003e was under baseline by 58.82%! Consider setting a new baseline.\n\n 🏌️  number: \u003c\n ⛳ Result: 14 instantiations\n 🎯 Baseline: 38 instantiations\n 📉 number: \u003c was under baseline by 63.16%! Consider setting a new baseline.\n\n 🏌️  number: \u003e=\n ⛳ Result: 14 instantiations\n 🎯 Baseline: 42 instantiations\n 📉 number: \u003e= was under baseline by 66.67%! Consider setting a new baseline.\n\n 🏌️  number: \u003c=\n ⛳ Result: 14 instantiations\n 🎯 Baseline: 46 instantiations\n 📉 number: \u003c= was under baseline by 69.57%! Consider setting a new baseline.\n\n 🏌️  number: ?=\n ⛳ Result: 24 instantiations\n 🎯 Baseline: 50 instantiations\n 📉 number: ?= was under baseline by 52.00%! Consider setting a new baseline.\n\n 🏌️  number: ?!=\n ⛳ Result: 24 instantiations\n 🎯 Baseline: 54 instantiations\n 📉 number: ?!= was under baseline by 55.56%! Consider setting a new baseline.\n\n 🏌️  number: +\n ⛳ Result: 30 instantiations\n 🎯 Baseline: 80 instantiations\n 📉 number: + was under baseline by 62.50%! Consider setting a new baseline.\n\n 🏌️  number: -\n ⛳ Result: 30 instantiations\n 🎯 Baseline: 84 instantiations\n 📉 number: - was under baseline by 64.29%! Consider setting a new baseline.\n\n 🏌️  number: *\n ⛳ Result: 30 instantiations\n 🎯 Baseline: 88 instantiations\n 📉 number: * was under baseline by 65.91%! Consider setting a new baseline.\n\n 🏌️  number: /\n ⛳ Result: 30 instantiations\n 🎯 Baseline: 92 instantiations\n 📉 number: / was under baseline by 67.39%! Consider setting a new baseline.\n\n 🏌️  number: %\n ⛳ Result: 30 instantiations\n 🎯 Baseline: 96 instantiations\n 📉 number: % was under baseline by 68.75%! Consider setting a new baseline.\n\n 🏌️  number: //\n ⛳ Result: 30 instantiations\n 🎯 Baseline: 100 instantiations\n 📉 number: // was under baseline by 70.00%! Consider setting a new baseline.\n\n 🏌️  number: ^\n ⛳ Result: 30 instantiations\n 🎯 Baseline: 104 instantiations\n 📉 number: ^ was under baseline by 71.15%! Consider setting a new baseline.\n\n 🏌️  number: unary +\n ⛳ Result: 6 instantiations\n 🎯 Baseline: 5 instantiations\n 📊 Delta: +20.00%\n\n 🏌️  number: unary -\n ⛳ Result: 6 instantiations\n 🎯 Baseline: 6 instantiations\n 📊 Delta: 0.00%\n\n 🏌️  boolean: =\n ⛳ Result: 18 instantiations\n 🎯 Baseline: 44 instantiations\n 📉 boolean: = was under baseline by 59.09%! Consider setting a new baseline.\n\n 🏌️  boolean: !=\n ⛳ Result: 18 instantiations\n 🎯 Baseline: 48 instantiations\n 📉 boolean: != was under baseline by 62.50%! Consider setting a new baseline.\n\n 🏌️  boolean: \u003e\n ⛳ Result: 18 instantiations\n 🎯 Baseline: 52 instantiations\n 📉 boolean: \u003e was under baseline by 65.38%! Consider setting a new baseline.\n\n 🏌️  boolean: \u003c\n ⛳ Result: 18 instantiations\n 🎯 Baseline: 56 instantiations\n 📉 boolean: \u003c was under baseline by 67.86%! Consider setting a new baseline.\n\n 🏌️  boolean: \u003e=\n ⛳ Result: 18 instantiations\n 🎯 Baseline: 60 instantiations\n 📉 boolean: \u003e= was under baseline by 70.00%! Consider setting a new baseline.\n\n 🏌️  boolean: \u003c=\n ⛳ Result: 18 instantiations\n 🎯 Baseline: 64 instantiations\n 📉 boolean: \u003c= was under baseline by 71.88%! Consider setting a new baseline.\n\n 🏌️  boolean: ?=\n ⛳ Result: 26 instantiations\n 🎯 Baseline: 68 instantiations\n 📉 boolean: ?= was under baseline by 61.76%! Consider setting a new baseline.\n\n 🏌️  boolean: ?!=\n ⛳ Result: 26 instantiations\n 🎯 Baseline: 72 instantiations\n 📉 boolean: ?!= was under baseline by 63.89%! Consider setting a new baseline.\n\n 🏌️  boolean: and\n ⛳ Result: 18 instantiations\n 🎯 Baseline: 76 instantiations\n 📉 boolean: and was under baseline by 76.32%! Consider setting a new baseline.\n\n 🏌️  boolean: or\n ⛳ Result: 18 instantiations\n 🎯 Baseline: 80 instantiations\n 📉 boolean: or was under baseline by 77.50%! Consider setting a new baseline.\n\n 🏌️  boolean: not\n ⛳ Result: 5 instantiations\n 🎯 Baseline: 6 instantiations\n 📊 Delta: -16.67%\n\n 🏌️  nested boolean: =\n ⛳ Result: 39 instantiations\n 🎯 Baseline: 48 instantiations\n 📊 Delta: -18.75%\n\n 🏌️  string: ilike\n ⛳ Result: 12 instantiations\n 🎯 Baseline: 94 instantiations\n 📉 string: ilike was under baseline by 87.23%! Consider setting a new baseline.\n\n 🏌️  string: not ilike\n ⛳ Result: 12 instantiations\n 🎯 Baseline: 98 instantiations\n 📉 string: not ilike was under baseline by 87.76%! Consider setting a new baseline.\n\n ❌ 'string: =' exceeded baseline by 50.00% (threshold is 20%).","styles":["rest_border_box","codeBlock"],"collapsible":true},[]],"\n",["p",{},["This implementation is also great! Is it better than the previous experiment? We can check by checking out the benchmark commit from the other branch."]],"\n",[2,{"language":"bash","code":" $ git checkout 1234-experiments/union-operators -- index.ts\n $ npx tsx index.ts\n 🏌️  string: =\n ⛳ Result: 12 instantiations\n 🎯 Baseline: 12 instantiations\n 📊 Delta: 0.00%\n\n 🏌️  string: !=\n ⛳ Result: 12 instantiations\n 🎯 Baseline: 12 instantiations\n 📊 Delta: 0.00%\n\n 🏌️  string: \u003e\n ⛳ Result: 12 instantiations\n 🎯 Baseline: 12 instantiations\n 📊 Delta: 0.00%\n\n 🏌️  string: \u003c\n ⛳ Result: 12 instantiations\n 🎯 Baseline: 12 instantiations\n 📊 Delta: 0.00%\n\n 🏌️  string: \u003e=\n ⛳ Result: 12 instantiations\n 🎯 Baseline: 12 instantiations\n 📊 Delta: 0.00%\n\n 🏌️  string: \u003c=\n ⛳ Result: 12 instantiations\n 🎯 Baseline: 12 instantiations\n 📊 Delta: 0.00%\n\n 🏌️  string: ?=\n ⛳ Result: 24 instantiations\n 🎯 Baseline: 16 instantiations\n 📈 'string: ?=' exceeded baseline by 50.00% (threshold is 20%).\n\n 🏌️  string: ?!=\n ⛳ Result: 24 instantiations\n 🎯 Baseline: 16 instantiations\n 📈 'string: ?!=' exceeded baseline by 50.00% (threshold is 20%).\n\n 🏌️  string: ++\n ⛳ Result: 8 instantiations\n 🎯 Baseline: 8 instantiations\n 📊 Delta: 0.00%\n\n 🏌️  number: =\n ⛳ Result: 14 instantiations\n 🎯 Baseline: 16 instantiations\n 📊 Delta: -12.50%\n\n 🏌️  number: !=\n ⛳ Result: 14 instantiations\n 🎯 Baseline: 16 instantiations\n 📊 Delta: -12.50%\n\n 🏌️  number: \u003e\n ⛳ Result: 14 instantiations\n 🎯 Baseline: 16 instantiations\n 📊 Delta: -12.50%\n\n 🏌️  number: \u003c\n ⛳ Result: 14 instantiations\n 🎯 Baseline: 16 instantiations\n 📊 Delta: -12.50%\n\n 🏌️  number: \u003e=\n ⛳ Result: 14 instantiations\n 🎯 Baseline: 16 instantiations\n 📊 Delta: -12.50%\n\n 🏌️  number: \u003c=\n ⛳ Result: 14 instantiations\n 🎯 Baseline: 16 instantiations\n 📊 Delta: -12.50%\n\n 🏌️  number: ?=\n ⛳ Result: 24 instantiations\n 🎯 Baseline: 20 instantiations\n 📊 Delta: +20.00%\n\n 🏌️  number: ?!=\n ⛳ Result: 24 instantiations\n 🎯 Baseline: 20 instantiations\n 📊 Delta: +20.00%\n\n 🏌️  number: +\n ⛳ Result: 30 instantiations\n 🎯 Baseline: 30 instantiations\n 📊 Delta: 0.00%\n\n 🏌️  number: -\n ⛳ Result: 30 instantiations\n 🎯 Baseline: 30 instantiations\n 📊 Delta: 0.00%\n\n 🏌️  number: *\n ⛳ Result: 30 instantiations\n 🎯 Baseline: 30 instantiations\n 📊 Delta: 0.00%\n\n 🏌️  number: /\n ⛳ Result: 30 instantiations\n 🎯 Baseline: 30 instantiations\n 📊 Delta: 0.00%\n\n 🏌️  number: %\n ⛳ Result: 30 instantiations\n 🎯 Baseline: 30 instantiations\n 📊 Delta: 0.00%\n\n 🏌️  number: //\n ⛳ Result: 30 instantiations\n 🎯 Baseline: 30 instantiations\n 📊 Delta: 0.00%\n\n 🏌️  number: ^\n ⛳ Result: 30 instantiations\n 🎯 Baseline: 30 instantiations\n 📊 Delta: 0.00%\n\n 🏌️  number: unary +\n ⛳ Result: 6 instantiations\n 🎯 Baseline: 6 instantiations\n 📊 Delta: 0.00%\n\n 🏌️  number: unary -\n ⛳ Result: 6 instantiations\n 🎯 Baseline: 6 instantiations\n 📊 Delta: 0.00%\n\n 🏌️  boolean: =\n ⛳ Result: 18 instantiations\n 🎯 Baseline: 22 instantiations\n 📊 Delta: -18.18%\n\n 🏌️  boolean: !=\n ⛳ Result: 18 instantiations\n 🎯 Baseline: 22 instantiations\n 📊 Delta: -18.18%\n\n 🏌️  boolean: \u003e\n ⛳ Result: 18 instantiations\n 🎯 Baseline: 22 instantiations\n 📊 Delta: -18.18%\n\n 🏌️  boolean: \u003c\n ⛳ Result: 18 instantiations\n 🎯 Baseline: 22 instantiations\n 📊 Delta: -18.18%\n\n 🏌️  boolean: \u003e=\n ⛳ Result: 18 instantiations\n 🎯 Baseline: 22 instantiations\n 📊 Delta: -18.18%\n\n 🏌️  boolean: \u003c=\n ⛳ Result: 18 instantiations\n 🎯 Baseline: 22 instantiations\n 📊 Delta: -18.18%\n\n 🏌️  boolean: ?=\n ⛳ Result: 26 instantiations\n 🎯 Baseline: 26 instantiations\n 📊 Delta: 0.00%\n\n 🏌️  boolean: ?!=\n ⛳ Result: 26 instantiations\n 🎯 Baseline: 26 instantiations\n 📊 Delta: 0.00%\n\n 🏌️  boolean: and\n ⛳ Result: 18 instantiations\n 🎯 Baseline: 22 instantiations\n 📊 Delta: -18.18%\n\n 🏌️  boolean: or\n ⛳ Result: 18 instantiations\n 🎯 Baseline: 22 instantiations\n 📊 Delta: -18.18%\n\n 🏌️  boolean: not\n ⛳ Result: 5 instantiations\n 🎯 Baseline: 5 instantiations\n 📊 Delta: 0.00%\n\n 🏌️  nested boolean: =\n ⛳ Result: 39 instantiations\n 🎯 Baseline: 41 instantiations\n 📊 Delta: -4.88%\n\n 🏌️  string: ilike\n ⛳ Result: 12 instantiations\n 🎯 Baseline: 12 instantiations\n 📊 Delta: 0.00%\n\n 🏌️  string: not ilike\n ⛳ Result: 12 instantiations\n 🎯 Baseline: 12 instantiations\n 📊 Delta: 0.00%\n\n ❌ 'string: ?=' exceeded baseline by 50.00% (threshold is 20%).\n ❌ 'string: ?!=' exceeded baseline by 50.00% (threshold is 20%).","styles":["rest_border_box","codeBlock"],"collapsible":true},[]],"\n",["p",{},["It looks like it’s consistently better with the exception of the ",["code",{},["?="]]," and ",["code",{},["?!="]]," operators, which makes some sense since it has moved further down the list of overloads. We can choose to abandon the original branch, and make this a new top-level experimental branch, or keep them both around. We’ll still split this experiment into two separate commits: the first that changes the implementation, and the second that updates the benchmarks."]],"\n",["p",{},["Let’s look at another idea: maybe instead of clustering by operator, we should cluster by operand. After adjusting and benchmarking, it turns out this has roughly the same performance as ",["code",{},["1234-experiments/union-operators"]]," which since that branch just happened to be incidentally clustered by operand. A few of the operators got a little better, and a few got measureably worse. It is across-the-board worse than ",["code",{},["1234-experiments/group-by-operator"]],", so we can abandon this new branch, and explore in other directions."]],"\n",["p",{},["As you can see, having benchmarks that track the number of type instantiations for a given expression allows us to quantify our experiments, turning wild guesses on what might be faster into concrete measurements. Often, different patterns of making a type present different trade-offs and it is difficult to know the overall impact of a change if you do not have some kind of comprehensive way to quantify the impact of a change."]],"\n"]],"\n",["div",{"styles":["section"],"data-section-id":"some-general-advice","id":"some-general-advice"},["\n",[4,{"id":"some-general-advice","level":2},["Some general advice"]],"\n",["p",{},["While the specific focus of this post is about ",["em",{},["how"]]," to measure changes, I’d like to also provide a few rules of thumb that might apply and can be good starting points for your own experiments. Some of this is general advice from the TypeScript wiki, and some of this I’ve discovered after doing experiments."]],"\n",["div",{"styles":["section"],"data-section-id":"prefer-interfaces-over-intersections","id":"prefer-interfaces-over-intersections"},["\n",[4,{"id":"prefer-interfaces-over-intersections","level":3},["Prefer interfaces over intersections"]],"\n",["p",{},["As noted in the TypeScript performance wiki:"]],"\n",["div",{"styles":["blockquote"]},[["div",{"styles":["quote"]},["\n",["p",{},["Type relationships between interfaces are also cached, as opposed to intersection types as a whole. A final noteworthy difference is that when checking against a target intersection type, every constituent is checked before checking against the “effective”/”flattened” type."]],"\n"]]]],"\n",["p",{},["Example:"]],"\n",[2,{"language":"typescript-diff","code":"- type Foo = Bar \u0026 Baz \u0026 {\n-     someProp: string;\n- }\n+ interface Foo extends Bar, Baz {\n+     someProp: string;\n+ }","styles":["rest_border_box","codeBlock"],"collapsible":false},[]],"\n"]],"\n",["div",{"styles":["section"],"data-section-id":"name-conditional-types","id":"name-conditional-types"},["\n",[4,{"id":"name-conditional-types","level":3},["Name conditional types"]],"\n",["p",{},["Another good one from the TypeScript performance wiki:"]],"\n",["div",{"styles":["blockquote"]},[["div",{"styles":["quote"]},["\n",["p",{},["This is convenient, but today, every time ",["code",{},["foo"]]," is called, TypeScript has to re-run the conditional type. What’s more, relating any two instances of ",["code",{},["SomeType"]]," requires re-relating the structure of the return type of ",["code",{},["foo"]],"."]],"\n",["p",{},["If the return type in this example was extracted out to a type alias, more information can be cached by the compiler:"]],"\n"]]]],"\n",["p",{},["Example:"]],"\n",[2,{"language":"typescript-diff","code":"- interface SomeType\u003cT\u003e {\n-   foo\u003cU\u003e(x: U):\n-     U extends TypeA\u003cT\u003e ? ProcessTypeA\u003cU, T\u003e :\n-     U extends TypeB\u003cT\u003e ? ProcessTypeB\u003cU, T\u003e :\n-     U extends TypeC\u003cT\u003e ? ProcessTypeC\u003cU, T\u003e :\n-     U;\n- }\n+ type FooResult\u003cU, T\u003e =\n+   U extends TypeA\u003cT\u003e ? ProcessTypeA\u003cU, T\u003e :\n+   U extends TypeB\u003cT\u003e ? ProcessTypeB\u003cU, T\u003e :\n+   U extends TypeC\u003cT\u003e ? ProcessTypeC\u003cU, T\u003e :\n+   U;\n+\n+ interface SomeType\u003cT\u003e {\n+   foo\u003cU\u003e(x: U): FooResult\u003cU, T\u003e;\n+ }","styles":["rest_border_box","codeBlock"],"collapsible":false},[]],"\n"]],"\n",["div",{"styles":["section"],"data-section-id":"move-expensive-types-into-generics","id":"move-expensive-types-into-generics"},["\n",[4,{"id":"move-expensive-types-into-generics","level":3},["Move expensive types into generics"]],"\n",["p",{},["Type aliases have two “halves”:"]],"\n",["ol",{},["\n",["li",{},["\n",["p",{},["The “left” side of the alias, which is the name of the type alias and defines any generics and their constraints"]],"\n"]],"\n",["li",{},["\n",["p",{},["The “right” side of the alias, which is the type that the alias refers to"]],"\n"]],"\n"]],"\n",["p",{},["Moving expensive generic expressions from the “right” side of a type alias to a new generic parameter on the “left” can sometimes improve performance. However, this approach isn’t universally beneficial and may require providing default values or explicit generic arguments. Always measure the impact of such changes to ensure they actually improve performance in your specific case."]],"\n",["p",{},["Example:"]],"\n",[2,{"language":"typescript-diff","code":"  export function op\u003c\n    Opr1 extends TypeSet\u003c$String\u003e,\n    Opr2 extends TypeSet\u003c$String\u003e,\n+   Result extends $expr_Operator\u003c\n+     Opr1[\"__element__\"],\n+     multiplyCardinalities\u003cparamCardinality\u003cOpr1\u003e, paramCardinality\u003cOpr2\u003e\u003e\n+   \u003e,\n+ \u003e(op1: Opr1, op: \"=\", op2: Opr2): Result;\n- \u003e(op1: Opr1, op: \"=\", op2: Opr2): $expr_Operator\u003c\n-    Opr1[\"__element__\"],\n-    multiplyCardinalities\u003cparamCardinality\u003cOpr1\u003e, paramCardinality\u003cOpr2\u003e\u003e\n-  \u003e;\n  };","styles":["rest_border_box","codeBlock"],"collapsible":false},[]],"\n"]],"\n",["div",{"styles":["section"],"data-section-id":"order-of-conditionals-matters","id":"order-of-conditionals-matters"},["\n",[4,{"id":"order-of-conditionals-matters","level":3},["Order of conditionals matters"]],"\n",["p",{},["When creating a conditional type with a few conditions, the order of the conditions matters. The type checker will stop evaluating the rest of the conditions as soon as it finds a match, so you can “tune” how expensive a particular case is by moving it earlier or later in the conditional."]],"\n",["p",{},["Here’s a very contrived example, which borrows an expensive type from ",["code",{},["arktype"]],":"]],"\n",["p",{},["Example:"]],"\n",[2,{"language":"typescript","code":"import { bench } from \"@ark/attest\";\nimport { type, type inferAmbient } from \"arktype\";\n\nbench.baseline(() =\u003e type(\"never\"))\n\ntype StrangeType\u003cT\u003e = T extends 0\n  ? 0\n  : T extends 1\n    ? 1\n    : T extends 2\n      ? inferAmbient\u003c\"(0|(1|(2|(3|(4|5)[])[])[])[])[]\"\u003e\n      : T;\n\nbench(\"StrangeType: 0\", () =\u003e {\n  type T = StrangeType\u003c0\u003e;\n}).types([2, \"instantiations\"]);\n\nbench(\"StrangeType: 1\", () =\u003e {\n  type T = StrangeType\u003c1\u003e;\n}).types([3, \"instantiations\"]);\n\nbench(\"StrangeType: 2\", () =\u003e {\n  type T = StrangeType\u003c2\u003e;\n}).types([81, \"instantiations\"]);\n\nbench(\"StrangeType: 3\", () =\u003e {\n  type T = StrangeType\u003c3\u003e;\n}).types([5, \"instantiations\"]);","styles":["rest_border_box","codeBlock"],"collapsible":false},[]],"\n",["p",{},["Our expensive conditional branch ",["code",{},["2"]]," takes 81 instantiations. Let’s move it first and see what happens:"]],"\n",[2,{"language":"typescript","code":"type StrangeType\u003cT\u003e = T extends 2\n  ? inferAmbient\u003c\"(0|(1|(2|(3|(4|5)[])[])[])[])[]\"\u003e\n  : T extends 0\n    ? 0\n    : T extends 1\n      ? 1\n      : T;","styles":["rest_border_box","codeBlock"],"collapsible":false},[]],"\n",["p",{},["In this version, the expensive case only costs 79 instantiations, but each of the earlier cases cost an additional instantiation due to the ",["code",{},["T extends 2"]]," check now coming before them."]],"\n",["p",{},["Sometimes, it can be useful to rearrange your conditionals to either make the most expensive or the most common cases cheaper. Sometimes you have a clear win if the most expensive cases are also very common cases, but you’ll need to know a bit about the specifics of your use case to make that decision."]],"\n"]],"\n"]],"\n",["div",{"styles":["section"],"data-section-id":"the-next-generation-of-performance-tools","id":"the-next-generation-of-performance-tools"},["\n",[4,{"id":"the-next-generation-of-performance-tools","level":2},["The next generation of performance tools"]],"\n",["p",{},["Like many performance related issues, learning the tips and tricks of improving type inference performance is a temporary skill, but learning how to measure and quantify the impact of a change is a perennial skill that will continue to be useful no matter how TypeScript evolves."]],"\n",["p",{},["To that end, I’d love to see more tooling around type performance in the future. I’m aware of some projects that are in the early stage of development for this purpose. Here are some concrete things that are currently difficult that would improve this method of performance improvement iteration:"]],"\n",["ol",{},["\n",["li",{},["\n",["p",{},["Measure the impact of a change on the language server wall time"]],"\n"]],"\n",["li",{},["\n",["p",{},["Trace the language server performance of a given expression and see what exactly the inference engine is doing (what types are being instantiated, what the call stack looks like, etc)"]],"\n"]],"\n",["li",{},["\n",["p",{},["Linting tools that provide performance-specific guidance"]],"\n"]],"\n",["li",{},["\n",["p",{},["Refactoring tool at the type level that help large refactors of types similar to runtime refactoring"]],"\n"]],"\n"]],"\n"]],"\n"]],"\n"]],"publishedOnFormatted":"August 08, 2024","authors":[{"id":"4fae4a738eecfb144a95d7c18946e494cedcfde4","name":"Scott Trinh","github":"scotttrinh","twitter":null,"avatarUrl":"https://avatars.githubusercontent.com/u/1682194?v=4\u0026s=72"}]},"recommendations":[{"id":"2024-08-27-seamless-vercel/post","basename":"post","headers":[{"id":"what-vercel-users-get","title":"What Vercel users get","level":2},{"id":"what-s-next-for-edgedb","title":"What’s next for EdgeDB","level":2}],"document":["div",{"styles":["rstWrapper"]},["\n","\n","\n","\n","\n","\n",["section",{"styles":["section"],"data-section-id":"seamless-dx-with-vercel","id":"seamless-dx-with-vercel"},["\n","\n",["p",{},["It’s only been a couple months since we announced our Vercel integration.\n            Today, we’re taking it to the next level. EdgeDB is part of the newly launched\n            ",["a",{"href":"https://vercel.com/blog/introducing-the-vercel-marketplace"},["Vercel Marketplace"]],", alongside Redis and Supabase."]],"\n",["p",{},["If you’re a Vercel user, using EdgeDB is now as seamless as using\n            Vercel Postgres. Here are a few important notes:"]],"\n",["ul",{"styles":[]},["\n",["li",{},["\n",["p",{},["You can now use your Vercel account for seamless authentication with\n                    EdgeDB Cloud."]],"\n"]],"\n",["li",{},["\n",["p",{},["Your EdgeDB Cloud usage will be included in your Vercel bill."]],"\n"]],"\n",["li",{},["\n",["p",{},["Everything is auto-configured to run out of the box, eliminating any\n                    friction between your database and the app."]],"\n"]],"\n"]],"\n",[19,{"aspectRatio":1.7123947051744886,"items":[{"type":"image","data":{"url":"/_images/_blog-gallery/b1c771e72e8f752c42df01b36191f6d2608b0d83","thumbnail":"data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wAARCAAqAFADASIAAhEBAxEB/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/8QAHwEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoL/8QAtREAAgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHBCSMzUvAVYnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6goOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4uPk5ebn6Onq8vP09fb3+Pn6/9oADAMBAAIRAxEAPwDgeKOKA2OhoLZ65NABkUKGZgFGSfak4oBOeKAHyp5b4529iRjNPAhkMSIJFb/loTg/kKjkBVyu7djvQnLhd23PehjQ08Eil4pCcnk5ooELxRxUkVw8S7VC4znkU2WVpSC2OPQUANjAZsFgo9TSfjQDil3GgBKegUAHzCrem3NM3Gp7ScwOzBipK7c8dD1oAZI285aUtjoStMVmU5HFSW8pguY5kYqY2DKeDgjkUXUpuLqWZ23NIxZjgDJPXpQBEST1o5qzf3T3ckbyOXKRiMHAGFHQcAVWzQAAn1oPvRk0hOaACiiigAqXYQoORioqMn1oAlU7eyn6ihju7KPoKiyfWjJ9aAJvKJTdlcfrUNGT60UAFFFFAH//2Q=="},"aspectRatio":1.886111111111111,"title":["Vercel Storage Popup"],"caption":null},{"type":"image","data":{"url":"/_images/_blog-gallery/15a202e2040215b5edd9efad3e32001624cabd3c","thumbnail":"data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wAARCAAuAFADASIAAhEBAxEB/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/8QAHwEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoL/8QAtREAAgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHBCSMzUvAVYnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6goOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4uPk5ebn6Onq8vP09fb3+Pn6/9oADAMBAAIRAxEAPwDhbRYGuo1undISfnZF3ED2FSbLbGfMfPYeUP8AGqyAswCruJ7U5vkyrR4YHv2oAV9oUBeSeuVxUdLnr8opKACinKjN91SaPLbONpz6UANopxRgwUjBNDo0ZwwwfrQA4CLHLsD7LTGxk7Tke9JRQAq9RnpUh8rBwrA/Wo1+8KduAyOuTQAmF9T+VJT9mV4BPuBSiM4JIwB6mgCPmjJqTHogb6H/AAo255+QjvzQBH3Gac44zx+lI2A4wMe3pSvyc5FAApVee/0BprkFiR0pUbac96RjljQADrUhDqAAffg1EKm+0NjG1f1/xoAYc5znn1zQNuDkc/WkZ9xztUfQUm72FAC456jH1pyx7snIwPembvYU5ZCoIAHNACNkMMkcUMRnj86Rm3HOKSgBRjOc4obrSUUAf//Z"},"aspectRatio":1.7123947051744886,"title":["Vercel Storage Usage"],"caption":null}]},[]],"\n",["p",{},[["b",{},["Kicker"]],": the price to use EdgeDB remains the same, regardless of whether you access it\n            through Vercel or directly via ",["a",{"href":"https://cloud.edgedb.com"},["cloud.edgedb.com"]],"."]],"\n",["div",{"styles":["section"],"data-section-id":"what-vercel-users-get","id":"what-vercel-users-get"},["\n",[4,{"id":"what-vercel-users-get","level":2},["What Vercel users get"]],"\n",["p",{},["The new integration makes it incredibly easy to build and deploy EdgeDB\n                applications using Vercel’s streamlined developer experience. Additionally,\n                EdgeDB Cloud integrates with GitHub and Vercel Preview deployments,\n                ensuring a seamless workflow."]],"\n",["p",{},["With EdgeDB you can build ",[1,{"href":"/blog/edgedb-cloud-free-tier-how-we-stack-up-vs-planetscale-supabase-neon"},["fast"]],", lean, and 100% type-safe\n                Next.js applications. The pain of database schema migrations, joins,\n                and access control disappears. Built-in Auth and AI extensions make it\n                possible to build production-grade systems in a matter of days or even hours."]],"\n",["p",{},["Here are some links to Next.js / TypeScript guides to help you get started:"]],"\n",["ul",{"styles":[]},["\n",["li",{},["\n",["p",{},[[1,{"href":"/blog/generative-ui-with-vercel-ai-sdk-and-edgedb"},["Generative UI with Vercel AI SDK and EdgeDB"]]]],"\n"]],"\n",["li",{},["\n",["p",{},[[1,{"href":"/blog/stop-building-auth-start-building-apps-with-edgedb-and-next-js"},["Stop building auth, start building apps with EdgeDB and Next.js"]]]],"\n"]],"\n",["li",{},["\n",["p",{},[["a",{"href":"https://docs.edgedb.com/guides/tutorials/nextjs_app_router"},["Building a simple blog application with EdgeDB and Next.js (App Router)​"]]]],"\n"]],"\n",["li",{},["\n",["p",{},[["a",{"href":"https://docs.edgedb.com/guides/tutorials/trpc"},["Integrating EdgeDB with tRPC"]]]],"\n"]],"\n",["li",{},["\n",["p",{},[[1,{"href":"/blog/designing-the-ultimate-typescript-query-builder"},["The ultimate TypeScript query builder"]]]],"\n"]],"\n"]],"\n"]],"\n",["div",{"styles":["section"],"data-section-id":"what-s-next-for-edgedb","id":"what-s-next-for-edgedb"},["\n",[4,{"id":"what-s-next-for-edgedb","level":2},["What’s next for EdgeDB"]],"\n",["p",{},["First up, we’ll see you at ",["a",{"href":"https://nextjs.org/conf"},["Next.js Conf"]],"! EdgeDB is proud to be\n                a Gold Sponsor. Be sure to visit our booth and chat with us!"]],"\n",["p",{},["Next, EdgeDB’s upcoming release is shaping up to be very exciting:"]],"\n",["ul",{"styles":[]},["\n",["li",{},["\n",["p",{},["SQL becomes a first-class citizen, making EdgeDB more accessible and\n                        compatible with the Postgres ecosystem—plus, we’re infusing SQL with\n                        powerful new capabilities."]],"\n"]],"\n",["li",{},["\n",["p",{},["Full PostGIS support, unlocking advanced spatial capabilities."]],"\n"]],"\n",["li",{},["\n",["p",{},["Introducing LSP (Language Server Protocol), so your editor can fully\n                        understand and work with EdgeDB schemas."]],"\n"]],"\n",["li",{},["\n",["p",{},[["code",{},["net"]]," module to make EdgeDB speak HTTP. Read the ",["a",{"href":"https://github.com/edgedb/rfcs/blob/master/text/1026-net-module.rst"},["RFC"]],"."]],"\n"]],"\n"]],"\n",["p",{},["Plus, we’ll be rolling out numerous improvements to EdgeDB Cloud,\n                the built-in UI, and other core components."]],"\n","\n","\n","\n","\n","\n","\n","\n","\n","\n","\n","\n","\n"]],"\n"]],"\n"]],"authors":[{"id":"d4ac0a0485ec8f3b3b39666025f7d538c6e40b2e","key":"yury","name":"Yury Selivanov","email":"yury@magic.io","twitter":"1st1","github":"1st1","avatarUrl":"https://avatars.githubusercontent.com/u/239003?v=4\u0026s=72"}],"guid":"50D882C2-D0B0-4FCB-8C07-AF17A4F617AA","localResources":null,"recommendations":[],"leadImage":{"filename":"2024-08-27-seamless-vercel/images/splash.jpg","path":"/_images/_blog/53aa9d7cb5c89672165220c8320ed5f2f4384256","pathIncludesExt":false,"width":1920,"height":800,"brightness":83.63598484848485,"thumbnail":"data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wAARCAAhAFADASIAAhEBAxEB/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/8QAHwEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoL/8QAtREAAgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHBCSMzUvAVYnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6goOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4uPk5ebn6Onq8vP09fb3+Pn6/9oADAMBAAIRAxEAPwDhBThTRTxTJHrUyDNQrVu2j3sPSmhMvabYSXcyxxqWJ9K24IvJ+QjaF7Vs+FrBbW1+1yLgtxGPbuaTxFabCLqIfI/3sdjTv0M2tLlNJ+wq5BNjvWEkuDVlLjA61RJvrdcYzxVS4udxPNZ7XW1cZqBrnPelYLnCCnimCnKMmoNyaMZPtXQ+G9NOo3yRgHy1+Zz6CueU9h0rRstQns8+RK8ZPXa2M1SJZ6lLC+1UjTaijCgdhR9nM1u8Eyko4x9K84/t6/8A+fub/vs04a9fAf8AH3N/32aLCLmowPY3bwycFT+dQJPjkmqM9/NdSbppGdumWOTTDNgYzTJsXXuST1pouPes8y0nm+9FwsZVSL92iioRqSR1IKKKoliinnpRRQAJ1pzUUUCGGkNFFAz/2Q=="},"slug":"seamless-dx-with-vercel","title":"Seamless DX with Vercel","publishedOn":"2024-08-28T10:00:00.000Z","description":"We’re excited to announce the brand new seamless integration with Vercel","publishedOnTimestamp":1724839200000,"publishedOnFormatted":"August 28, 2024"},{"id":"2024-06-28-building-webble-with-edgedb/post","basename":"post","headers":[{"id":"what-sets-edgedb-apart","title":"What sets EdgeDB Apart","level":2},{"id":"schema-modeling-is-easy-with-edgedb","title":"Schema Modeling is Easy with EdgeDB","level":2},{"id":"authentication-is-a-breeze-with-edgedb","title":"Authentication is a Breeze with EdgeDB","level":2},{"id":"edgedb-comes-with-a-ui","title":"EdgeDB comes with a UI","level":2},{"id":"querying-with-edgedb","title":"Querying with EdgeDB","level":2},{"id":"conclusion","title":"Conclusion","level":2}],"document":["div",{"styles":["rstWrapper"]},["\n","\n","\n","\n","\n","\n",["section",{"styles":["section"],"data-section-id":"powering-webble-s-growth-how-edgedb-became-the-cornerstone-of-their-tech-stack","id":"powering-webble-s-growth-how-edgedb-became-the-cornerstone-of-their-tech-stack"},["\n","\n",["div",{"styles":["border_box","note"]},["\n",["p",{},["This guest post is authored by ",["a",{"href":"https://github.com/Gim3l"},["Gimel Dick"]],",\n                a third-place winner in the recent ",["a",{"href":"https://hackathon.edgedb.com/"},["EdgeDB Hackathon"]],",\n                sharing their experience integrating EdgeDB into their project."]],"\n",["p",{},["Webble lets you create conversational forms instead of traditional ones.\n                These forms are engaging and boost conversion rates. They can be used for customer\n                support, feedback collection, and surveys."]],"\n"]],"\n",[6,{"styles":["picture","fullWidth"],"url":"/_images/_blog/292dbfc1f43d70c7da07953b756a2ff7786cffb3","alt":"Webble Interface","width":1892,"height":991,"thumbnail":"data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wAARCAApAFADASIAAhEBAxEB/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/8QAHwEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoL/8QAtREAAgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHBCSMzUvAVYnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6goOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4uPk5ebn6Onq8vP09fb3+Pn6/9oADAMBAAIRAxEAPwDjvPOMbU6Y6VFV1jhBwvT09qpUAFFO3f7IpO/pQBcVpVRcRwEAdwMn60xrp0JUxQc/7FKNoXnle9QTbd/yk496rmfcVkIsTyAlVyKGjZPvDFPjdQnUA/SkdgU65OfyqRkVTJcFYvL8uMj1K8/nUNFAmrlkyxlcZOcelVqteRHtBG7PfNNuIFhUYYEn0OcU7DK9FFFICfzk4+XOPXpUcjB3yBgelMooAKKKKACiiigC6CdoHao7kllyeuaaOlNk+7+NAEVFFFACgEnABJ9qVlZThlIPuKdB/rR9D/Kn3X+sH0P8zVW924r6kFFFFSMKKKKAP//Z","widths":[940,770],"sizes":{"default":1120,"xl":940,"lg":840,"md":680,"sm":"100vw"}},[]],"\n",["p",{},["Choosing the right database is hard. But why is that? Is it a fear of vendor\n            lock-in? Maybe we’re just tired of writing SQL? Perhaps it’s simply because\n            there are too many options to choose from."]],"\n",["p",{},["Just choosing between PostgreSQL, MySQL, SQLite, and MongoDB poses a challenge\n            for many of us. Do we go with a relational database, a graph database, or a\n            NoSQL database? And with many spin-offs of PostgreSQL, how do we choose the\n            right flavor?"]],"\n",["p",{},["The correct answer to these questions is usually: it depends. We need to first\n            analyze the needs of our application if we’re going to make the correct choice.\n            At ",["a",{"href":"https://webble.co"},["Webble"]],", we also had to ask ourselves some of these\n            questions and more. Questions like:"]],"\n",["ul",{"styles":[]},["\n",["li",{},["\n",["p",{},["Do I want to write SQL by hand? ",["em",{},["No, maybe an ORM is enough…"]]]],"\n"]],"\n",["li",{},["\n",["p",{},["Do I want to write migrations by hand? ",["em",{},["Again, no. An ORM might help…"]]]],"\n"]],"\n",["li",{},["\n",["p",{},["Does the ORM/database offer type-safety?"]],"\n"]],"\n",["li",{},["\n",["p",{},["How easy is it to model data?"]],"\n"]],"\n",["li",{},["\n",["p",{},["What tooling is provided for quickly viewing the data?"]],"\n"]],"\n",["li",{},["\n",["p",{},["What additional benefits does one database offer over the other?"]],"\n"]],"\n",["li",{},["\n",["p",{},["How important is performance?"]],"\n"]],"\n",["li",{},["\n",["p",{},["Who else on my team are going to be using this?"]],"\n"]],"\n"]],"\n",["p",{},["These are just some of the few questions we’ve had to ask ourselves before\n            settling with EdgeDB. But why EdgeDB?"]],"\n",["div",{"styles":["section"],"data-section-id":"what-sets-edgedb-apart","id":"what-sets-edgedb-apart"},["\n",[4,{"id":"what-sets-edgedb-apart","level":2},["What sets EdgeDB Apart"]],"\n",["p",{},["EdgeDB is a relatively new database with many unique selling points that\n                ticked all the right boxes for us. For instance, EdgeDB is built on a solid\n                foundation, PostgreSQL. It comes with a type-safe TypeScript client, a built-in\n                UI for writing queries, viewing data, and visualizing your application’s data\n                schema. It includes polymorphic data modeling, access policies to support\n                advanced authorization modeling, password and social authentication, and more.\n                But perhaps most importantly for us, EdgeDB’s biggest selling point was its\n                ease of use and how easy it was to get started."]],"\n",["p",{},["One of the main challenges of writing production-level SQL is performance.\n                EdgeDB has a trick up its sleeve: all queries of arbitrary complexity are\n                compiled into a single highly optimized SQL query, so you worry less about\n                performance and more about your application’s business logic. But if you do need\n                to debug the performance of a query, EdgeDB provides the necessary tools for\n                visualizing a query’s performance."]],"\n"]],"\n",["div",{"styles":["section"],"data-section-id":"schema-modeling-is-easy-with-edgedb","id":"schema-modeling-is-easy-with-edgedb"},["\n",[4,{"id":"schema-modeling-is-easy-with-edgedb","level":2},["Schema Modeling is Easy with EdgeDB"]],"\n",["p",{},["In EdgeDB, modeling data is simple. To do so, we use SDL, EdgeDB’s Schema\n                Definition Language. All SDL code can be written in a file ending with ",["code",{},[".esdl"]],".\n                We can write our entire schema in one file, or we can split it into many.\n                Whichever approach you decide, SDL is intuitive to write and easy to read."]],"\n",["p",{},["Example:"]],"\n",[2,{"language":"edgeql","code":"module default {\n   type User {\n      required username: str {\n         # usernames must be unique\n         constraint exclusive;\n\n         # max length (built-in)\n         constraint max_len_value(25);\n      };\n      required email: str;\n      projects := .\u003cowner[is Project];\n   }\n\n   type Project {\n      required name: str;\n      required owner: User;\n   }\n}","styles":["rest_border_box","codeBlock"],"collapsible":false},[]],"\n",["p",{},["In the example above, we defined a User entity type and a ",["code",{},["Project"]]," entity type in\n                our schema. Using the concept of links in EdgeDB, we can link our User entity to\n                our ",["code",{},["Project"]]," entity by defining a single owner link, specifying a cardinality\n                of many-to-one. We also defined a computed field ",["code",{},["projects"]]," on the ",["code",{},["User"]]," entity that\n                returns all projects owned by the user."]],"\n",["p",{},["EdgeDB’s SDL also allows us to define constraints, access control, base entity\n                types for polymorphic data modeling, configure our EdgeDB application (e.g.,\n                authentication, GraphQL), define triggers, computed fields, and more. It’s\n                extremely powerful!"]],"\n"]],"\n",["div",{"styles":["section"],"data-section-id":"authentication-is-a-breeze-with-edgedb","id":"authentication-is-a-breeze-with-edgedb"},["\n",[4,{"id":"authentication-is-a-breeze-with-edgedb","level":2},["Authentication is a Breeze with EdgeDB"]],"\n",["p",{},["Another reason we went with EdgeDB is because it allows us to ship code faster\n                by not having to build authentication from scratch. EdgeDB comes with an opt-in\n                authentication system that is tightly coupled with the EdgeDB data model. We can\n                skip the hurdle of setting up a third-party authentication solution, while\n                keeping all our users’ data securely stored within the EdgeDB database."]],"\n",["p",{},["It’s easy to get started with EdgeDB auth — we enable it by adding a\n                single line to our schema. We can then configure it through EdgeDB UI.\n                It allows us to configure multiple authentication strategies\n                including OAuth, password and passwordless auth."]],"\n",[2,{"language":"sdl","code":"using extension auth;","styles":["rest_border_box","codeBlock"],"collapsible":false},[]],"\n",["p",{},["The EdgeDB team provides various libraries for working with EdgeDB auth, but\n                they are not required. At Webble, we used the ",["code",{},["@edgedb/auth-remix"]]," package to\n                quickly integrate EdgeDB auth into our remix application."]],"\n"]],"\n",["div",{"styles":["section"],"data-section-id":"edgedb-comes-with-a-ui","id":"edgedb-comes-with-a-ui"},["\n",[4,{"id":"edgedb-comes-with-a-ui","level":2},["EdgeDB comes with a UI"]],"\n",["p",{},["As stated earlier, one of the primary reasons we decided to use EdgeDB is\n                because of its ease-of-use. EdgeDB’s ease-of-use is manifested not just in\n                its DSLs, such as the SDL, but also in the tools that are bundled with it. EdgeDB UI\n                allows you to visualize complex relations between your defined types, browse\n                data, and run queries. Having the EdgeDB UI at our disposal was a major\n                productivity boost for us."]],"\n",[6,{"styles":["picture","fullWidth"],"url":"/_images/_blog/2c2fec4ef73c77f702da7949863c8f9e240d9ea7","alt":"EdgeDB UI","width":1920,"height":878,"thumbnail":"data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wAARCAAkAFADASIAAhEBAxEB/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/8QAHwEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoL/8QAtREAAgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHBCSMzUvAVYnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6goOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4uPk5ebn6Onq8vP09fb3+Pn6/9oADAMBAAIRAxEAPwDkd+5cADAx1Vc/ypoQAn39qVen5fypaAE2jOePyFIFA/8A1CtWKeyEKBgm8KM5TPNDT2XnRkBNoB3fJ34xQYe2d7crMxYPMDMCoxjgkDOfSle12LuLKR7OD/KtUXFhnkR4/wCudRwzWSxKHCbu+Y896Be2dvhZleWvvR5a+9azz2ReMgJgE7sJjjFPFxYdxH/37oD2z/lZjeWvvRsABI9KmmKmZyn3Sxx9Kjb7p+lBuhsf3afTIvu/jT6BhRT0iaT7qkj2pCjB9pUhvSgB8/kfL5G/33GmJt3Av93uAeTTmgkC52t6njpSRxtI2FBPrgZoAYRjuD9KKVlZGKsCCOxp7Quqbire/HSgCOkb7p+lLSN90/SgCNWIHGKXefaiigA3n0FG8+goooAN59BRvPoKKKADefajefQUUUAG8+1Bc47UUUAf/9k=","widths":[940,770],"sizes":{"default":1120,"xl":940,"lg":840,"md":680,"sm":"100vw"}},[]],"\n"]],"\n",["div",{"styles":["section"],"data-section-id":"querying-with-edgedb","id":"querying-with-edgedb"},["\n",[4,{"id":"querying-with-edgedb","level":2},["Querying with EdgeDB"]],"\n",["p",{},["When querying databases with EdgeDB, we use EdgeQL, a query language provided by\n                EdgeDB designed to match SQL in power while being clearer and more concise. You\n                can experiment with EdgeQL by using the EdgeDB UI. At Webble, we opted not to\n                write EdgeQL but instead decided to use the EdgeDB TypeScript query builder.\n                Writing type-safe queries in a clean and efficient manner was one of our top\n                priorities. Luckily, with the EdgeDB TypeScript client, doing so was surprisingly\n                easy. Arguably, it’s one of EdgeDB’s greatest selling points. And here’s why:"]],"\n",["p",{},[["b",{},["You don’t have to write EdgeQL…but you can."]]]],"\n",["p",{},["The TypeScript library gives you the option of writing EdgeQL if you prefer\n                that approach. You can write all of your queries in ",["code",{},["*.edgeql"]]," files and then\n                run a simple command to generate TypeScript functions from your EdgeDB queries.\n                This approach is particularly useful because you can execute your queries on the\n                EdgeDB UI to see the results and, once you’re comfortable, you can add them to\n                your application code without fear of getting a completely different result at\n                runtime."]],"\n",["p",{},["The other approach to writing queries in EdgeDB is using the provided query\n                builder. The query builder is a ",["b",{},["code-first"]]," approach where we write code and\n                the EdgeQL query is generated for us, rather than the other way around. It is\n                just as powerful as writing EdgeQL queries."]],"\n",["p",{},["As of the time this article was written, there is currently a lack of a language\n                server extension for EdgeQL for VSCode and other IDEs. As a result, you don’t\n                get autocompletion in your IDE and errors or warnings when writing queries by\n                hand. Therefore, there is a clear advantage to the code-first approach, which\n                leverages TypeScript for autocompletion, type inference, and type checking.\n                Thankfully, the team at EdgeDB is currently working on bridging this gap."]],"\n",["p",{},["Luckily for us, because the TypeScript client is designed to be as close to\n                EdgeQL as possible, we don’t lose much by going the code-first route. We can\n                still experiment with EdgeQL queries in the EdgeDB UI and easily translate them\n                to the query builder."]],"\n",["p",{},[["b",{},["To illustrate this:"]]]],"\n",["p",{},["Below is a query to filter all ",["b",{},["*projects*"]]," in our database and sort them by\n                ",["b",{},["*name*"]]," in ascending order."]],"\n",[2,{"language":"edgeql","code":"select Project {\n  name,\n  owner: {\n    email,\n    id,\n    username\n  }\n}\norder by .name","styles":["rest_border_box","codeBlock"],"collapsible":false},[]],"\n",["p",{},["And here’s the code for that using the query builder…"]],"\n",[2,{"language":"python","code":"const query = e.select(e.Project, (project) =\u003e ({\n   name: true,\n   owner: {\n       email: true,\n       id: true,\n       username: true,\n   },\n   order_by: project.name\n}));\n\nconst result = await query.run(client)","styles":["rest_border_box","codeBlock"],"collapsible":false},[]],"\n",["p",{},["The query above yields the following result:"]],"\n",[2,{"language":"json","code":"[\n  {\n    \"name\": \"EdgeDB\",\n    \"owner\": {\n      \"email\": \"gimel@mail.com\",\n      \"id\": \"d2a6ee0c-3489-11ef-9605-2321f051e381\",\n      \"username\": \"gim3l\"\n    }\n  },\n  {\n    \"name\": \"TrueSelph\",\n    \"owner\": {\n      \"email\": \"gimel@mail.com\",\n      \"id\": \"d2a6ee0c-3489-11ef-9605-2321f051e381\",\n      \"username\": \"gim3l\"\n    }\n  },\n  {\n    \"name\": \"Webble\",\n    \"owner\": {\n      \"email\": \"gimel@mail.com\",\n      \"id\": \"d2a6ee0c-3489-11ef-9605-2321f051e381\",\n      \"username\": \"gim3l\"\n    }\n  }\n]","styles":["rest_border_box","codeBlock"],"collapsible":false},[]],"\n",["p",{},["As you can see, writing queries in EdgeDB is not only intuitive, but the result\n                also carries the same shape as our query. This is akin to writing queries in\n                GraphQL, where we write the query in a hierarchical fashion."]],"\n"]],"\n",["div",{"styles":["section"],"data-section-id":"conclusion","id":"conclusion"},["\n",[4,{"id":"conclusion","level":2},["Conclusion"]],"\n",["p",{},["EdgeDB is not just a database; it’s a stack of tools for handling data for your\n                application, designed for productivity.\n                Overall, the experience of using EdgeDB versus using other disparate technologies\n                is unmatched. For Webble, the EdgeDB experience is not just good enough; it’s\n                superior. So, it was sensible to use EdgeDB to build Webble."]],"\n",["p",{},["Are you tired of the traditional challenges associated with SQL? Are you looking\n                for a modern, developer-friendly database solution? Then, I strongly urge you to\n                give EdgeDB a shot. You can get started by checking out the ",["a",{"href":"https://docs.edgedb.com/"},["EdgeDB documentation"]],"."]],"\n",["p",{},["Visit ",["a",{"href":"https://webble.co"},["Webble"]]," to see how we’re using EdgeDB to power our\n                application."]],"\n"]],"\n"]],"\n"]],"authors":[{"id":"ea2845c1f3eefbb6f96f539be372e8fe222324a2","key":"gimeldick","name":"Gimel Dick","email":"gimeldick@gmail.com","twitter":null,"github":"Gim3l","avatarUrl":"https://avatars.githubusercontent.com/u/46765702?v=4\u0026s=72"}],"guid":"37392123-b96e-4195-8be3-4577d53bb9a9","localResources":null,"recommendations":[],"leadImage":{"filename":"2024-06-28-building-webble-with-edgedb/images/splash.jpg","path":"/_images/_blog/c7bad5a9b005f83c11533e410c6cd6e461e9005c","pathIncludesExt":false,"width":1920,"height":800,"brightness":39.368560606060605,"thumbnail":"data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wAARCAAhAFADASIAAhEBAxEB/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/8QAHwEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoL/8QAtREAAgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHBCSMzUvAVYnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6goOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4uPk5ebn6Onq8vP09fb3+Pn6/9oADAMBAAIRAxEAPwDjKei72CjqTgU2pIBi4j/3h/OqitQZN/Z1x/dX/vqj+zrj+6v/AH1Wq6ylspIFHpim7J8/60flXofVYeZjzsx5rd4WCyYBIzwaixWhqW03KK2eVxkHpzWeQQSO4riqwUJNI0i7oMGgfSjmjB9KzKDpRS5GPekzQAUZ5BHBFJSjGeaQEouJh1lc/wDAjQbiYniR/wDvo1EcdqKrnl3FZEhlYkF8sR3Jq5poU3TkEEFSfpzVDk1LbztbOXVQcjHNaU52mnLYUlpoayzMRkwSDkjGBT0k3NgxsvuRWd/akn/PNPzNH9qSf880/M13LE0+/wCBlyMqTj/SJMf3j/OmU5pCzs/Qsc00nJya82Vm7myEoooqRhRRRQA9elDdKKKroIZRRRUjCiiigD//2Q=="},"slug":"powering-webble-s-growth-how-edgedb-became-the-cornerstone-of-their-tech-stack","title":"Powering Webble’s Growth: How EdgeDB Became the Cornerstone of Their Tech Stack","publishedOn":"2024-06-28T10:00:00.000Z","description":"Choosing the right database is hard. But why is that? Is it a fear of vendor lock-in? Maybe we’re just tired of writing SQL? Perhaps it’s simply because there are too many options to choose from.","publishedOnTimestamp":1719568800000,"publishedOnFormatted":"June 28, 2024"}]},"__N_SSG":true},"page":"/blog/[slug]","query":{"slug":"an-approach-to-optimizing-typescript-type-checking-performance"},"buildId":"bDD4y42v5_jcHjS6zXeVv","isFallback":false,"gsp":true,"scriptLoader":[]}</script><script data-collect-dnt="true" async="" defer="" src="./s_files/latest.js"></script><noscript><img src="https://sapi.edgedb.com/noscript.gif" alt="" referrerpolicy="no-referrer-when-downgrade" /></noscript><next-route-announcer><p aria-live="assertive" id="__next-route-announcer__" role="alert" style="border: 0px; clip: rect(0px, 0px, 0px, 0px); height: 1px; margin: -1px; overflow: hidden; padding: 0px; position: absolute; top: 0px; width: 1px; white-space: nowrap; overflow-wrap: normal;"></p></next-route-announcer><script src="./s_files/blog-52c9e0f05f73605d.js"></script><script src="./s_files/11d837d1-ee2ce654bf6d7ebf.js"></script><script src="./s_files/16db9192-50210da8d29f8c7e.js"></script><script src="./s_files/3ffde0ae-945d9e7729047e21.js"></script><script src="./s_files/ee8dd797-b8ed1a8f63feb932.js"></script><script src="./s_files/e282aedf-f0ad0aeca04f2052.js"></script><script src="./s_files/3383-e4edad8302a9daf1.js"></script><script src="./s_files/7833-f76e3344ec75806c.js"></script><script src="./s_files/index-9dca941ba9be84c1.js"></script></body></html>